---
// src/components/ExperienceTimeline.astro
import StatusLight from "./StatusLight.astro";

interface Props {
  experiences?: Array<{
    date: string;
    role: string;
    company: string;
    status: string;
    description: string[];
    projects?: Array<{
      title: string;
      href: string;
    }>;
  }>;
}

const { experiences = [] } = Astro.props;
---

<div class="terminal-section">
  <h2 class="section-header">$ tail -f /var/log/experience.log</h2>
  <p class="section-meta">[+] Displaying {experiences.length} entries</p>

  <div class="timeline">
    {experiences.map((job, index) => (
      <article class="timeline-entry">
        <div class="entry-indicator">
          <StatusLight status={job.status === "ongoing" ? "ongoing" : "completed"} />
        </div>

        <div class="entry-content">
          <header class="entry-header">
            <div class="header-main">
              <span class="entry-date">[{job.date}]</span>
              <span class="entry-divider">|</span>
              <span class="entry-status">{job.status === "ongoing" ? "ACTIVE" : "COMPLETED"}</span>
            </div>
          </header>

          <div class="entry-body">
            <div class="entry-field">
              <span class="field-label">&gt;&gt; ROLE:</span>
              <span class="field-value role">{job.role}</span>
            </div>
            <div class="entry-field">
              <span class="field-label">&gt;&gt; ORG:</span>
              <span class="field-value org">{job.company}</span>
            </div>
            <div class="entry-field description-field">
              <span class="field-label">&gt;&gt; LOG:</span>
              <ul class="description-list">
                {job.description.map((item) => (
                  <li>
                    <span class="list-marker">[+]</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
            </div>
            {job.projects && job.projects.length > 0 && (
              <div class="entry-field projects-field">
                <span class="field-label">&gt;&gt; REF:</span>
                <div class="projects-list">
                  {job.projects.map((project) => (
                    <a
                      href={project.href}
                      class="project-link"
                      target={project.href.startsWith('http') ? '_blank' : undefined}
                      rel={project.href.startsWith('http') ? 'noopener noreferrer' : undefined}
                    >
                      <span class="link-marker">{project.href.startsWith('http') ? '↗' : '→'}</span>
                      <span>{project.title}</span>
                    </a>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </article>
    ))}
  </div>
</div>

<style>
  .terminal-section {
    font-family: "IBM Plex Mono", monospace;
    padding: 1.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
  }

  .section-header {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.25rem 0;
    color: #10b981;
  }

  .section-meta {
    font-size: 0.75rem;
    opacity: 0.5;
    margin: 0 0 1.5rem 0;
  }

  .timeline {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .timeline-entry {
    display: flex;
    gap: 1rem;
    padding: 1.25rem;
    background: color-mix(in srgb, currentColor 2%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .timeline-entry:hover {
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-color: color-mix(in srgb, currentColor 15%, transparent);
  }

  .entry-indicator {
    flex-shrink: 0;
    padding-top: 0.2rem;
  }

  .entry-content {
    flex-grow: 1;
    min-width: 0;
  }

  .entry-header {
    margin-bottom: 1rem;
  }

  .header-main {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    font-size: 0.8rem;
  }

  .entry-date {
    font-weight: 600;
    color: #10b981;
  }

  .entry-divider {
    opacity: 0.3;
  }

  .entry-status {
    font-size: 0.7rem;
    letter-spacing: 0.05em;
    opacity: 0.6;
  }

  .entry-body {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .entry-field {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    font-size: 0.8rem;
    line-height: 1.5;
  }

  .field-label {
    color: #10b981;
    font-weight: 600;
    flex-shrink: 0;
    min-width: 60px;
  }

  .field-value {
    opacity: 0.8;
  }

  .field-value.role {
    font-weight: 600;
    opacity: 0.95;
  }

  .field-value.org {
    opacity: 0.7;
  }

  .description-field {
    align-items: flex-start;
    margin-top: 0.5rem;
  }

  .description-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .description-list li {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    opacity: 0.75;
    font-size: 0.78rem;
    line-height: 1.6;
  }

  .list-marker {
    color: #10b981;
    flex-shrink: 0;
    opacity: 0.7;
  }

  .projects-field {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px dashed color-mix(in srgb, currentColor 10%, transparent);
  }

  .projects-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem 1rem;
  }

  .project-link {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.75rem;
    color: inherit;
    text-decoration: none;
    opacity: 0.7;
    transition: all 0.2s ease;
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    border-radius: 3px;
  }

  .project-link:hover {
    opacity: 1;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border-color: color-mix(in srgb, #10b981 30%, transparent);
  }

  .link-marker {
    color: #10b981;
    font-size: 0.7rem;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .timeline-entry {
      flex-direction: column;
      gap: 0.75rem;
    }

    .entry-field {
      flex-direction: column;
      gap: 0.25rem;
    }

    .field-label {
      min-width: auto;
    }
  }
</style>
