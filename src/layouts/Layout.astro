---
const { pageTitle } = Astro.props;
const pathname = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Solomon Neas | {pageTitle}</title>
    <link rel="icon" type="image/svg+xml" href="/icon.svg" id="svg-icon" />

    <link rel="stylesheet" href="/styles/global.css" />

    <script>
      let darkmode = false;
      const svgIcon = document.getElementById("svg-icon");

      function random(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
      }

      function applyTheme(inverted, hueRotation) {
        const a = inverted ? 100 : 0;
        const style = document.createElement("style");
        document.head.append(style);

        style.innerText = `
 #filter { backdrop-filter:hue-rotate(${hueRotation}deg) invert(${a}%); }
 `;

        const o = `data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 8 8\'%3E%3Ctext x=\'50%25\' y=\'60%25\' font-family=\'serif\' font-weight=\'bold\' font-size=\'7\' fill=\'%23C5A028\' text-anchor=\'middle\' dominant-baseline=\'middle\'%3ES%3C/text%3E%3Cstyle%3Esvg{filter:hue-rotate(${hueRotation}deg) invert(${a}%25);}%3C/style%3E%3C/svg%3E`;
        svgIcon.setAttribute("href", o);
        saveThemeToLocalStorage(inverted, hueRotation);
      }

      function saveThemeToLocalStorage(inverted, hueRotation) {
        if (!localStorage) return;
        localStorage.setItem("inverted", inverted ? "true" : "false");
        localStorage.setItem("hueRotation", hueRotation);
      }

      function getThemeFromLocalStorage() {
        if (!localStorage) return;
        let inverted = localStorage.getItem("inverted");
        const hueRotation = localStorage.getItem("hueRotation");

        if (inverted === "true") {
          darkmode = true;
        }

        if (hueRotation) {
          applyTheme(inverted, hueRotation);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("color");
        btn.addEventListener("click", () => {
          darkmode = !darkmode;
          const hue = Math.floor(random(0, 360));
          applyTheme(darkmode, hue);
        });

        getThemeFromLocalStorage();

        const animationStyle = document.createElement("style");
        document.head.append(animationStyle);

        setTimeout(() => {
          animationStyle.innerText = `* {
            transition-property:filter, backdrop-filter;
            transition-duration: 1s;
          }`;
        }, 1);
      });
    </script>
  </head>
  <body>
    <div id="filter"></div>
    <div class="site-wrapper">
      <a href="#main-content" id="skip-link">Skip to content</a>
      <nav>
        <div class="title-container">
          <div class="serif site-title">Solomon Neas</div>
          <button id="color" class="button">random theme</button>
        </div>
        <div class="nav-links">
          <ul>
            <li>
              <a href="/" class={pathname === "/" ? "current-link" : ""}>Home</a
              >
            </li>
            <li>
              <a
                href="/about"
                class={pathname.startsWith("/about") ? "current-link" : ""}
                >About</a
              >
            </li>
            <li>
              <a
                href="/opportunities"
                class={pathname.startsWith("/opportunities")
                  ? "current-link"
                  : ""}>Opportunities</a
              >
            </li>
            <li>
              <a
                href="/projects"
                class={pathname.startsWith("/projects") ? "current-link" : ""}
                >Projects</a
              >
            </li>
            <li>
              <a
                href="/resources"
                class={pathname.startsWith("/resources") ? "current-link" : ""}
                >Resources</a
              >
            </li>
            <li>
              <a
                href="/blog"
                class={pathname.startsWith("/blog") ? "current-link" : ""}
                >Blog</a
              >
            </li>
            <li><a href="/rss.xml" target="_blank">RSS</a></li>
            <li>
              <a
                href="/contact"
                class={pathname.startsWith("/contact") ? "current-kind" : ""}
                >Contact</a
              >
            </li>
          </ul>
        </div>
      </nav>
      <main id="main-content">
        <slot />
      </main>
      <footer id="footer">
        {
          pathname.startsWith("/blog/") && (
            <div class="text-center" style="margin-bottom: 2rem;">
              <a href="/blog" class="text-lg text-blue-500 hover:underline">
                Back to Blog
              </a>
            </div>
          )
        }
        <div id="kofi">
          <a href="https://ko-fi.com/solomonneas" class="kofi-button">
            <img src="/ko-fi.png" alt="" width="22px" height="15px" />
            Buy me a coffee
          </a>
        </div>
        <div class="nav-links footer-links">
          <ul>
            <li>
              <a
                href="https://www.linkedin.com/in/solomon-neas/"
                target="_blank">LinkedIn</a
              >
            </li>
            <li><a href="https://x.com/solomonneas" target="_blank">X</a></li>
            <li><a href="mailto:srneas@gmail.com">Email</a></li>
          </ul>
        </div>
      </footer>
    </div>
  </body>
</html>
