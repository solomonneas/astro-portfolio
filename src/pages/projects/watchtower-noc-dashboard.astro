---
import ProjectLayout from "../../layouts/ProjectLayout.astro";

const frontmatter = {
  title: "Watchtower NOC Dashboard",
  status: "In Progress",
  statusType: "ongoing",
  origin: "Polk State College",
  date: "2026.01",
  techStack: ["FastAPI", "React", "TypeScript", "Redis", "WebSocket", "ReactFlow", "Zustand", "TailwindCSS", "Proxmox API", "LibreNMS API"],
};

// Data sources
const dataSources = [
  { name: "LibreNMS", type: "SNMP Metrics", provides: "Device status, interfaces, port traffic, CDP/LLDP neighbors", color: "#10b981" },
  { name: "Netdisco", type: "L2 Discovery", provides: "MAC tables, device inventory, switch port mappings", color: "#3b82f6" },
  { name: "Proxmox", type: "Virtualization", provides: "VM/container lists, CPU/memory, storage pools", color: "#f59e0b" },
  { name: "Speedtest CLI", type: "WAN Health", provides: "Download/upload speeds, latency, jitter", color: "#8b5cf6" },
];

// Features list
const features = [
  {
    name: "Interactive Topology Canvas",
    desc: "Draggable network map with expandable clusters, device status indicators, and animated connection links",
    tech: "ReactFlow + Zustand + WebSocket",
    icon: "üó∫Ô∏è",
    anchor: "topology-canvas"
  },
  {
    name: "Real-Time Updates",
    desc: "WebSocket pushes live device status, health metrics, and link changes without polling",
    tech: "FastAPI WebSocket + APScheduler",
    icon: "‚ö°",
    anchor: "websocket-updates"
  },
  {
    name: "CDP/LLDP Link Discovery",
    desc: "Automatic discovery of physical connections via CDP/LLDP, merged with static topology.yaml",
    tech: "LibreNMS API + Redis cache",
    icon: "üîó",
    anchor: "cdp-lldp-discovery"
  },
  {
    name: "L2/L3 View Toggle",
    desc: "Switch between Physical (cable connections) and Logical (VLAN relationships) topology views",
    tech: "ReactFlow layout transforms",
    icon: "üîÄ",
    anchor: "l2l3-toggle"
  },
  {
    name: "Cisco-Style Port Grid",
    desc: "Visual switch port layout with real-time status colors and hover tooltips",
    tech: "Custom React components",
    icon: "üîå",
    anchor: "port-grid"
  },
  {
    name: "Proxmox Panel",
    desc: "Live dashboard of VMs, containers, and storage pools for selected hypervisor nodes",
    tech: "Proxmox API integration",
    icon: "üñ•Ô∏è",
    anchor: "proxmox-panel"
  },
  {
    name: "Speedtest Widget",
    desc: "Scheduled WAN health tests with CSV history and external link coloring",
    tech: "Ookla CLI + Redis cache",
    icon: "üì∂",
    anchor: "speedtest"
  },
  {
    name: "Port Group Monitoring",
    desc: "Aggregate traffic across ports matching a pattern (e.g., all lab ports)",
    tech: "SNMP ifOctets aggregation",
    icon: "üìä",
    anchor: "port-groups"
  },
  {
    name: "Port Search",
    desc: "Find switch ports by searching SNMP descriptions (ifAlias)",
    tech: "LibreNMS API query",
    icon: "üîç",
    anchor: "port-search"
  },
  {
    name: "Mermaid Export",
    desc: "Export topology as Mermaid diagram for documentation with built-in viewer",
    tech: "Frontend Mermaid generator",
    icon: "üìù",
    anchor: "mermaid-export"
  },
  {
    name: "Alert System",
    desc: "Real-time alerts from device status changes with acknowledgment",
    tech: "Derived from device state",
    icon: "üîî",
    anchor: "alert-system"
  },
];

// Tech decisions
const techDecisions = [
  { decision: "WebSocket over polling", reason: "Reduces latency and server load for real-time updates" },
  { decision: "Redis caching", reason: "Fast in-memory access for frequently-read topology data" },
  { decision: "Multi-source aggregation", reason: "No single monitoring tool has complete network visibility" },
  { decision: "ReactFlow for topology", reason: "Handles complex graph layouts with built-in pan/zoom/interactions" },
  { decision: "Zustand over Redux", reason: "Simpler state management for medium complexity app" },
  { decision: "APScheduler", reason: "Reliable job scheduling with configurable intervals per data type" },
  { decision: "YAML configuration", reason: "Human-readable, easy to version control (minus secrets)" },
  { decision: "TypeScript throughout", reason: "Type safety for complex nested data models" },
];

// Development phases
const phases = [
  { phase: 1, name: "Core Dashboard", status: "completed", items: ["FastAPI backend", "React frontend", "Basic topology"] },
  { phase: 2, name: "Dual-View Topology", status: "completed", items: ["L2/L3 toggle", "VLAN filtering", "Cluster nodes"] },
  { phase: 3, name: "Integrations", status: "completed", items: ["LibreNMS polling", "Proxmox panel", "Netdisco data"] },
  { phase: 4, name: "Auto-Discovery", status: "completed", items: ["CDP/LLDP links", "Dynamic topology", "Collision detection"] },
  { phase: 5, name: "Monitoring Widgets", status: "completed", items: ["Speedtest", "Port groups", "Port search"] },
  { phase: 6, name: "Export & Polish", status: "completed", items: ["Mermaid export", "CSV logging", "Collapsible widgets"] },
  { phase: 7, name: "Authentication", status: "pending", items: ["JWT auth", "User sessions", "Role-based access"] },
  { phase: 8, name: "Settings UI", status: "pending", items: ["Config editor", "Polling controls", "Theme options"] },
  { phase: 9, name: "Remote Notifications", status: "pending", items: ["Discord webhooks", "Email alerts", "Escalation rules"] },
];
---

<ProjectLayout frontmatter={frontmatter}>
  <!-- Overview -->
  <h2>// Overview</h2>
  <p>
    Watchtower is a self-hosted Network Operations Center dashboard that provides unified visibility into
    network infrastructure, virtualization platforms, and system health. It aggregates data from multiple
    monitoring systems into a single interactive topology visualization with live status updates via WebSocket.
  </p>

  <!-- GitHub Link -->
  <div class="github-callout">
    <div class="github-content">
      <div class="github-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
        </svg>
      </div>
      <div class="github-text">
        <span class="github-label">Open Source</span>
        <p class="github-desc">50+ commits, TypeScript 52% / Python 43%</p>
      </div>
    </div>
    <div class="github-actions">
      <a href="https://github.com/solomonneas/watchtower" target="_blank" class="github-btn repo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
        </svg>
        <span>View Repository</span>
      </a>
      <a href="https://github.com/solomonneas/watchtower/stargazers" target="_blank" class="github-btn star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
          <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.75.75 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"/>
        </svg>
        <span>Star on GitHub</span>
      </a>
    </div>
  </div>

  <!-- Cost Savings -->
  <h2>// The Numbers: Cost Avoidance</h2>
  <p class="section-intro">
    Enterprise monitoring platforms carry significant licensing costs. For a 200-endpoint departmental network, here's what commercial alternatives would cost:
  </p>

  <div class="cost-comparison">
    <div class="cost-card solarwinds">
      <div class="cost-header">
        <span class="cost-icon">üí∏</span>
        <span class="cost-label">SolarWinds (200 nodes)</span>
      </div>
      <div class="cost-body">
        <div class="cost-row">
          <span class="cost-key">Annual License</span>
          <span class="cost-value bad">$29,448</span>
        </div>
        <div class="cost-row">
          <span class="cost-key">Implementation + Training</span>
          <span class="cost-value bad">$5,000‚Äì$13,000</span>
        </div>
        <div class="cost-row">
          <span class="cost-key">3-Year TCO</span>
          <span class="cost-value bad">$110K‚Äì$150K</span>
        </div>
        <div class="cost-row">
          <span class="cost-key">Per Endpoint</span>
          <span class="cost-value bad">$147‚Äì$177/year</span>
        </div>
      </div>
    </div>

    <div class="cost-arrow">
      <div class="arrow-savings">
        <span class="savings-label">3-YEAR SAVINGS</span>
        <span class="savings-value">$110K‚Äì$150K</span>
      </div>
    </div>

    <div class="cost-card watchtower-card">
      <div class="cost-header">
        <span class="cost-icon">‚úì</span>
        <span class="cost-label">Watchtower</span>
      </div>
      <div class="cost-body">
        <div class="cost-row">
          <span class="cost-key">Annual License</span>
          <span class="cost-value good">$0</span>
        </div>
        <div class="cost-row">
          <span class="cost-key">Implementation</span>
          <span class="cost-value good">$0</span>
        </div>
        <div class="cost-row">
          <span class="cost-key">3-Year TCO</span>
          <span class="cost-value good">$0</span>
        </div>
        <div class="cost-row">
          <span class="cost-key">Per Endpoint</span>
          <span class="cost-value good">$0</span>
        </div>
      </div>
    </div>
  </div>

  <div class="savings-highlight">
    <div class="highlight-stat">
      <span class="stat-value">100% cost reduction</span>
      <span class="stat-label">200+ endpoints monitored at zero additional cost</span>
    </div>
  </div>

  <div class="value-context">
    <div class="context-item">
      <span class="context-icon">üèõÔ∏è</span>
      <div class="context-content">
        <span class="context-title">State College Spending</span>
        <span class="context-desc">Montgomery College: <a href="https://www.montgomerycountymd.gov/OMB/Resources/Files/omb/pdfs/fy27/ciprec/P076619.pdf" target="_blank">$4.1M/year</a> on NOC. UNC System: <a href="https://www.northcarolina.edu/apps/bog/doc.php?id=67354&code=bog" target="_blank">$5.35M/year</a> on network monitoring. <a href="https://campustechnology.com/articles/2019/07/08/number-of-institutions-with-it-networking-budgets-exceeding.aspx" target="_blank">48% of colleges</a> spend $750K‚Äì$2.5M annually.</span>
      </div>
    </div>
    <div class="context-item">
      <span class="context-icon">üìä</span>
      <div class="context-content">
        <span class="context-title">Market Context</span>
        <span class="context-desc"><a href="https://www.dirsec.com/insights/the-hidden-threat-why-83-of-universities-without-siem-and-identity-tools-are-vulnerable/" target="_blank">83% of universities</a> lack effective SIEM. Custom NOC development costs <a href="https://www.inoc.com/blog/costs-of-building-noc" target="_blank">$100K‚Äì$500K</a>. Average IT outage costs <a href="https://thenetworkinstallers.com/blog/cost-of-it-downtime-statistics/" target="_blank">$14,056/minute</a>.</span>
      </div>
    </div>
  </div>

  <p class="cost-sources">
    SolarWinds pricing: <a href="https://www.vendr.com/buyer-guides/solarwinds" target="_blank">Vendr</a> ¬∑ <a href="https://www.netdata.cloud/blog/solarwinds-price-increases-2025/" target="_blank">Netdata</a> ¬∑ <a href="https://www.manageengine.com/blog/itom/solarwinds-is-now-forcing-3year-subscription-heres-what-it-means-for-your-it-stack.html" target="_blank">ManageEngine</a>
  </p>

  <!-- Architecture -->
  <h2>// Architecture</h2>
  <div class="architecture">
    <!-- Data Sources Layer -->
    <div class="arch-layer sources">
      <span class="layer-label">DATA SOURCES</span>
      <div class="source-grid">
        {dataSources.map((src) => (
          <div class="source-card" style={`--accent: ${src.color}`}>
            <span class="source-name">{src.name}</span>
            <span class="source-type">{src.type}</span>
            <span class="source-provides">{src.provides}</span>
          </div>
        ))}
      </div>
    </div>

    <div class="arch-connector">
      <div class="connector-arrows">
        <span>‚ñº</span><span>‚ñº</span><span>‚ñº</span><span>‚ñº</span>
      </div>
      <span class="connector-label">Async Polling (httpx)</span>
    </div>

    <!-- Backend Layer -->
    <div class="arch-layer backend">
      <span class="layer-label">BACKEND</span>
      <div class="backend-flow">
        <div class="backend-box scheduler">
          <span class="box-title">APScheduler</span>
          <span class="box-desc">Polling jobs at 30s-300s intervals</span>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="backend-box aggregator">
          <span class="box-title">Aggregator</span>
          <span class="box-desc">Merges sources into unified model</span>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="backend-box redis">
          <span class="box-title">Redis</span>
          <span class="box-desc">In-memory cache</span>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="backend-box api">
          <span class="box-title">FastAPI</span>
          <span class="box-desc">REST + WebSocket</span>
        </div>
      </div>
    </div>

    <div class="arch-connector">
      <div class="connector-arrows">
        <span>‚ñº</span>
      </div>
      <span class="connector-label">WebSocket Push</span>
    </div>

    <!-- Frontend Layer -->
    <div class="arch-layer frontend">
      <span class="layer-label">FRONTEND</span>
      <div class="frontend-grid">
        <div class="frontend-box main">
          <span class="box-title">TopologyCanvas</span>
          <span class="box-desc">ReactFlow interactive map</span>
          <ul class="box-features">
            <li>Cluster nodes (expand/collapse)</li>
            <li>Device status indicators</li>
            <li>Animated link edges</li>
            <li>L2/L3 view toggle</li>
          </ul>
        </div>
        <div class="frontend-box sidebar">
          <span class="box-title">Sidebar Widgets</span>
          <span class="box-desc">Collapsible panels</span>
          <ul class="box-features">
            <li>Network Summary</li>
            <li>Speedtest Widget</li>
            <li>Port Groups</li>
            <li>Device Card + Port Grid</li>
          </ul>
        </div>
        <div class="frontend-box state">
          <span class="box-title">Zustand Store</span>
          <span class="box-desc">Global state + WS subscription</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Features -->
  <h2>// Features</h2>
  <div class="features-grid">
    {features.map((feat) => (
      feat.anchor ? (
        <a href={`#${feat.anchor}`} class="feature-card clickable">
          <div class="feature-header">
            <span class="feature-icon">{feat.icon}</span>
            <span class="feature-name">{feat.name}</span>
          </div>
          <p class="feature-desc">{feat.desc}</p>
          <span class="feature-tech">{feat.tech}</span>
        </a>
      ) : (
        <div class="feature-card">
          <div class="feature-header">
            <span class="feature-icon">{feat.icon}</span>
            <span class="feature-name">{feat.name}</span>
          </div>
          <p class="feature-desc">{feat.desc}</p>
          <span class="feature-tech">{feat.tech}</span>
        </div>
      )
    ))}
  </div>

  <!-- Data Flow Example -->
  <h2 id="data-flow">// Data Flow Example</h2>
  <p class="section-intro">How a device status change propagates through the system:</p>

  <div class="dataflow">
    <div class="flow-step" style="--step: 1">
      <div class="step-num">1</div>
      <div class="step-content">
        <span class="step-title">Detection</span>
        <span class="step-desc">APScheduler polls LibreNMS API at 30s interval</span>
      </div>
    </div>
    <div class="flow-connector"><div class="connector-pulse"></div></div>

    <div class="flow-step" style="--step: 2">
      <div class="step-num">2</div>
      <div class="step-content">
        <span class="step-title">Aggregation</span>
        <span class="step-desc">Device status change detected, Pydantic model updated</span>
      </div>
    </div>
    <div class="flow-connector"><div class="connector-pulse"></div></div>

    <div class="flow-step" style="--step: 3">
      <div class="step-num">3</div>
      <div class="step-content">
        <span class="step-title">Cache Update</span>
        <span class="step-desc">Redis CACHE_TOPOLOGY key updated with new state</span>
      </div>
    </div>
    <div class="flow-connector"><div class="connector-pulse"></div></div>

    <div class="flow-step" style="--step: 4">
      <div class="step-num">4</div>
      <div class="step-content">
        <span class="step-title">Broadcast</span>
        <span class="step-desc">WebSocket pushes delta to all connected clients</span>
      </div>
    </div>
    <div class="flow-connector"><div class="connector-pulse"></div></div>

    <div class="flow-step" style="--step: 5">
      <div class="step-num">5</div>
      <div class="step-content">
        <span class="step-title">State Update</span>
        <span class="step-desc">Zustand store receives message, updates React state</span>
      </div>
    </div>
    <div class="flow-connector"><div class="connector-pulse"></div></div>

    <div class="flow-step" style="--step: 6">
      <div class="step-num">6</div>
      <div class="step-content">
        <span class="step-title">Re-render</span>
        <span class="step-desc">Device node color changes, alert count increments</span>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: WebSocket Real-Time Updates -->
  <div class="feature-deepdive" id="websocket-updates">
    <h2>// Feature Deep Dive: WebSocket Real-Time Updates</h2>
    <p class="deepdive-intro">
      Bidirectional WebSocket connection that pushes device status changes, alert notifications, and speedtest
      results from the backend to all connected dashboard clients without requiring page refreshes or polling.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">‚ö°</span>
        <span class="usecase-title">Use Case: Instant Incident Detection</span>
      </div>
      <p class="usecase-desc">
        NOC operators need immediate notification when device status changes. Instead of waiting 30-60 seconds for
        the next poll cycle, the WebSocket pushes updates in real-time: a switch going down appears on the dashboard
        within seconds. This enables faster incident response and reduces mean time to detection (MTTD).
      </p>
    </div>

    <h3 class="deepdive-subhead">// Architecture</h3>
    <div class="ws-architecture">
      <div class="ws-layer scheduler">
        <div class="ws-layer-header">
          <span class="ws-layer-icon">‚è∞</span>
          <span class="ws-layer-title">POLLING SCHEDULER</span>
        </div>
        <div class="ws-pollers">
          <div class="ws-poller">
            <div class="poller-name">poll_devices()</div>
            <div class="poller-interval">Every 30s</div>
            <div class="poller-action">Fetch status from LibreNMS ‚Üí Compare previous vs current ‚Üí broadcast_status_changes()</div>
          </div>
          <div class="ws-poller">
            <div class="poller-name">poll_alerts()</div>
            <div class="poller-interval">Every 30s</div>
            <div class="poller-action">Detect new/resolved alerts ‚Üí broadcast_new_alerts() / broadcast_resolved_alerts()</div>
          </div>
          <div class="ws-poller">
            <div class="poller-name">run_speedtest()</div>
            <div class="poller-interval">Every 5m</div>
            <div class="poller-action">Run speedtest CLI ‚Üí broadcast_speedtest_result()</div>
          </div>
        </div>
      </div>

      <div class="ws-arrow-down">‚ñº broadcast()</div>

      <div class="ws-layer manager">
        <div class="ws-layer-header">
          <span class="ws-layer-icon">üîå</span>
          <span class="ws-layer-title">ConnectionManager (ws_manager)</span>
        </div>
        <div class="ws-manager-content">
          <code>active_connections: list[WebSocket]</code>
          <div class="ws-manager-flow">
            <span>broadcast(message)</span>
            <span class="ws-flow-arrow">‚Üí</span>
            <span>For each connection: await connection.send_json(message)</span>
          </div>
        </div>
      </div>

      <div class="ws-arrow-down">‚ñº send_json()</div>

      <div class="ws-layer clients">
        <div class="ws-layer-header">
          <span class="ws-layer-icon">üñ•Ô∏è</span>
          <span class="ws-layer-title">WEBSOCKET CLIENTS</span>
        </div>
        <div class="ws-clients-grid">
          <div class="ws-client">Browser Tab 1</div>
          <div class="ws-client">Browser Tab 2</div>
          <div class="ws-client">Browser Tab 3</div>
        </div>
        <div class="ws-hook">
          <div class="ws-hook-name">useWebSocket() hook</div>
          <div class="ws-hook-handlers">
            <div class="ws-handler">
              <span class="handler-msg">device_status_change</span>
              <span class="handler-arrow">‚Üí</span>
              <span class="handler-action">updateDeviceStatus() ‚Üí Canvas rerender</span>
            </div>
            <div class="ws-handler">
              <span class="handler-msg">new_alerts</span>
              <span class="handler-arrow">‚Üí</span>
              <span class="handler-action">addAlert() ‚Üí Toast + Bell badge</span>
            </div>
            <div class="ws-handler">
              <span class="handler-msg">alerts_resolved</span>
              <span class="handler-arrow">‚Üí</span>
              <span class="handler-action">removeAlert() ‚Üí Toast removed</span>
            </div>
            <div class="ws-handler">
              <span class="handler-msg">speedtest_result</span>
              <span class="handler-arrow">‚Üí</span>
              <span class="handler-action">setSpeedtestStatus() ‚Üí WAN link color</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Message Types: Server ‚Üí Client</h3>
    <div class="ws-messages-grid">
      <div class="ws-message-card">
        <div class="ws-msg-header">
          <span class="ws-msg-type">connected</span>
        </div>
        <div class="ws-msg-desc">Sent immediately after WebSocket connection established</div>
        <div class="ws-msg-payload">
          <pre><code>{`{
  "type": "connected",
  "message": "Connected to Watchtower"
}`}</code></pre>
        </div>
      </div>

      <div class="ws-message-card">
        <div class="ws-msg-header">
          <span class="ws-msg-type">device_status_change</span>
        </div>
        <div class="ws-msg-desc">Sent when device status changes (up ‚Üî down)</div>
        <div class="ws-msg-payload">
          <pre><code>{`{
  "type": "device_status_change",
  "timestamp": "2026-01-28T10:42:15.123Z",
  "changes": [{
    "device_id": 42,
    "hostname": "cat-1.corp.local",
    "old_status": "up",
    "new_status": "down"
  }]
}`}</code></pre>
        </div>
      </div>

      <div class="ws-message-card">
        <div class="ws-msg-header">
          <span class="ws-msg-type">new_alerts</span>
        </div>
        <div class="ws-msg-desc">Sent when new LibreNMS alerts fire</div>
        <div class="ws-msg-payload">
          <pre><code>{`{
  "type": "new_alerts",
  "timestamp": "2026-01-28T10:42:15.123Z",
  "alerts": [{
    "id": 4521,
    "device_id": 42,
    "hostname": "cat-1.corp.local",
    "severity": "critical",
    "title": "Device unreachable"
  }]
}`}</code></pre>
        </div>
      </div>

      <div class="ws-message-card">
        <div class="ws-msg-header">
          <span class="ws-msg-type">alerts_resolved</span>
        </div>
        <div class="ws-msg-desc">Sent when alerts are cleared (device recovered)</div>
        <div class="ws-msg-payload">
          <pre><code>{`{
  "type": "alerts_resolved",
  "timestamp": "2026-01-28T10:45:30.456Z",
  "alert_ids": [4521, 4522]
}`}</code></pre>
        </div>
      </div>

      <div class="ws-message-card">
        <div class="ws-msg-header">
          <span class="ws-msg-type">speedtest_result</span>
        </div>
        <div class="ws-msg-desc">Sent after each speedtest completes</div>
        <div class="ws-msg-payload">
          <pre><code>{`{
  "type": "speedtest_result",
  "timestamp": "2026-01-28T10:45:00.000Z",
  "result": {
    "download_mbps": 245.5,
    "upload_mbps": 125.3,
    "ping_ms": 12.5,
    "indicator": "normal"
  }
}`}</code></pre>
        </div>
      </div>

      <div class="ws-message-card keepalive">
        <div class="ws-msg-header">
          <span class="ws-msg-type">ping / pong</span>
        </div>
        <div class="ws-msg-desc">Keepalive messages (client sends ping every 30s)</div>
        <div class="ws-msg-payload">
          <pre><code>{`{ "type": "ping" }  // Client ‚Üí Server
{ "type": "pong" }  // Server ‚Üí Client`}</code></pre>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Connection Lifecycle</h3>
    <div class="ws-lifecycle">
      <div class="lifecycle-row">
        <div class="lifecycle-client">CLIENT</div>
        <div class="lifecycle-arrow"></div>
        <div class="lifecycle-server">SERVER</div>
      </div>
      <div class="lifecycle-event">
        <div class="lifecycle-msg outgoing">new WebSocket('/ws/updates')</div>
        <div class="lifecycle-action">ws_manager.connect(ws)<br/>active_connections.append(ws)</div>
      </div>
      <div class="lifecycle-event">
        <div class="lifecycle-msg incoming">{`{"type": "connected", ...}`}</div>
        <div class="lifecycle-action"></div>
      </div>
      <div class="lifecycle-event">
        <div class="lifecycle-msg outgoing">{`{"type": "ping"}`}</div>
        <div class="lifecycle-note">every 30s</div>
      </div>
      <div class="lifecycle-event">
        <div class="lifecycle-msg incoming">{`{"type": "pong"}`}</div>
        <div class="lifecycle-action"></div>
      </div>
      <div class="lifecycle-event">
        <div class="lifecycle-msg incoming">{`{"type": "device_status_change", ...}`}</div>
        <div class="lifecycle-action">poll_devices() detects change</div>
      </div>
      <div class="lifecycle-event disconnect">
        <div class="lifecycle-msg">Connection lost / closed</div>
        <div class="lifecycle-action">ws_manager.disconnect(ws)<br/>active_connections.remove(ws)</div>
      </div>
      <div class="lifecycle-reconnect">
        <div class="reconnect-label">Exponential backoff reconnect</div>
        <div class="reconnect-delays">1s ‚Üí 2s ‚Üí 4s ‚Üí 8s ‚Üí 16s ‚Üí 30s max</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Reconnection Strategy</h3>
    <div class="reconnect-flow">
      <div class="reconnect-step trigger">
        <span class="step-label">DISCONNECTION DETECTED</span>
      </div>
      <div class="reconnect-arrow">‚ñº</div>
      <div class="reconnect-step calc">
        <span class="step-label">Calculate backoff delay</span>
        <code>delay = min(1000 * 2^attempts, 30000)</code>
      </div>
      <div class="reconnect-delays-table">
        <div class="delay-row"><span>attempt 0:</span><span>1000ms (1s)</span></div>
        <div class="delay-row"><span>attempt 1:</span><span>2000ms (2s)</span></div>
        <div class="delay-row"><span>attempt 2:</span><span>4000ms (4s)</span></div>
        <div class="delay-row"><span>attempt 3:</span><span>8000ms (8s)</span></div>
        <div class="delay-row"><span>attempt 4:</span><span>16000ms (16s)</span></div>
        <div class="delay-row"><span>attempt 5+:</span><span>30000ms (30s max)</span></div>
      </div>
      <div class="reconnect-arrow">‚ñº</div>
      <div class="reconnect-step wait">
        <span class="step-label">setTimeout(reconnect, delay)</span>
      </div>
      <div class="reconnect-arrow">‚ñº</div>
      <div class="reconnect-step attempt">
        <span class="step-label">Attempt connection</span>
        <div class="attempt-outcomes">
          <span class="outcome success">SUCCESS ‚Üí reconnectAttempts = 0</span>
          <span class="outcome failure">FAILURE ‚Üí goto "Calculate backoff"</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Device Hostname Matching</h3>
    <div class="hostname-matching">
      <div class="matching-problem">
        <div class="problem-label">PROBLEM</div>
        <div class="problem-content">
          <div class="problem-row">
            <span class="problem-source">LibreNMS sends:</span>
            <code>"cat-1.corp.local"</code>
          </div>
          <div class="problem-row">
            <span class="problem-source">Topology uses:</span>
            <code>"cat-1"</code>
          </div>
        </div>
      </div>
      <div class="matching-algorithm">
        <div class="algo-header">ALGORITHM: findTopologyDeviceId(hostname, devices)</div>
        <div class="algo-steps">
          <div class="algo-step">
            <span class="step-num">1</span>
            <div class="step-content">
              <span class="step-name">IP Address Match</span>
              <span class="step-logic">IF device.ip === hostname ‚Üí RETURN device.id</span>
            </div>
          </div>
          <div class="algo-step">
            <span class="step-num">2</span>
            <div class="step-content">
              <span class="step-name">Fuzzy Hostname Match</span>
              <span class="step-logic">IF hostname.toLowerCase().includes(device_id.toLowerCase()) ‚Üí RETURN device.id</span>
              <span class="step-example">Example: "cat-1.corp.local".includes("cat-1") ‚Üí true</span>
            </div>
          </div>
          <div class="algo-step">
            <span class="step-num">3</span>
            <div class="step-content">
              <span class="step-name">No Match</span>
              <span class="step-logic">RETURN null, log warning</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Component Structure</h3>
    <div class="ws-component-split">
      <div class="ws-component-col backend">
        <div class="component-col-header">Backend (Python/FastAPI)</div>
        <div class="component-tree">
          <div class="tree-file">websocket.py
            <div class="tree-contents">
              <span>ConnectionManager</span>
              <span class="tree-indent">‚îú‚îÄ active_connections: list[WebSocket]</span>
              <span class="tree-indent">‚îú‚îÄ connect(ws) ‚Üí add to list</span>
              <span class="tree-indent">‚îú‚îÄ disconnect(ws) ‚Üí remove from list</span>
              <span class="tree-indent">‚îî‚îÄ broadcast(msg) ‚Üí send to all</span>
              <span>ws_manager (singleton)</span>
              <span>websocket_endpoint(ws)</span>
            </div>
          </div>
          <div class="tree-file">main.py
            <div class="tree-contents">
              <span>app.websocket("/ws/updates")</span>
            </div>
          </div>
          <div class="tree-file">polling/scheduler.py
            <div class="tree-contents">
              <span>broadcast_status_changes()</span>
              <span>broadcast_new_alerts()</span>
              <span>broadcast_resolved_alerts()</span>
              <span>broadcast_speedtest_result()</span>
            </div>
          </div>
        </div>
      </div>

      <div class="ws-component-col frontend">
        <div class="component-col-header">Frontend (React/TypeScript)</div>
        <div class="component-tree">
          <div class="tree-file">hooks/useWebSocket.ts
            <div class="tree-contents">
              <span>State: isConnected, wsRef, reconnectAttempts</span>
              <span>handleMessage()</span>
              <span class="tree-indent">‚îú‚îÄ "connected" ‚Üí console.log</span>
              <span class="tree-indent">‚îú‚îÄ "device_status_change" ‚Üí updateDeviceStatus()</span>
              <span class="tree-indent">‚îú‚îÄ "new_alerts" ‚Üí addAlert()</span>
              <span class="tree-indent">‚îú‚îÄ "alerts_resolved" ‚Üí removeAlert()</span>
              <span class="tree-indent">‚îî‚îÄ "speedtest_result" ‚Üí setSpeedtestStatus()</span>
              <span>connect(), disconnect()</span>
            </div>
          </div>
          <div class="tree-file">store/nocStore.ts
            <div class="tree-contents">
              <span>isConnected: boolean</span>
              <span>updateDeviceStatus()</span>
              <span>updateAlertCount()</span>
              <span>setSpeedtestStatus()</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// URL Construction</h3>
    <div class="url-construction">
      <div class="url-code">
        <pre><code>const WS_URL = `$&#123;
  window.location.protocol === 'https:' ? 'wss:' : 'ws:'
&#125;//$&#123;window.location.host&#125;/ws/updates`</code></pre>
      </div>
      <div class="url-examples">
        <div class="url-example">
          <span class="url-input">http://watchtower.local:5173</span>
          <span class="url-arrow">‚Üí</span>
          <span class="url-output">ws://watchtower.local:5173/ws/updates</span>
        </div>
        <div class="url-example">
          <span class="url-input">https://watchtower.example.com</span>
          <span class="url-arrow">‚Üí</span>
          <span class="url-output">wss://watchtower.example.com/ws/updates</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Debug Helper (Browser Console)</h3>
    <div class="debug-helper">
      <div class="debug-intro">Exposed via <code>window.watchtower</code> in App.tsx:</div>
      <div class="debug-commands">
        <div class="debug-cmd">
          <code>window.watchtower.setDeviceDown('cat-1')</code>
          <span class="debug-desc">Simulate device going down</span>
        </div>
        <div class="debug-cmd">
          <code>window.watchtower.setDeviceUp('cat-1')</code>
          <span class="debug-desc">Simulate device coming back up</span>
        </div>
        <div class="debug-cmd">
          <code>window.watchtower.listDevices()</code>
          <span class="debug-desc">List all devices and their status</span>
        </div>
        <div class="debug-cmd">
          <code>window.watchtower.setSpeedtestDown()</code>
          <span class="debug-desc">Red external links</span>
        </div>
        <div class="debug-cmd">
          <code>window.watchtower.setSpeedtestDegraded()</code>
          <span class="debug-desc">Yellow external links</span>
        </div>
        <div class="debug-cmd">
          <code>window.watchtower.setSpeedtestNormal()</code>
          <span class="debug-desc">Green external links</span>
        </div>
        <div class="debug-cmd">
          <code>window.watchtower.getStore()</code>
          <span class="debug-desc">Get full store state</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Implementation Details</h3>
    <div class="tech-table">
      <div class="tech-row header">
        <span class="tech-label">Aspect</span>
        <span class="tech-value">Implementation</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Protocol</span>
        <span class="tech-value">WebSocket (RFC 6455)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Endpoint</span>
        <span class="tech-value">/ws/updates</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Protocol auto-detect</span>
        <span class="tech-value">ws:// for HTTP, wss:// for HTTPS</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Ping interval</span>
        <span class="tech-value">30 seconds (client ‚Üí server)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Reconnect delays</span>
        <span class="tech-value">1s, 2s, 4s, 8s, 16s, 30s max</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Connection tracking</span>
        <span class="tech-value">ws_manager.active_connections list</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Thread safety</span>
        <span class="tech-value">asyncio.Lock() for connection list</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Message format</span>
        <span class="tech-value">JSON (send_json / JSON.parse)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Device matching</span>
        <span class="tech-value">Fuzzy hostname matching with IP fallback</span>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Interactive Topology Canvas -->
  <div class="feature-deepdive" id="topology-canvas">
    <h2>// Feature Deep Dive: Interactive Topology Canvas</h2>
    <p class="deepdive-intro">
      The core visualization engine that renders the physical network topology using ReactFlow. Features
      expandable device clusters, automatic collision detection, drag-and-drop positioning with localStorage
      persistence, and dynamic edge routing that adapts to expanded/collapsed states.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üó∫Ô∏è</span>
        <span class="usecase-title">Use Case: At-a-Glance Network View with Drill-Down</span>
      </div>
      <p class="usecase-desc">
        NOC operators need to see the entire network at a glance while being able to drill down into specific
        clusters. The canvas provides an interactive map where clusters can be expanded to show individual devices,
        nodes can be dragged to custom positions (persisted across sessions), and the layout automatically adjusts
        to prevent overlapping nodes.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Architecture</h3>
    <div class="topology-arch-flow">
      <div class="arch-source">
        <div class="arch-source-label">TOPOLOGY DATA (from WebSocket)</div>
        <div class="arch-source-items">
          <span>topology.clusters[]</span>
          <span>topology.devices{}</span>
          <span>topology.connections[]</span>
          <span>topology.external_links[]</span>
        </div>
      </div>
      <div class="arch-arrow-down">‚ñº</div>

      <div class="arch-processor">
        <div class="proc-header">topologyToNodes()</div>
        <div class="proc-logic">
          <div class="proc-rule">
            <span class="rule-condition">For each cluster:</span>
            <span class="rule-if">IF expanded ‚Üí</span>
            <span class="rule-result">Create DeviceNode for each device (grid layout)</span>
          </div>
          <div class="proc-rule">
            <span class="rule-condition"></span>
            <span class="rule-if">ELSE ‚Üí</span>
            <span class="rule-result">Create ClusterNode (collapsed view)</span>
          </div>
          <div class="proc-rule">
            <span class="rule-condition">For each external_link:</span>
            <span class="rule-if">‚Üí</span>
            <span class="rule-result">Create ExternalNode (WAN endpoints)</span>
          </div>
        </div>
      </div>
      <div class="arch-arrow-down">‚ñº</div>

      <div class="arch-processor collision">
        <div class="proc-header">resolveOverlaps()</div>
        <div class="proc-steps">
          <span class="proc-step">1. Calculate bounding boxes for all nodes</span>
          <span class="proc-step">2. Check each pair for collision</span>
          <span class="proc-step">3. Push overlapping nodes apart</span>
          <span class="proc-step">4. Repeat until no overlaps (max 50 iterations)</span>
        </div>
      </div>
      <div class="arch-arrow-down">‚ñº</div>

      <div class="arch-renderer">
        <div class="renderer-header">ReactFlow Canvas</div>
        <div class="renderer-controls">
          <span class="control-item">Pan: Click + Drag background</span>
          <span class="control-item">Zoom: Scroll wheel (0.2x - 2x)</span>
          <span class="control-item">Select: Click node ‚Üí sidebar details</span>
          <span class="control-item">Expand: Double-click cluster ‚Üí show devices</span>
          <span class="control-item">Collapse: Double-click device ‚Üí hide cluster</span>
          <span class="control-item">Move: Drag node ‚Üí position saved to localStorage</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Layout: Collapsed View</h3>
    <p class="layout-desc">Default view shows clusters as single nodes with device status indicators:</p>

    <div class="canvas-mockup collapsed-view">
      <div class="canvas-toolbar">
        <span class="toolbar-btn active">Physical (L2)</span>
        <span class="toolbar-btn">Logical (L3)</span>
        <span class="toolbar-spacer"></span>
        <span class="toolbar-btn">Reset Layout</span>
      </div>
      <div class="canvas-area">
        <div class="mock-cluster firewalls" style="--x: 10%; --y: 20%;">
          <div class="cluster-icon">üõ°Ô∏è</div>
          <div class="cluster-label">Firewalls</div>
          <div class="cluster-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
          </div>
          <div class="cluster-summary">2 devices | All healthy</div>
        </div>

        <div class="mock-edge h1" style="--x1: 22%; --y1: 28%; --x2: 38%; --y2: 28%;"></div>

        <div class="mock-cluster core" style="--x: 40%; --y: 20%;">
          <div class="cluster-icon">üîå</div>
          <div class="cluster-label">Core Network</div>
          <div class="cluster-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
          </div>
          <div class="cluster-summary">3 devices | All healthy</div>
        </div>

        <div class="mock-edge h2" style="--x1: 60%; --y1: 28%; --x2: 78%; --y2: 28%;"></div>

        <div class="mock-external" style="--x: 80%; --y: 20%;">
          <div class="external-glow"></div>
          <div class="external-content">
            <span class="external-icon-lg">‚òÅ</span>
            <span class="external-label">Internet</span>
          </div>
        </div>

        <div class="mock-edge v1" style="--x1: 17%; --y1: 42%; --x2: 17%; --y2: 58%;"></div>
        <div class="mock-edge v2" style="--x1: 52%; --y1: 42%; --x2: 52%; --y2: 58%;"></div>

        <div class="mock-cluster servers" style="--x: 10%; --y: 60%;">
          <div class="cluster-icon">üñ•Ô∏è</div>
          <div class="cluster-label">Servers</div>
          <div class="cluster-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
          </div>
          <div class="cluster-summary">4 devices | All healthy</div>
        </div>

        <div class="mock-cluster access warning" style="--x: 40%; --y: 60%;">
          <div class="cluster-icon">üì°</div>
          <div class="cluster-label">Access Layer</div>
          <div class="cluster-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot down"></span>
          </div>
          <div class="cluster-summary">3 devices | 1 down</div>
        </div>

        <div class="canvas-hint">Double-click cluster to expand</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Layout: Expanded View</h3>
    <p class="layout-desc">When a cluster is expanded, individual devices are shown in a grid layout:</p>

    <div class="canvas-mockup expanded-view">
      <div class="canvas-toolbar">
        <span class="toolbar-btn active">Physical (L2)</span>
        <span class="toolbar-btn">Logical (L3)</span>
        <span class="toolbar-spacer"></span>
        <span class="toolbar-btn">Reset Layout</span>
      </div>
      <div class="canvas-area">
        <div class="mock-cluster firewalls small" style="--x: 5%; --y: 35%;">
          <div class="cluster-label">Firewalls</div>
          <div class="cluster-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
          </div>
        </div>

        <div class="mock-edge h-exp" style="--x1: 16%; --y1: 42%; --x2: 24%; --y2: 30%;"></div>

        <div class="expanded-cluster-box" style="--x: 25%; --y: 10%;">
          <div class="expanded-header">Core Network (expanded)</div>
          <div class="expanded-devices">
            <div class="mock-device">
              <span class="device-status up"></span>
              <span class="device-name">cat-1</span>
              <span class="device-ip">10.2.10.1</span>
            </div>
            <div class="mock-device">
              <span class="device-status up"></span>
              <span class="device-name">cat-2</span>
              <span class="device-ip">10.2.10.2</span>
            </div>
            <div class="mock-device">
              <span class="device-status up"></span>
              <span class="device-name">cat-3</span>
              <span class="device-ip">10.2.10.3</span>
            </div>
          </div>
        </div>

        <div class="mock-edge v-exp" style="--x1: 48%; --y1: 55%; --x2: 48%; --y2: 72%;"></div>

        <div class="mock-cluster access small" style="--x: 35%; --y: 75%;">
          <div class="cluster-label">Access Layer</div>
          <div class="cluster-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot down"></span>
          </div>
        </div>

        <div class="canvas-hint">Double-click device to collapse cluster</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Node Types</h3>
    <div class="node-types-grid">
      <div class="node-type-card">
        <div class="node-type-header">ClusterNode (collapsed)</div>
        <div class="node-type-mockup cluster-node-mock">
          <div class="cnm-icon">üîå</div>
          <div class="cnm-name">Core Network</div>
          <div class="cnm-divider"></div>
          <div class="cnm-dots">
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
            <span class="dot up"></span>
          </div>
          <div class="cnm-divider"></div>
          <div class="cnm-summary">8 devices &nbsp;&nbsp; All healthy</div>
          <div class="cnm-handles">
            <span class="handle top"></span>
            <span class="handle right"></span>
            <span class="handle bottom"></span>
            <span class="handle left"></span>
          </div>
        </div>
        <div class="node-type-action">Double-click to expand</div>
      </div>

      <div class="node-type-card">
        <div class="node-type-header">DeviceNode (expanded)</div>
        <div class="node-type-mockup device-node-mock">
          <div class="dnm-status up"></div>
          <div class="dnm-info">
            <span class="dnm-name">cat-1</span>
            <span class="dnm-ip">10.2.10.1</span>
          </div>
          <div class="dnm-handles">
            <span class="handle top"></span>
            <span class="handle right"></span>
            <span class="handle bottom"></span>
            <span class="handle left"></span>
          </div>
        </div>
        <div class="node-type-action">Double-click to collapse cluster</div>
      </div>

      <div class="node-type-card">
        <div class="node-type-header">ExternalNode (WAN)</div>
        <div class="node-type-mockup external-node-mock">
          <div class="enm-glow"></div>
          <div class="enm-icon">‚òÅ</div>
          <div class="enm-label">Internet</div>
        </div>
        <div class="node-type-desc">Glowing border color reflects speedtest status</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Collision Detection Algorithm</h3>
    <div class="algorithm-block">
      <div class="algo-section">
        <div class="algo-label">INPUT</div>
        <div class="algo-content">nodes[] after position assignment</div>
      </div>
      <div class="algo-section">
        <div class="algo-label">CONSTANTS</div>
        <div class="algo-content">
          <code>NODE_SIZES = {`{ cluster: 180√ó120, device: 160√ó80, external: 140√ó100 }`}</code><br/>
          <code>PADDING = 40px</code>
        </div>
      </div>
      <div class="algo-section">
        <div class="algo-label">STEP 1</div>
        <div class="algo-content">
          Calculate bounding boxes for each node:<br/>
          <code>box = {`{ x: node.x - PADDING, y: node.y - PADDING, width: size + PADDING*2, height: size + PADDING*2 }`}</code>
        </div>
      </div>
      <div class="algo-section">
        <div class="algo-label">STEP 2</div>
        <div class="algo-content">
          Check for overlaps:<br/>
          <code>boxesOverlap(a, b) = !(a.right &lt; b.x || b.right &lt; a.x || a.bottom &lt; b.y || b.bottom &lt; a.y)</code>
        </div>
      </div>
      <div class="algo-section">
        <div class="algo-label">STEP 3</div>
        <div class="algo-content">
          Calculate push vector (push along shortest overlap axis):<br/>
          <code>IF overlapX &lt; overlapY ‚Üí push horizontally ELSE ‚Üí push vertically</code>
        </div>
      </div>
      <div class="algo-section">
        <div class="algo-label">STEP 4</div>
        <div class="algo-content">
          Iterate until resolved:<br/>
          <code>WHILE hasOverlap AND iteration &lt; 50: recalculate, check pairs, apply push</code>
        </div>
      </div>
      <div class="algo-section">
        <div class="algo-label">OUTPUT</div>
        <div class="algo-content">nodes[] with non-overlapping positions</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Position Persistence</h3>
    <div class="persistence-block">
      <div class="persist-key">
        <span class="persist-label">localStorage Key:</span>
        <code>watchtower-node-positions</code>
      </div>
      <div class="persist-structure">
        <div class="persist-header">Stored Structure:</div>
        <pre><code>{`{
  "cluster-core": { "x": 450, "y": 150 },
  "cluster-servers": { "x": 450, "y": 450 },
  "cat-1": { "x": 350, "y": 120 },
  "cat-2": { "x": 550, "y": 120 },
  "external-Internet": { "x": 80, "y": 150 }
}`}</code></pre>
      </div>
      <div class="persist-triggers">
        <div class="trigger-item">
          <span class="trigger-event">Save:</span>
          <span class="trigger-when">On drag end (when <code>dragging === false</code>)</span>
        </div>
        <div class="trigger-item">
          <span class="trigger-event">Load:</span>
          <span class="trigger-when">On component mount</span>
        </div>
        <div class="trigger-item">
          <span class="trigger-event">Reset:</span>
          <span class="trigger-when">Clear localStorage, regenerate auto-layout</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Event Handlers</h3>
    <div class="tech-table">
      <div class="tech-row header">
        <span class="tech-label">Event</span>
        <span class="tech-value">Action</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Single click device</span>
        <span class="tech-value">selectDevice(id) ‚Üí opens sidebar detail panel</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Single click cluster</span>
        <span class="tech-value">No action (expands on double-click)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Double-click cluster</span>
        <span class="tech-value">toggleClusterExpanded(id) ‚Üí expand to show devices</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Double-click device</span>
        <span class="tech-value">toggleClusterExpanded(clusterId) ‚Üí collapse back</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Drag node</span>
        <span class="tech-value">Update position, save to localStorage on drop</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Scroll wheel</span>
        <span class="tech-value">Zoom in/out (0.2x - 2x range)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Click + drag background</span>
        <span class="tech-value">Pan the canvas</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Grid Layout for Expanded Devices</h3>
    <div class="grid-layout-block">
      <div class="grid-algo">
        <div class="grid-step">
          <span class="step-num">1</span>
          <span class="step-text">Determine grid: <code>cols = min(3, deviceCount)</code>, <code>rows = ceil(deviceCount / cols)</code></span>
        </div>
        <div class="grid-step">
          <span class="step-num">2</span>
          <span class="step-text">Spacing: <code>spacingX = 200px</code>, <code>spacingY = 120px</code></span>
        </div>
        <div class="grid-step">
          <span class="step-num">3</span>
          <span class="step-text">Center on cluster position: <code>startX = cluster.x - gridWidth / 2</code></span>
        </div>
        <div class="grid-step">
          <span class="step-num">4</span>
          <span class="step-text">Position each device: <code>x = startX + (i % cols) * spacingX</code></span>
        </div>
      </div>
      <div class="grid-example">
        <div class="grid-example-header">Example: 8 devices at cluster (450, 300)</div>
        <div class="grid-visual">
          <div class="grid-row">
            <span class="grid-cell">[0]</span>
            <span class="grid-dash">‚îÄ‚îÄ‚îÄ</span>
            <span class="grid-cell">[1]</span>
            <span class="grid-dash">‚îÄ‚îÄ‚îÄ</span>
            <span class="grid-cell">[2]</span>
          </div>
          <div class="grid-vline">‚îÇ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‚îÇ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‚îÇ</div>
          <div class="grid-row">
            <span class="grid-cell">[3]</span>
            <span class="grid-dash">‚îÄ‚îÄ‚îÄ</span>
            <span class="grid-cell">[4]</span>
            <span class="grid-dash">‚îÄ‚îÄ‚îÄ</span>
            <span class="grid-cell">[5]</span>
          </div>
          <div class="grid-vline">‚îÇ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‚îÇ</div>
          <div class="grid-row">
            <span class="grid-cell">[6]</span>
            <span class="grid-dash">‚îÄ‚îÄ‚îÄ</span>
            <span class="grid-cell">[7]</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Edge Routing</h3>
    <div class="edge-routing-block">
      <p class="routing-intro">Edges dynamically connect based on cluster expansion state:</p>
      <div class="routing-rules">
        <div class="routing-rule">
          <span class="rule-condition">Both expanded:</span>
          <span class="rule-result">device ‚Üí device</span>
        </div>
        <div class="routing-rule">
          <span class="rule-condition">Source expanded, target collapsed:</span>
          <span class="rule-result">device ‚Üí cluster</span>
        </div>
        <div class="routing-rule">
          <span class="rule-condition">Source collapsed, target expanded:</span>
          <span class="rule-result">cluster ‚Üí device</span>
        </div>
        <div class="routing-rule">
          <span class="rule-condition">Both collapsed:</span>
          <span class="rule-result">cluster ‚Üí cluster</span>
        </div>
      </div>
      <p class="routing-note">Edges are deduplicated: only one edge per node pair using sorted key.</p>
    </div>

    <h3 class="deepdive-subhead">// Component Hierarchy</h3>
    <div class="component-tree">
      <div class="tree-node root">
        <span class="tree-name">TopologyCanvas.tsx</span>
        <span class="tree-desc">(wrapper with ReactFlowProvider)</span>
      </div>
      <div class="tree-children">
        <div class="tree-node">
          <span class="tree-name">TopologyCanvasInner</span>
        </div>
        <div class="tree-grandchildren">
          <div class="tree-leaf">useNocStore (topology, expandedClusters, selectDevice)</div>
          <div class="tree-leaf">savedPositionsRef (localStorage persistence)</div>
          <div class="tree-leaf">processedNodes = useMemo(() => topologyToNodes ‚Üí resolveOverlaps)</div>
          <div class="tree-leaf">initialEdges = useMemo(() => topologyToEdges)</div>
          <div class="tree-node nested">
            <span class="tree-name">ReactFlow</span>
          </div>
          <div class="tree-deep">
            <div class="tree-leaf">nodeTypes: {`{ cluster, device, external, vlanGroup }`}</div>
            <div class="tree-leaf">edgeTypes: {`{ traffic, physical }`}</div>
            <div class="tree-leaf">&lt;Background /&gt; (grid pattern)</div>
            <div class="tree-leaf">&lt;Controls /&gt; (zoom buttons)</div>
            <div class="tree-leaf">&lt;Panel position="top-right"&gt; (view toggle, reset)</div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Implementation Details</h3>
    <div class="tech-table">
      <div class="tech-row header">
        <span class="tech-label">Aspect</span>
        <span class="tech-value">Implementation</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">ReactFlow version</span>
        <span class="tech-value">@xyflow/react (v12+)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Min/Max zoom</span>
        <span class="tech-value">0.2x - 2x</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Collision padding</span>
        <span class="tech-value">40px between nodes</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Max collision iterations</span>
        <span class="tech-value">50</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Grid columns (expanded)</span>
        <span class="tech-value">Max 3 devices per row</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Device spacing</span>
        <span class="tech-value">200px √ó 120px</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Cluster spacing</span>
        <span class="tech-value">450px √ó 350px</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Position save trigger</span>
        <span class="tech-value">On drag end (dragging === false)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Fit view padding</span>
        <span class="tech-value">0.2 (20%)</span>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: CDP/LLDP Link Discovery -->
  <div class="feature-deepdive" id="cdp-lldp-discovery">
    <h2>// Feature Deep Dive: CDP/LLDP Link Discovery</h2>
    <p class="deepdive-intro">
      Automatic discovery of physical network connections by polling CDP (Cisco Discovery Protocol) and LLDP
      (Link Layer Discovery Protocol) neighbor data from LibreNMS. Discovered links are merged with static
      topology.yaml connections to create a complete network map.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üîó</span>
        <span class="usecase-title">Use Case: Automated Cable Documentation</span>
      </div>
      <p class="usecase-desc">
        Manually documenting every cable connection in a network is tedious and error-prone. CDP/LLDP discovery
        automates this: switches advertise their neighbors, LibreNMS collects this data via SNMP, and Watchtower
        polls it to build the topology graph automatically. Static connections in topology.yaml fill gaps for
        devices that don't support CDP/LLDP (firewalls, servers, APs).
      </p>
    </div>

    <h3 class="deepdive-subhead">// Architecture</h3>
    <div class="cdp-architecture">
      <div class="cdp-layer infrastructure">
        <div class="cdp-layer-header">
          <span class="cdp-layer-icon">üåê</span>
          <span class="cdp-layer-title">NETWORK INFRASTRUCTURE</span>
        </div>
        <div class="cdp-switches">
          <div class="cdp-switch">
            <span class="switch-name">cat-1</span>
            <span class="switch-type">(switch)</span>
          </div>
          <div class="cdp-arrow-bidir">‚óÑ‚îÄ CDP/LLDP ‚îÄ‚ñ∫</div>
          <div class="cdp-switch">
            <span class="switch-name">cat-2</span>
            <span class="switch-type">(switch)</span>
          </div>
          <div class="cdp-arrow-bidir">‚óÑ‚îÄ CDP/LLDP ‚îÄ‚ñ∫</div>
          <div class="cdp-switch more">...</div>
        </div>
        <div class="cdp-snmp-flow">
          <span class="snmp-label">SNMP polling</span>
          <span class="snmp-arrow">‚ñº</span>
        </div>
        <div class="cdp-librenms">
          <div class="librenms-header">LibreNMS</div>
          <div class="librenms-endpoint">
            <code>/api/v0/resources/links</code>
          </div>
          <div class="librenms-returns">
            Returns: local_device_id, local_port_id, remote_device_id, remote_hostname, remote_port, protocol
          </div>
        </div>
      </div>

      <div class="cdp-flow-arrow">‚ñº GET /api/v0/resources/links</div>

      <div class="cdp-layer backend">
        <div class="cdp-layer-header">
          <span class="cdp-layer-icon">‚öôÔ∏è</span>
          <span class="cdp-layer-title">WATCHTOWER BACKEND</span>
        </div>
        <div class="cdp-backend-flow">
          <div class="backend-func">
            <span class="func-name">poll_links()</span>
            <span class="func-file">[scheduler.py]</span>
          </div>
          <div class="backend-steps">
            <div class="backend-step">1. Fetch all CDP/LLDP links from LibreNMS</div>
            <div class="backend-step">2. For each link.local_port_id: call /ports/&#123;port_id&#125; to get port name</div>
            <div class="backend-step">3. Build link_data with resolved port names</div>
            <div class="backend-step">4. Cache to Redis (CACHE_LINKS, TTL: 600s)</div>
          </div>
        </div>
        <div class="cdp-cache-block">
          <div class="cache-key">CACHE_LINKS = "watchtower:links"</div>
          <pre><code>[&#123;
  "id": 123,
  "local_device_id": 42,
  "local_port": "TenGigabitEthernet1/0/1",
  "remote_device_id": 43,
  "remote_hostname": "cat-2.corp.local",
  "remote_port": "TenGigabitEthernet1/0/1",
  "protocol": "cdp"
&#125;]</code></pre>
        </div>
      </div>

      <div class="cdp-flow-arrow">‚ñº get_aggregated_topology()</div>

      <div class="cdp-layer aggregator">
        <div class="cdp-layer-header">
          <span class="cdp-layer-icon">üîÄ</span>
          <span class="cdp-layer-title">AGGREGATOR [aggregator.py]</span>
        </div>
        <div class="aggregator-steps">
          <div class="agg-step">
            <span class="step-num">1</span>
            <div class="step-content">
              <span class="step-title">Build device ID mappings</span>
              <code>topo_to_librenms: &#123;"cat-1": 42, "cat-2": 43&#125;</code>
            </div>
          </div>
          <div class="agg-step">
            <span class="step-num">2</span>
            <div class="step-content">
              <span class="step-title">Process cached CDP/LLDP links</span>
              <span class="step-detail">Map IDs ‚Üí Create Connection objects ‚Üí Track seen_ports</span>
            </div>
          </div>
          <div class="agg-step">
            <span class="step-num">3</span>
            <div class="step-content">
              <span class="step-title">Add static connections from topology.yaml</span>
              <span class="step-detail">Skip if port already discovered via CDP/LLDP</span>
            </div>
          </div>
          <div class="agg-step">
            <span class="step-num">4</span>
            <div class="step-content">
              <span class="step-title">Merge into Topology.connections[]</span>
            </div>
          </div>
        </div>
      </div>

      <div class="cdp-flow-arrow">‚ñº</div>

      <div class="cdp-layer frontend">
        <div class="cdp-layer-header">
          <span class="cdp-layer-icon">üñ•Ô∏è</span>
          <span class="cdp-layer-title">FRONTEND</span>
        </div>
        <div class="frontend-renders">
          <span>TopologyCanvas renders edges with port labels (Gi0/1 ‚Üî Gi0/2)</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Data Models</h3>
    <div class="cdp-models-grid">
      <div class="cdp-model-card">
        <div class="model-header">LibreNMSLink (from API)</div>
        <pre><code>class LibreNMSLink(BaseModel):
    id: int | None
    local_device_id: int
    local_port_id: int | None
    local_port: str | None
    remote_hostname: str | None
    remote_port: str | None
    remote_device_id: int | None
    protocol: str | None  # "cdp", "lldp"</code></pre>
      </div>

      <div class="cdp-model-card">
        <div class="model-header">Connection (Topology Model)</div>
        <pre><code>class Connection(BaseModel):
    id: str  # "cdp-cat-1-Te1-0-1"
    source: ConnectionEndpoint
    target: ConnectionEndpoint
    connection_type: ConnectionType
    speed: int  # Mbps
    status: ConnectionStatus
    utilization: float | None</code></pre>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Port Name Resolution</h3>
    <div class="port-resolution-block">
      <div class="resolution-problem">
        <div class="problem-label">PROBLEM</div>
        <div class="problem-content">
          LibreNMS <code>/resources/links</code> returns <code>local_port_id</code> (integer)
          but NOT the actual port name like "TenGigabitEthernet1/0/1"
        </div>
      </div>
      <div class="resolution-solution">
        <div class="solution-label">SOLUTION</div>
        <div class="solution-steps">
          <div class="sol-step">1. Collect unique port_ids that need resolution</div>
          <div class="sol-step">2. For each port_id: GET /api/v0/ports/&#123;port_id&#125;</div>
          <div class="sol-step">3. Extract ifName or ifDescr</div>
          <div class="sol-step">4. Cache in port_names dict</div>
        </div>
        <div class="solution-gotcha">
          <span class="gotcha-label">GOTCHA:</span>
          LibreNMS returns <code>&#123;"port": [&#123;...&#125;]&#125;</code> (list inside "port" key)
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Deduplication Logic</h3>
    <div class="dedup-block">
      <div class="dedup-scenario">
        <span class="scenario-label">SCENARIO:</span>
        CDP/LLDP discovers a link that's also defined in topology.yaml
      </div>
      <div class="dedup-solution">
        <div class="dedup-code">
          <pre><code>seen_ports: set[tuple[str, str]] = set()

# When processing CDP/LLDP link:
if local_port:
    seen_ports.add((source_topo_id, local_port))
if remote_port:
    seen_ports.add((target_topo_id, remote_port))

# When processing static connection:
if (source_device, source_port) in seen_ports:
    continue  # Skip - already discovered</code></pre>
        </div>
        <div class="dedup-result">
          <div class="result-item"><span class="result-icon">‚úì</span> CDP/LLDP takes priority (more accurate)</div>
          <div class="result-item"><span class="result-icon">‚úì</span> Static connections fill gaps</div>
          <div class="result-item"><span class="result-icon">‚úì</span> No duplicate edges in topology</div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Static Connection Merging</h3>
    <div class="static-merge-block">
      <div class="non-cdp-devices">
        <div class="non-cdp-header">Devices that don't run CDP/LLDP:</div>
        <div class="non-cdp-list">
          <span class="non-cdp-item">Firewalls (Palo Alto, Fortinet)</span>
          <span class="non-cdp-item">Servers (Linux, Windows)</span>
          <span class="non-cdp-item">Access Points (some models)</span>
          <span class="non-cdp-item">IoT devices</span>
          <span class="non-cdp-item">"Dumb" unmanaged switches</span>
        </div>
      </div>
      <div class="static-yaml-example">
        <div class="yaml-header">topology.yaml example:</div>
        <pre><code>connections:
  - id: "fw-to-core"
    source:
      device: pa-3410
      port: ethernet1/1
    target:
      device: cat-1
      port: TenGigabitEthernet1/0/48
    connection_type: uplink
    speed: 10000</code></pre>
      </div>
      <div class="connection-types">
        <div class="conn-types-header">Connection Types:</div>
        <div class="conn-type-grid">
          <span class="conn-type"><code>trunk</code> Inter-switch links (CDP/LLDP default)</span>
          <span class="conn-type"><code>access</code> End-device connections</span>
          <span class="conn-type"><code>uplink</code> Upstream connections</span>
          <span class="conn-type"><code>stack</code> Stacking cables</span>
          <span class="conn-type"><code>peer</code> HA/cluster peer links</span>
          <span class="conn-type"><code>management</code> Management network</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Connection Status Derivation</h3>
    <div class="status-derivation">
      <div class="derivation-note">Status is derived from device status, not link state</div>
      <div class="derivation-algo">
        <pre><code>source_device = devices.get(source_topo_id)
target_device = devices.get(target_topo_id)

IF source.status == DOWN OR target.status == DOWN:
    conn_status = DOWN
ELIF source.status == UNKNOWN OR target.status == UNKNOWN:
    conn_status = UNKNOWN
ELSE:
    conn_status = UP</code></pre>
      </div>
      <div class="derivation-why">
        <span class="why-label">Why not use link state?</span>
        <span class="why-reason">CDP/LLDP is neighbor discovery, not link monitoring. Device status is more reliable.</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Component Structure</h3>
    <div class="cdp-component-tree">
      <div class="comp-dir">backend/app/polling/</div>
      <div class="comp-files">
        <div class="comp-file">
          <span class="file-name">librenms.py</span>
          <div class="file-contents">
            <span>LibreNMSLink (Pydantic model)</span>
            <span>get_all_links() ‚Üí list[LibreNMSLink]</span>
            <span>get_port(port_id) ‚Üí LibreNMSPort</span>
          </div>
        </div>
        <div class="comp-file">
          <span class="file-name">scheduler.py</span>
          <div class="file-contents">
            <span>CACHE_LINKS = "watchtower:links"</span>
            <span>poll_links() - Fetch, resolve ports, cache</span>
            <span>Scheduler: every 300s, immediate on startup</span>
          </div>
        </div>
        <div class="comp-file">
          <span class="file-name">aggregator.py</span>
          <div class="file-contents">
            <span>get_aggregated_topology()</span>
            <span>‚îú‚îÄ Load CACHE_LINKS from Redis</span>
            <span>‚îú‚îÄ Map LibreNMS IDs ‚Üí topology IDs</span>
            <span>‚îú‚îÄ Create Connection objects</span>
            <span>‚îú‚îÄ Track seen_ports for deduplication</span>
            <span>‚îî‚îÄ Add static connections from topology.yaml</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// LibreNMS API Endpoints</h3>
    <div class="api-endpoints-grid">
      <div class="api-endpoint-card">
        <div class="endpoint-header">GET /api/v0/resources/links</div>
        <div class="endpoint-desc">Returns all CDP/LLDP discovered neighbors</div>
        <pre><code>&#123;
  "links": [&#123;
    "id": 123,
    "local_device_id": 42,
    "local_port_id": 1001,
    "remote_device_id": 43,
    "remote_hostname": "cat-2.corp.local",
    "remote_port": "Te1/0/1",
    "protocol": "cdp"
  &#125;]
&#125;</code></pre>
      </div>
      <div class="api-endpoint-card">
        <div class="endpoint-header">GET /api/v0/ports/&#123;port_id&#125;</div>
        <div class="endpoint-desc">Returns port details including interface name</div>
        <pre><code>&#123;
  "port": [&#123;
    "port_id": 1001,
    "device_id": 42,
    "ifName": "TenGigabitEthernet1/0/1",
    "ifDescr": "TenGigabitEthernet1/0/1",
    "ifAlias": "Uplink to cat-2",
    "ifOperStatus": "up"
  &#125;]
&#125;</code></pre>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Implementation Details</h3>
    <div class="tech-table">
      <div class="tech-row header">
        <span class="tech-label">Aspect</span>
        <span class="tech-value">Implementation</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Discovery protocols</span>
        <span class="tech-value">CDP (Cisco), LLDP (IEEE 802.1AB)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Poll interval</span>
        <span class="tech-value">300 seconds (5 minutes)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Cache TTL</span>
        <span class="tech-value">600 seconds (10 minutes)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Cache key</span>
        <span class="tech-value">watchtower:links</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Startup behavior</span>
        <span class="tech-value">Immediate poll via next_run_time=dt.now()</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Port resolution</span>
        <span class="tech-value">Separate API call per unique port_id</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Priority</span>
        <span class="tech-value">CDP/LLDP over static topology.yaml</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Default connection type</span>
        <span class="tech-value">TRUNK for discovered links</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Default speed</span>
        <span class="tech-value">10000 Mbps for discovered links</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Limitations</h3>
    <div class="limitations-block">
      <div class="limitation-item">
        <span class="limit-icon">‚ö†Ô∏è</span>
        <div class="limit-content">
          <span class="limit-title">Devices not discovered</span>
          <span class="limit-desc">Firewalls, servers, APs, IoT, unmanaged switches don't run CDP/LLDP</span>
          <span class="limit-workaround">Workaround: Define in topology.yaml</span>
        </div>
      </div>
      <div class="limitation-item">
        <span class="limit-icon">‚ö†Ô∏è</span>
        <div class="limit-content">
          <span class="limit-title">One-way discovery</span>
          <span class="limit-desc">CDP/LLDP may show link on one device but not the other</span>
          <span class="limit-workaround">Workaround: Static connections fill gaps</span>
        </div>
      </div>
      <div class="limitation-item">
        <span class="limit-icon">‚ö†Ô∏è</span>
        <div class="limit-content">
          <span class="limit-title">Port name variations</span>
          <span class="limit-desc">Cisco uses "TenGigabitEthernet1/0/1", "Te1/0/1", "tengige1/0/1"</span>
          <span class="limit-workaround">Frontend may normalize for display</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Speedtest Widget -->
  <div class="feature-deepdive" id="speedtest">
    <h2>// Feature Deep Dive: Speedtest Widget</h2>
    <p class="deepdive-intro">
      This feature monitors internet connectivity health by running periodic Ookla speed tests and displaying
      results in a real-time dashboard widget. It also affects the visual status of external WAN links on the
      topology map.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üåê</span>
        <span class="usecase-title">Use Case: WAN Health Monitoring</span>
      </div>
      <p class="usecase-desc">
        Provides at-a-glance WAN health visibility for NOC operators. Instead of manually running speed tests
        when users report "slow internet," the dashboard continuously monitors and logs connection quality.
        Historical CSV data enables capacity planning and ISP SLA verification.
      </p>
    </div>

    <h3 class="deepdive-subhead">// How It Works</h3>

    <div class="deepdive-flow">
      <!-- Config -->
      <div class="flow-block config">
        <div class="block-header">
          <span class="block-icon">‚öôÔ∏è</span>
          <span class="block-title">CONFIG (config.yaml)</span>
        </div>
        <div class="block-code">
          <pre><code>speedtest:
  enabled: true
  interval_minutes: 5           # Run test every 5 minutes
  server_id: null               # null = auto-select closest
  interface: "eth0"             # Specific NIC (optional)
  thresholds:
    degraded_download_mbps: 200 # Yellow if below
    degraded_ping_ms: 50        # Yellow if above
    down_download_mbps: 10      # Red if below
  logging:
    enabled: true
    path: "/opt/watchtower/data/speedtest.csv"</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Scheduler -->
      <div class="flow-block scheduler-block">
        <div class="block-header">
          <span class="block-icon">‚è±Ô∏è</span>
          <span class="block-title">SCHEDULER (APScheduler)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><code>poll_speedtest()</code> job runs at configured interval</div>
          <div class="backend-step">Calls <code>run_speedtest()</code> async function</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Backend -->
      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üêç</span>
          <span class="block-title">BACKEND (speedtest.py)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Build command: <code>/usr/local/bin/speedtest --format=json --accept-license --accept-gdpr</code></div>
          <div class="backend-step"><span class="step-num">2</span> Execute via asyncio subprocess (no shell) with 2-minute timeout</div>
          <div class="backend-step"><span class="step-num">3</span> Parse JSON: download/upload bandwidth (bytes/sec ‚Üí Mbps), ping, jitter, packet loss, server info</div>
          <div class="backend-step"><span class="step-num">4</span> Create SpeedtestResult dataclass</div>
          <div class="backend-step"><span class="step-num">5</span> Cache result in Redis (1 hour TTL)</div>
          <div class="backend-step"><span class="step-num">6</span> Append to CSV file for historical logging</div>
          <div class="backend-step"><span class="step-num">7</span> Broadcast via WebSocket to all connected clients</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- API Endpoints -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üì°</span>
          <span class="block-title">API ENDPOINTS</span>
        </div>
        <div class="api-endpoints-list">
          <div class="endpoint-item">
            <code>GET /api/speedtest</code>
            <span class="endpoint-desc">Returns cached result with status indicator</span>
          </div>
          <div class="endpoint-item">
            <code>POST /api/speedtest/trigger</code>
            <span class="endpoint-desc">Manual test trigger (60-second cooldown enforced)</span>
          </div>
          <div class="endpoint-item">
            <code>GET /api/speedtest/export</code>
            <span class="endpoint-desc">Download CSV history file</span>
          </div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- API Response -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üìã</span>
          <span class="block-title">API RESPONSE (GET /api/speedtest)</span>
        </div>
        <div class="block-code">
          <pre><code>{`{
  "timestamp": "2026-01-27T14:30:00Z",
  "download_mbps": 487.23,
  "upload_mbps": 52.41,
  "ping_ms": 12.3,
  "jitter_ms": 2.1,
  "packet_loss_pct": 0,
  "server_id": 12345,
  "server_name": "Spectrum",
  "server_location": "Tampa, FL",
  "result_url": "https://www.speedtest.net/result/xxxxx",
  "status": "success",
  "indicator": "normal"    // Derived from thresholds
}`}</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Frontend Widget -->
      <div class="flow-block widget">
        <div class="block-header">
          <span class="block-icon">üìä</span>
          <span class="block-title">FRONTEND (SpeedtestWidget.tsx)</span>
        </div>
        <div class="speedtest-widget-mockup">
          <div class="mockup-header">
            <span class="mockup-icon">üåê</span>
            <span class="mockup-title">Internet Speed</span>
            <span class="mockup-status ok">‚óè</span>
            <span class="mockup-collapse">‚ñº</span>
          </div>
          <div class="mockup-body">
            <div class="speedtest-stats">
              <div class="speed-stat">
                <span class="speed-arrow down">‚Üì</span>
                <span class="speed-value">487.2</span>
                <span class="speed-unit">Mbps Down</span>
              </div>
              <div class="speed-stat">
                <span class="speed-arrow up">‚Üë</span>
                <span class="speed-value">52.4</span>
                <span class="speed-unit">Mbps Up</span>
              </div>
            </div>
            <div class="speedtest-latency">
              <span>12.3ms ping</span>
              <span class="latency-sep">|</span>
              <span>2.1ms jitter</span>
            </div>
            <div class="speedtest-server">Spectrum (Tampa, FL)</div>
            <div class="speedtest-time">Last test: 3m ago</div>
            <div class="speedtest-actions">
              <button class="speedtest-btn run">Run Test</button>
              <button class="speedtest-btn export">üì•</button>
            </div>
            <div class="speedtest-link">View detailed result ‚Üó</div>
          </div>
        </div>
        <div class="widget-states">
          <span class="widget-state"><strong>loading</strong> ‚Üí Skeleton placeholder</span>
          <span class="widget-state"><strong>no_data</strong> ‚Üí "Run Test" button only</span>
          <span class="widget-state"><strong>testing</strong> ‚Üí Spinner animation</span>
          <span class="widget-state"><strong>ready</strong> ‚Üí Full result display</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Status Indicator Logic</h3>
    <p class="section-desc">The widget displays a colored status dot based on configurable thresholds:</p>

    <div class="status-table">
      <div class="status-row header">
        <span class="status-col">Status</span>
        <span class="status-col">Color</span>
        <span class="status-col">Condition</span>
      </div>
      <div class="status-row normal">
        <span class="status-col"><code>normal</code></span>
        <span class="status-col"><span class="status-dot green">‚óè</span> Green</span>
        <span class="status-col">Download ‚â• 200 Mbps AND ping ‚â§ 50ms</span>
      </div>
      <div class="status-row degraded">
        <span class="status-col"><code>degraded</code></span>
        <span class="status-col"><span class="status-dot yellow">‚óè</span> Yellow</span>
        <span class="status-col">Download &lt; 200 Mbps OR ping &gt; 50ms</span>
      </div>
      <div class="status-row down">
        <span class="status-col"><code>down</code></span>
        <span class="status-col"><span class="status-dot red">‚óè</span> Red</span>
        <span class="status-col">Download &lt; 10 Mbps OR test error</span>
      </div>
    </div>

    <div class="code-snippet">
      <span class="snippet-label">Status Logic (Python)</span>
      <pre><code>def get_status(result, thresholds):
    if result.status.startswith("error"):
        return "down"

    if download &lt; 10:                    # Critical threshold
        return "down"
    if download &lt; 200 or ping &gt; 50:      # Warning thresholds
        return "degraded"
    return "normal"</code></pre>
    </div>

    <h3 class="deepdive-subhead">// External Link Coloring</h3>
    <p class="section-desc">The speedtest status also affects the topology visualization:</p>

    <div class="topology-example">
      <div class="topo-header">Topology Canvas</div>
      <div class="topo-visual">
        <div class="topo-node firewall">Firewall</div>
        <div class="topo-link">
          <div class="link-line"></div>
          <span class="link-label">WAN Link</span>
        </div>
        <div class="topo-node isp">ISP Router</div>
      </div>
      <div class="topo-legend">
        <div class="legend-item"><span class="legend-line green"></span> normal ‚Üí Green animated link</div>
        <div class="legend-item"><span class="legend-line yellow"></span> degraded ‚Üí Yellow animated link</div>
        <div class="legend-item"><span class="legend-line red"></span> down ‚Üí Red static link</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Data Flow</h3>
    <div class="numbered-flow">
      <div class="flow-item">
        <div class="flow-num">1</div>
        <div class="flow-content">
          <span class="flow-title">Scheduled Test (every 5 minutes)</span>
          <span class="flow-desc">APScheduler triggers poll_speedtest() ‚Üí Runs Ookla CLI ‚Üí Parses output ‚Üí Caches in Redis ‚Üí Logs to CSV ‚Üí Broadcasts via WebSocket</span>
        </div>
      </div>
      <div class="flow-item">
        <div class="flow-num">2</div>
        <div class="flow-content">
          <span class="flow-title">Manual Test (user-triggered)</span>
          <span class="flow-desc">Frontend POSTs to /api/speedtest/trigger ‚Üí Backend checks 60s cooldown ‚Üí Runs test in background ‚Üí Result arrives via WebSocket</span>
        </div>
      </div>
      <div class="flow-item">
        <div class="flow-num">3</div>
        <div class="flow-content">
          <span class="flow-title">Page Load</span>
          <span class="flow-desc">Frontend fetches GET /api/speedtest for cached result ‚Üí Displays immediately ‚Üí Subscribes to WebSocket for live updates</span>
        </div>
      </div>
      <div class="flow-item">
        <div class="flow-num">4</div>
        <div class="flow-content">
          <span class="flow-title">CSV Export</span>
          <span class="flow-desc">User clicks export ‚Üí Backend returns FileResponse ‚Üí Filename: speedtest_history_2026-01-27.csv</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// CSV Log Format</h3>
    <div class="csv-block">
      <span class="csv-label">speedtest.csv</span>
      <pre><code>timestamp,download_mbps,upload_mbps,ping_ms,jitter_ms,packet_loss_pct,server_id,server_name,server_location,result_url,status
2026-01-27T14:30:00Z,487.23,52.41,12.3,2.1,0,12345,Spectrum,"Tampa, FL",https://speedtest.net/result/...,success
2026-01-27T14:35:00Z,491.87,51.22,11.8,1.9,0,12345,Spectrum,"Tampa, FL",https://speedtest.net/result/...,success</code></pre>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">CLI tool</span>
        <span class="tech-value">Ookla Speedtest CLI (/usr/local/bin/speedtest)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Execution</span>
        <span class="tech-value">asyncio subprocess - no shell injection risk</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Timeout</span>
        <span class="tech-value">2 minutes (handles hung tests)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Output format</span>
        <span class="tech-value">JSON (--format=json)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Conversion</span>
        <span class="tech-value">(bytes/sec √ó 8) / 1,000,000 = Mbps</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Cache TTL</span>
        <span class="tech-value">1 hour in Redis</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Cooldown</span>
        <span class="tech-value">60 seconds between manual triggers</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Interface binding</span>
        <span class="tech-value">Optional --interface flag for multi-NIC hosts</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Why This Approach</h3>
    <div class="approach-grid">
      <div class="approach-item">
        <span class="approach-icon">üèÜ</span>
        <div class="approach-content">
          <span class="approach-title">Ookla CLI</span>
          <span class="approach-desc">Industry standard, trusted by ISPs, consistent results</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">‚ö°</span>
        <div class="approach-content">
          <span class="approach-title">Async subprocess</span>
          <span class="approach-desc">Non-blocking, doesn't tie up web server threads</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üì°</span>
        <div class="approach-content">
          <span class="approach-title">WebSocket push</span>
          <span class="approach-desc">Instant updates without polling overhead</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üõ°Ô∏è</span>
        <div class="approach-content">
          <span class="approach-title">Cooldown enforcement</span>
          <span class="approach-desc">Prevents API abuse and bandwidth waste</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üìä</span>
        <div class="approach-content">
          <span class="approach-title">CSV logging</span>
          <span class="approach-desc">Long-term trending without database complexity</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üéõÔ∏è</span>
        <div class="approach-content">
          <span class="approach-title">Configurable thresholds</span>
          <span class="approach-desc">Adapts to different connection speeds (fiber vs cable vs DSL)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Port Group Monitoring -->
  <div class="feature-deepdive" id="port-groups">
    <h2>// Feature Deep Dive: Port Group Monitoring</h2>
    <p class="deepdive-intro">
      This feature aggregates real-time traffic across multiple switch ports that share a common SNMP description pattern.
      Built to monitor computer labs where dozens of workstations connect through various switches but need to be
      viewed as a single logical group.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üé¨</span>
        <span class="usecase-title">Use Case: Digital Media Labs</span>
      </div>
      <p class="usecase-desc">
        The Digital Media Mac Pro Lab has ~140 workstation ports spread across multiple access switches. Each port
        has an SNMP description (ifAlias) containing "digital-media" (the department identifier). Instead of monitoring
        140 individual ports, this feature sums all their traffic into a single dashboard widget showing aggregate
        bandwidth consumption.
      </p>
    </div>

    <h3 class="deepdive-subhead">// How It Works</h3>

    <div class="deepdive-flow">
      <!-- Config -->
      <div class="flow-block config">
        <div class="block-header">
          <span class="block-icon">‚öôÔ∏è</span>
          <span class="block-title">CONFIG (config.yaml)</span>
        </div>
        <div class="block-code">
          <pre><code>port_groups:
  - name: "Digital Media Labs"
    description: "Digital Media Mac Pro Lab"
    match_alias: "digital-media"  # Pattern to match
    thresholds:
      warning_mbps: 500         # Yellow threshold
      critical_mbps: 800        # Red threshold
    logging:
      enabled: true
      path: "/opt/watchtower/data/port_groups.csv"</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Backend -->
      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üêç</span>
          <span class="block-title">BACKEND (portgroups.py)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Fetch ALL ports from LibreNMS API</div>
          <div class="backend-step"><span class="step-num">2</span> Filter ports where ifAlias contains "digital-media" (case-insensitive) ‚Üí ~140 ports</div>
          <div class="backend-step"><span class="step-num">3</span> Filter to only "up" ports (ifOperStatus == "up")</div>
          <div class="backend-step"><span class="step-num">4</span> Sum traffic rates: ifInOctets_rate + ifOutOctets_rate (bytes/sec)</div>
          <div class="backend-step"><span class="step-num">5</span> Convert: (bytes/sec √ó 8) / 1,000,000 = Mbps</div>
          <div class="backend-step"><span class="step-num">6</span> Determine status vs thresholds: &lt;500 = ok, ‚â•500 = warning, ‚â•800 = critical</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- API Response -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üì°</span>
          <span class="block-title">API RESPONSE (GET /api/port-groups)</span>
        </div>
        <div class="block-code">
          <pre><code>{`{
  "name": "Digital Media Labs",
  "description": "Digital Media Mac Pro Lab",
  "port_count": 140,           // Total matching ports
  "active_port_count": 87,     // Ports currently up
  "in_mbps": 360.0,            // Inbound Mbps
  "out_mbps": 96.0,            // Outbound Mbps
  "total_mbps": 456.0,         // Combined
  "status": "ok",              // Based on thresholds
  "thresholds": { "warning_mbps": 500, "critical_mbps": 800 }
}`}</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Frontend Widget -->
      <div class="flow-block widget">
        <div class="block-header">
          <span class="block-icon">üìä</span>
          <span class="block-title">FRONTEND (PortGroupWidget.tsx)</span>
        </div>
        <div class="widget-mockup">
          <div class="mockup-header">
            <span class="mockup-icon">üî≤</span>
            <span class="mockup-title">Digital Media Labs</span>
            <span class="mockup-status ok">‚óè</span>
          </div>
          <div class="mockup-body">
            <div class="mockup-desc">Digital Media Mac Pro Lab</div>
            <div class="mockup-stats">
              <div class="mockup-stat">
                <span class="stat-arrow down">‚Üì</span>
                <span class="stat-value">360.0</span>
                <span class="stat-unit">Mbps In</span>
              </div>
              <div class="mockup-stat">
                <span class="stat-arrow up">‚Üë</span>
                <span class="stat-value">96.0</span>
                <span class="stat-unit">Mbps Out</span>
              </div>
            </div>
            <div class="mockup-total">Total: 456.0 Mbps <span class="mockup-pct">57%</span></div>
            <div class="mockup-bar">
              <div class="bar-fill" style="width: 57%"></div>
              <div class="bar-markers">
                <span class="marker" style="left: 0">0</span>
                <span class="marker warning" style="left: 62.5%">500</span>
                <span class="marker critical" style="left: 100%">800</span>
              </div>
            </div>
            <div class="mockup-ports">87 of 140 ports active</div>
            <div class="mockup-export">üì• Export CSV</div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">Pattern matching</span>
        <span class="tech-value">Case-insensitive substring match on ifAlias field</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Traffic source</span>
        <span class="tech-value">LibreNMS ifInOctets_rate / ifOutOctets_rate (SNMP counters)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Only active ports</span>
        <span class="tech-value">Filters ifOperStatus == "up" before summing</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Conversion</span>
        <span class="tech-value">(bytes/sec √ó 8) / 1,000,000 = Mbps</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Polling interval</span>
        <span class="tech-value">Widget fetches every 60s (matches LibreNMS interface polling)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Thresholds</span>
        <span class="tech-value">Configurable per-group warning/critical values in Mbps</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Persistence</span>
        <span class="tech-value">CSV logging for historical analysis and capacity planning</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Why This Approach</h3>
    <div class="approach-grid">
      <div class="approach-item">
        <span class="approach-icon">üì°</span>
        <div class="approach-content">
          <span class="approach-title">SNMP-based</span>
          <span class="approach-desc">Uses existing LibreNMS infrastructure, no agent installation needed</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üî§</span>
        <div class="approach-content">
          <span class="approach-title">Pattern matching</span>
          <span class="approach-desc">Network admins already use naming conventions in port descriptions</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">‚ö°</span>
        <div class="approach-content">
          <span class="approach-title">Real-time</span>
          <span class="approach-desc">60-second granularity matches SNMP polling cycle</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üìà</span>
        <div class="approach-content">
          <span class="approach-title">Scalable</span>
          <span class="approach-desc">Works whether a lab has 10 ports or 500 ports</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üìä</span>
        <div class="approach-content">
          <span class="approach-title">Exportable</span>
          <span class="approach-desc">CSV export enables capacity planning spreadsheets and reports</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: ISP vs Network Bottleneck -->
  <div class="feature-deepdive">
    <h2>// Feature Deep Dive: Diagnosing Slowdowns</h2>
    <p class="deepdive-intro">
      When users report "the internet is slow," the question is: is it the ISP or something internal?
      Both the Speedtest Widget and Port Group Monitoring export CSV logs. Comparing these two data sources
      pinpoints whether the bottleneck is upstream (ISP) or within the campus network.
    </p>

    <h3 class="deepdive-subhead">// The Diagnostic Question</h3>
    <div class="diagnostic-scenarios">
      <div class="scenario-card isp">
        <div class="scenario-header">
          <span class="scenario-icon">üåê</span>
          <span class="scenario-label">ISP Problem</span>
        </div>
        <div class="scenario-indicators">
          <div class="indicator bad">
            <span class="indicator-icon">üì∂</span>
            <span class="indicator-metric">Speedtest</span>
            <span class="indicator-value">Slow</span>
          </div>
          <div class="indicator good">
            <span class="indicator-icon">üìä</span>
            <span class="indicator-metric">Lab Traffic</span>
            <span class="indicator-value">Normal/Low</span>
          </div>
        </div>
        <p class="scenario-conclusion">
          WAN link is degraded but internal network has capacity. Problem is with the upstream provider.
        </p>
      </div>

      <div class="scenario-card internal">
        <div class="scenario-header">
          <span class="scenario-icon">üîÄ</span>
          <span class="scenario-label">Internal Bottleneck</span>
        </div>
        <div class="scenario-indicators">
          <div class="indicator good">
            <span class="indicator-icon">üì∂</span>
            <span class="indicator-metric">Speedtest</span>
            <span class="indicator-value">Normal</span>
          </div>
          <div class="indicator bad">
            <span class="indicator-icon">üìä</span>
            <span class="indicator-metric">Lab Traffic</span>
            <span class="indicator-value">Near Threshold</span>
          </div>
        </div>
        <p class="scenario-conclusion">
          ISP link is healthy but lab ports are saturated. Congestion is on the access or distribution layer.
        </p>
      </div>
    </div>

    <h3 class="deepdive-subhead">// How It Works</h3>
    <div class="correlation-flow">
      <div class="corr-step">
        <div class="corr-num">1</div>
        <div class="corr-content">
          <span class="corr-title">Collect Speedtest CSV</span>
          <span class="corr-desc">Scheduled tests (every 5-15 min) log timestamp, download Mbps, upload Mbps, latency</span>
          <code class="corr-path">/opt/watchtower/data/speedtest.csv</code>
        </div>
      </div>
      <div class="corr-step">
        <div class="corr-num">2</div>
        <div class="corr-content">
          <span class="corr-title">Collect Port Group CSV</span>
          <span class="corr-desc">Polled traffic (every 60s) logs timestamp, group name, active ports, in/out Mbps</span>
          <code class="corr-path">/opt/watchtower/data/port_groups.csv</code>
        </div>
      </div>
      <div class="corr-step">
        <div class="corr-num">3</div>
        <div class="corr-content">
          <span class="corr-title">Correlate by Timestamp</span>
          <span class="corr-desc">Join both CSVs on timestamp (within tolerance) to see WAN health alongside lab traffic</span>
        </div>
      </div>
      <div class="corr-step">
        <div class="corr-num">4</div>
        <div class="corr-content">
          <span class="corr-title">Identify Pattern</span>
          <span class="corr-desc">Slowdowns with low internal traffic ‚Üí ISP. Slowdowns with high internal traffic ‚Üí congestion.</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Example Analysis</h3>
    <div class="csv-example">
      <div class="csv-block">
        <span class="csv-label">speedtest.csv</span>
        <pre><code>timestamp,download_mbps,upload_mbps,latency_ms
2026-01-27T14:00:00,850.2,410.5,12
2026-01-27T14:15:00,180.4,95.2,45    ‚Üê degraded
2026-01-27T14:30:00,175.8,88.1,52    ‚Üê degraded
2026-01-27T14:45:00,820.1,405.3,14</code></pre>
      </div>
      <div class="csv-block">
        <span class="csv-label">port_groups.csv (Digital Media Labs)</span>
        <pre><code>timestamp,group,active_ports,in_mbps,out_mbps,total_mbps
2026-01-27T14:00:00,Digital Media Labs,87,360.0,96.0,456.0
2026-01-27T14:15:00,Digital Media Labs,85,340.2,88.4,428.6
2026-01-27T14:30:00,Digital Media Labs,82,310.5,82.1,392.6
2026-01-27T14:45:00,Digital Media Labs,88,375.2,102.3,477.5</code></pre>
      </div>
      <div class="analysis-box">
        <span class="analysis-icon">üîç</span>
        <div class="analysis-content">
          <span class="analysis-title">Conclusion: ISP Issue</span>
          <p class="analysis-desc">
            At 14:15 and 14:30, speedtest dropped from ~850 Mbps to ~180 Mbps while lab traffic stayed
            consistent around 400-430 Mbps. The labs weren't saturating anything; the WAN link was degraded.
            Time to call the ISP.
          </p>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Why This Matters</h3>
    <div class="approach-grid">
      <div class="approach-item">
        <span class="approach-icon">üéØ</span>
        <div class="approach-content">
          <span class="approach-title">Accurate Diagnosis</span>
          <span class="approach-desc">Eliminates guesswork about where the problem actually is</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üìû</span>
        <div class="approach-content">
          <span class="approach-title">ISP Accountability</span>
          <span class="approach-desc">CSV logs provide evidence when escalating to the provider</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üìà</span>
        <div class="approach-content">
          <span class="approach-title">Capacity Planning</span>
          <span class="approach-desc">Historical data shows when internal upgrades are actually needed</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">‚è±Ô∏è</span>
        <div class="approach-content">
          <span class="approach-title">Faster Resolution</span>
          <span class="approach-desc">Skip the "have you tried rebooting" phase with concrete data</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Port Search -->
  <div class="feature-deepdive" id="port-search">
    <h2>// Feature Deep Dive: Port Search</h2>
    <p class="deepdive-intro">
      This feature allows NOC operators to quickly find switch ports across the entire network by searching
      SNMP port descriptions. Instead of logging into individual switches, users can search for devices like
      "printer", "podium", or "voip" and instantly see all matching ports with their status and traffic.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üîç</span>
        <span class="usecase-title">Use Case: Device Location</span>
      </div>
      <p class="usecase-desc">
        Network admins label switch ports with descriptions (SNMP ifAlias) like "Conference Room Podium" or
        "Break Room Printer". When troubleshooting, they need to quickly find which switch and port a device
        is connected to. This feature searches all ports across all managed switches in seconds.
      </p>
    </div>

    <h3 class="deepdive-subhead">// How It Works</h3>

    <div class="deepdive-flow">
      <!-- Frontend Input -->
      <div class="flow-block widget">
        <div class="block-header">
          <span class="block-icon">üîç</span>
          <span class="block-title">FRONTEND (PortSearchWidget.tsx)</span>
        </div>
        <div class="port-search-mockup">
          <div class="search-header">
            <span class="search-icon">üîç</span>
            <span class="search-title">Port Search</span>
            <span class="mockup-collapse">‚ñº</span>
          </div>
          <div class="search-body">
            <div class="search-input-row">
              <input type="text" class="search-input" placeholder="printer" readonly />
              <button class="search-btn">Search</button>
            </div>
            <div class="status-filters">
              <button class="filter-btn active">All</button>
              <button class="filter-btn">Up</button>
              <button class="filter-btn">Down</button>
            </div>
          </div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>
      <div class="api-call-label">GET /api/ports/search?q=printer&status=all&limit=100</div>
      <div class="flow-arrow-down">‚ñº</div>

      <!-- Backend -->
      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üêç</span>
          <span class="block-title">BACKEND (ports.py)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Fetch ALL ports from LibreNMS API (~2000+ ports across all switches)</div>
          <div class="backend-step"><span class="step-num">2</span> Fetch ALL devices from LibreNMS API ‚Üí Build device_id ‚Üí hostname lookup map</div>
          <div class="backend-step"><span class="step-num">3</span> For each port, check if search term matches ifAlias (primary) or ifDescr (fallback) via case-insensitive substring match</div>
          <div class="backend-step"><span class="step-num">4</span> Apply status filter: "up", "down", or "all"</div>
          <div class="backend-step"><span class="step-num">5</span> Build result with device context: attach hostname, convert traffic rates to Mbps</div>
          <div class="backend-step"><span class="step-num">6</span> Sort results by device hostname, then port name</div>
          <div class="backend-step"><span class="step-num">7</span> Limit to 100 results (configurable, max 500)</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- API Response -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üìã</span>
          <span class="block-title">API RESPONSE</span>
        </div>
        <div class="block-code">
          <pre><code>{`{
  "query": "printer",
  "total": 12,
  "ports": [
    {
      "port_id": 4521,
      "device_id": 15,
      "device_hostname": "sw-bldg1-fl2",
      "ifName": "Gi1/0/24",
      "ifAlias": "Front Office Printer",
      "ifDescr": "GigabitEthernet1/0/24",
      "ifSpeed": 1000000000,
      "ifOperStatus": "up",
      "ifAdminStatus": "up",
      "in_mbps": 0.12,
      "out_mbps": 0.45
    }
    // (more results)
  ]
}`}</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Results Display -->
      <div class="flow-block widget">
        <div class="block-header">
          <span class="block-icon">üìä</span>
          <span class="block-title">FRONTEND (Results Display)</span>
        </div>
        <div class="search-results-mockup">
          <div class="results-header">Found 12 ports matching "printer"</div>
          <div class="results-list">
            <div class="port-result">
              <div class="port-result-header">
                <span class="port-device">sw-bldg1-fl2</span>
                <span class="port-status up">up</span>
              </div>
              <div class="port-result-info">
                <span class="port-name">Gi1/0/24</span>
                <span class="port-speed">1G</span>
              </div>
              <div class="port-alias">Front Office Printer</div>
              <div class="port-traffic">
                <span class="traffic-in">‚Üì 0.12 Mbps</span>
                <span class="traffic-out">‚Üë 0.45 Mbps</span>
              </div>
            </div>
            <div class="port-result">
              <div class="port-result-header">
                <span class="port-device">sw-bldg2-fl1</span>
                <span class="port-status down">down</span>
              </div>
              <div class="port-result-info">
                <span class="port-name">Gi2/0/12</span>
                <span class="port-speed">100M</span>
              </div>
              <div class="port-alias">Break Room Printer</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Bonus: Alias Discovery</h3>
    <p class="section-desc">
      The <code>/api/ports/aliases</code> endpoint helps users discover what search terms exist in the network:
    </p>

    <div class="alias-discovery">
      <div class="alias-request">
        <code>GET /api/ports/aliases</code>
      </div>
      <div class="alias-response">
        <div class="alias-item"><span class="alias-term">printer</span><span class="alias-count">42 ports</span></div>
        <div class="alias-item"><span class="alias-term">voip</span><span class="alias-count">87 ports</span></div>
        <div class="alias-item"><span class="alias-term">podium</span><span class="alias-count">24 ports</span></div>
        <div class="alias-item"><span class="alias-term">wap</span><span class="alias-count">156 ports</span></div>
        <div class="alias-item"><span class="alias-term">digital-media</span><span class="alias-count">140 ports</span></div>
        <div class="alias-item"><span class="alias-term">server</span><span class="alias-count">23 ports</span></div>
      </div>
      <p class="alias-desc">
        Extracts words from all ifAlias fields, counts frequency (skips words &lt;3 chars and pure numbers),
        returns top 50 sorted by count. Helps users discover what types of devices are labeled without guessing.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">Search fields</span>
        <span class="tech-value">ifAlias (primary), ifDescr (fallback)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Match type</span>
        <span class="tech-value">Case-insensitive substring</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Data source</span>
        <span class="tech-value">LibreNMS API (/api/v0/ports + /api/v0/devices)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Default limit</span>
        <span class="tech-value">100 results (max 500)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Traffic conversion</span>
        <span class="tech-value">(bytes/sec √ó 8) / 1,000,000 = Mbps</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Sort order</span>
        <span class="tech-value">Device hostname ‚Üí Port name (alphabetical)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Status filter</span>
        <span class="tech-value">ifOperStatus field (up/down)</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// UI States</h3>
    <div class="ui-states-grid">
      <div class="ui-state">
        <span class="state-name">idle</span>
        <span class="state-desc">Search input with placeholder text</span>
      </div>
      <div class="ui-state">
        <span class="state-name">loading</span>
        <span class="state-desc">Search button shows "..."</span>
      </div>
      <div class="ui-state">
        <span class="state-name">results</span>
        <span class="state-desc">Count + scrollable port list</span>
      </div>
      <div class="ui-state">
        <span class="state-name">error</span>
        <span class="state-desc">"Search failed. Try again." message</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Speed Formatting</h3>
    <div class="code-snippet">
      <span class="snippet-label">formatSpeed(bps)</span>
      <pre><code>10G+ ‚Üí "10G"
1G   ‚Üí "1G"
100M ‚Üí "100M"
10M  ‚Üí "10M"
else ‚Üí "{`{x}`}M"</code></pre>
    </div>

    <h3 class="deepdive-subhead">// Why This Approach</h3>
    <div class="approach-grid">
      <div class="approach-item">
        <span class="approach-icon">‚ö°</span>
        <div class="approach-content">
          <span class="approach-title">Real-time data</span>
          <span class="approach-desc">Queries LibreNMS directly, always current</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üîÑ</span>
        <div class="approach-content">
          <span class="approach-title">No local index</span>
          <span class="approach-desc">Avoids sync complexity, uses LibreNMS as source of truth</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üî§</span>
        <div class="approach-content">
          <span class="approach-title">Substring match</span>
          <span class="approach-desc">More flexible than exact match (finds "HP Printer" when searching "printer")</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üñ•Ô∏è</span>
        <div class="approach-content">
          <span class="approach-title">Device context</span>
          <span class="approach-desc">Shows hostname so user knows which switch to access</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üìä</span>
        <div class="approach-content">
          <span class="approach-title">Traffic included</span>
          <span class="approach-desc">Helps verify device is actually active, not just link-up</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üîò</span>
        <div class="approach-content">
          <span class="approach-title">Status filter</span>
          <span class="approach-desc">Quickly find disconnected devices for troubleshooting</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Cisco Port Grid -->
  <div class="feature-deepdive" id="port-grid">
    <h2>// Feature Deep Dive: Cisco Port Grid</h2>
    <p class="deepdive-intro">
      This feature renders a visual representation of physical switch ports that mirrors the actual front panel
      of a Cisco Catalyst switch: odd ports (1, 3, 5...) on top and even ports (2, 4, 6...) on the bottom,
      grouped into banks of 24 and organized by line card/module.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üîå</span>
        <span class="usecase-title">Use Case: Physical Correlation</span>
      </div>
      <p class="usecase-desc">
        Network engineers standing at a rack can immediately correlate dashboard status with physical ports.
        Port 23 is always top-right of a bank, port 48 is always bottom-right. This layout matches what
        they see on the actual Cisco Catalyst hardware, eliminating mental translation.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Data Flow</h3>

    <div class="deepdive-flow">
      <!-- Data Source -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üì°</span>
          <span class="block-title">LIBRENMS API</span>
        </div>
        <div class="block-code">
          <pre><code>{`GET /api/v0/devices/{id}/ports

Returns array of interfaces:
[
  { name: "Gi1/0/1", ifOperStatus: "up", ifSpeed: 1000000000 },
  { name: "Gi1/0/2", ifOperStatus: "down" },
  { name: "Te1/1/1", ifOperStatus: "up", ifSpeed: 10000000000 }
]`}</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>
      <div class="api-call-label">Backend Aggregator ‚Üí Topology ‚Üí WebSocket ‚Üí Frontend Store</div>
      <div class="flow-arrow-down">‚ñº</div>

      <!-- Parser -->
      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üîß</span>
          <span class="block-title">INTERFACE NAME PARSING (portUtils.ts)</span>
        </div>
        <div class="block-code parsing-example">
          <pre><code>Input: "Gi1/0/24"
        ‚îÇ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ Port number (24)
        ‚îÇ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ Module/slot (0)
        ‚îÇ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Stack number (1)
        ‚îÇ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Type prefix (Gi = Gigabit)
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Interface type

Output: {`{
  type: 'gigabit',
  typePrefix: 'Gi',
  stack: 1,
  module: 0,
  port: 24,
  sortKey: 10024,    // (1 √ó 10000) + (0 √ó 100) + 24
  isUplink: false,
  original: 'Gi1/0/24'
}`}</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Organization Algorithm -->
      <div class="flow-block config">
        <div class="block-header">
          <span class="block-icon">üìä</span>
          <span class="block-title">PORT ORGANIZATION (organizePortsForGrid)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Parse each interface name ‚Üí GridPort object (failures ‚Üí "other" array)</div>
          <div class="backend-step"><span class="step-num">2</span> Separate uplinks (10G+: Te*, Fo*, Hu*, Twe*) from access ports (Gi*, Fa*)</div>
          <div class="backend-step"><span class="step-num">3</span> Group access ports by module (line card): Module 0, Module 1, etc.</div>
          <div class="backend-step"><span class="step-num">4</span> Within each module, create banks of 24 ports: Bank 0 (1-24), Bank 1 (25-48)</div>
          <div class="backend-step"><span class="step-num">5</span> Within each bank, split by odd/even for physical row layout</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- Output Structure -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üìã</span>
          <span class="block-title">GRID DATA STRUCTURE</span>
        </div>
        <div class="block-code">
          <pre><code>{`{
  modules: [
    {
      moduleId: 0,
      label: "Slot 0",
      banks: [
        { label: "1-24", oddPorts: [12 ports], evenPorts: [12 ports] },
        { label: "25-48", oddPorts: [12 ports], evenPorts: [12 ports] }
      ]
    }
  ],
  uplinks: [GridPort array],   // 10G+ SFP ports
  other: [Interface array]     // VLANs, mgmt, loopback
}`}</code></pre>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Interface Type Support</h3>
    <div class="interface-types-table">
      <div class="intf-header">
        <span>Prefix</span>
        <span>Full Name</span>
        <span>Speed</span>
        <span>Uplink?</span>
      </div>
      <div class="intf-row">
        <code>Hu</code>
        <span>HundredGigabitEthernet</span>
        <span>100G</span>
        <span class="uplink-yes">Yes</span>
      </div>
      <div class="intf-row">
        <code>Fo</code>
        <span>FortyGigabitEthernet</span>
        <span>40G</span>
        <span class="uplink-yes">Yes</span>
      </div>
      <div class="intf-row">
        <code>Twe</code>
        <span>TwentyFiveGigE</span>
        <span>25G</span>
        <span class="uplink-yes">Yes</span>
      </div>
      <div class="intf-row">
        <code>Te</code>
        <span>TenGigabitEthernet</span>
        <span>10G</span>
        <span class="uplink-yes">Yes</span>
      </div>
      <div class="intf-row">
        <code>Gi</code>
        <span>GigabitEthernet</span>
        <span>1G</span>
        <span class="uplink-no">No</span>
      </div>
      <div class="intf-row">
        <code>Fa</code>
        <span>FastEthernet</span>
        <span>100M</span>
        <span class="uplink-no">No</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Rendering</h3>
    <div class="portgrid-mockup">
      <div class="cisco-chassis">
        <div class="chassis-bezel top">
          <span class="cisco-brand">CISCO</span>
          <span class="chassis-hostname">sw-core-01.network.local</span>
        </div>

        <div class="uplink-module">
          <span class="uplink-label">10G</span>
          <div class="uplink-ports">
            <div class="sfp-port up"></div>
            <div class="sfp-port up"></div>
            <div class="sfp-port down"></div>
            <div class="sfp-port disabled"></div>
          </div>
          <span class="uplink-range">Te1/1/1-4</span>
        </div>

        <div class="port-module">
          <span class="module-label">Slot 0</span>
          <div class="port-bank">
            <div class="port-labels top">
              <span>1</span><span>3</span><span>5</span><span>7</span><span>9</span><span>11</span>
              <span>13</span><span>15</span><span>17</span><span>19</span><span>21</span><span>23</span>
            </div>
            <div class="port-row odd">
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port warning"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
            </div>
            <div class="port-row even">
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port down"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
            </div>
            <div class="port-labels bottom">
              <span>2</span><span>4</span><span>6</span><span>8</span><span>10</span><span>12</span>
              <span>14</span><span>16</span><span>18</span><span>20</span><span>22</span><span>24</span>
            </div>
          </div>
        </div>

        <div class="port-module">
          <span class="module-label">Slot 1</span>
          <div class="port-bank">
            <div class="port-labels top">
              <span>1</span><span>3</span><span>5</span><span>7</span><span>9</span><span>11</span>
              <span>13</span><span>15</span><span>17</span><span>19</span><span>21</span><span>23</span>
            </div>
            <div class="port-row odd">
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port down"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port warning"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
            </div>
            <div class="port-row even">
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port down"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
            </div>
            <div class="port-labels bottom">
              <span>2</span><span>4</span><span>6</span><span>8</span><span>10</span><span>12</span>
              <span>14</span><span>16</span><span>18</span><span>20</span><span>22</span><span>24</span>
            </div>
          </div>
        </div>

        <div class="port-module">
          <span class="module-label">Slot 2</span>
          <div class="port-bank">
            <div class="port-labels top">
              <span>1</span><span>3</span><span>5</span><span>7</span><span>9</span><span>11</span>
              <span>13</span><span>15</span><span>17</span><span>19</span><span>21</span><span>23</span>
            </div>
            <div class="port-row odd">
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
            </div>
            <div class="port-row even">
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port down"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port up"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
              <div class="rj45-port disabled"></div>
            </div>
            <div class="port-labels bottom">
              <span>2</span><span>4</span><span>6</span><span>8</span><span>10</span><span>12</span>
              <span>14</span><span>16</span><span>18</span><span>20</span><span>22</span><span>24</span>
            </div>
          </div>
        </div>

        <div class="chassis-bezel bottom">
          <div class="status-legend">
            <span class="legend-item"><span class="led up"></span> 58 up</span>
            <span class="legend-item"><span class="led down"></span> 4 down</span>
            <span class="legend-item"><span class="led disabled"></span> 10 disabled</span>
          </div>
        </div>
      </div>
    </div>

    <div class="led-legend">
      <div class="led-legend-title">LED Status Colors</div>
      <div class="led-legend-grid">
        <div class="led-legend-item">
          <span class="led-sample up"></span>
          <span class="led-desc">Green: Port up, normal operation</span>
        </div>
        <div class="led-legend-item">
          <span class="led-sample down"></span>
          <span class="led-desc">Red: Port down, link failure</span>
        </div>
        <div class="led-legend-item">
          <span class="led-sample warning"></span>
          <span class="led-desc">Amber: Up but &gt;80% utilization</span>
        </div>
        <div class="led-legend-item">
          <span class="led-sample disabled"></span>
          <span class="led-desc">Grey: Admin disabled</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Port Detail Panel</h3>
    <p class="section-desc">Clicking a port opens an expanded detail view:</p>
    <div class="port-detail-mockup">
      <div class="detail-header">
        <span class="detail-back">‚Üê Back</span>
        <span class="detail-port"><span class="detail-led up"></span> Gi1/0/24</span>
      </div>
      <div class="detail-body">
        <div class="detail-alias">Office HP LaserJet</div>
        <div class="detail-row">
          <div class="detail-stat">
            <span class="stat-label">Status</span>
            <span class="stat-value up">‚óè up</span>
          </div>
          <div class="detail-stat">
            <span class="stat-label">Speed</span>
            <span class="stat-value">1G</span>
          </div>
        </div>
        <div class="detail-section">
          <span class="section-label">Utilization</span>
          <div class="util-bar">
            <div class="util-fill" style="width: 45%"></div>
          </div>
          <span class="util-pct">45%</span>
        </div>
        <div class="detail-section">
          <span class="section-label">Traffic</span>
          <div class="traffic-stats">
            <div class="traffic-box">
              <span class="traffic-dir">In</span>
              <span class="traffic-value">12.5</span>
              <span class="traffic-unit">Mbps</span>
            </div>
            <div class="traffic-box">
              <span class="traffic-dir">Out</span>
              <span class="traffic-value">2.3</span>
              <span class="traffic-unit">Mbps</span>
            </div>
          </div>
        </div>
        <div class="detail-badges">
          <span class="badge trunk">Trunk</span>
          <span class="badge poe">PoE: 12.5W</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Component Hierarchy</h3>
    <div class="component-tree">
      <div class="tree-node root">PortGrid.tsx</div>
      <div class="tree-children">
        <div class="tree-node">Chassis Container (dark metallic styling)</div>
        <div class="tree-children">
          <div class="tree-node">Bezel Top: "CISCO" brand + device name</div>
          <div class="tree-node">Uplink Module: PortSquare[] (variant="sfp")</div>
          <div class="tree-node">Port Modules (for each line card)</div>
          <div class="tree-children">
            <div class="tree-node">PortBankDisplay (for each bank of 24)</div>
            <div class="tree-children">
              <div class="tree-node">Port number labels (1, 3, 5...)</div>
              <div class="tree-node">Top row: PortSquare[] (odd ports)</div>
              <div class="tree-node">Bottom row: PortSquare[] (even ports)</div>
            </div>
          </div>
          <div class="tree-node">Bezel Bottom: Status legend</div>
        </div>
        <div class="tree-node">Other Interfaces (VLANs, mgmt, loopback)</div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">Data source</span>
        <span class="tech-value">LibreNMS /api/v0/devices/{`{id}`}/ports</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Parsing</span>
        <span class="tech-value">Regex matching for Cisco naming conventions</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Layout</span>
        <span class="tech-value">CSS Flexbox, 12 ports per row</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Port sizing</span>
        <span class="tech-value">RJ45: 18√ó14px, SFP: 24√ó20px</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">State</span>
        <span class="tech-value">React useState for selected port, hover tooltip</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Interactivity</span>
        <span class="tech-value">Click ‚Üí detail panel, hover ‚Üí tooltip</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Responsiveness</span>
        <span class="tech-value">Wraps naturally, banks stack vertically</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Why This Layout</h3>
    <div class="approach-grid">
      <div class="approach-item">
        <span class="approach-icon">üîå</span>
        <div class="approach-content">
          <span class="approach-title">Physical accuracy</span>
          <span class="approach-desc">Odd ports top, even bottom; matches actual Cisco Catalyst hardware</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üì¶</span>
        <div class="approach-content">
          <span class="approach-title">Banks of 24</span>
          <span class="approach-desc">Matches line card groupings on physical switches</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">‚¨ÜÔ∏è</span>
        <div class="approach-content">
          <span class="approach-title">SFP+ at top</span>
          <span class="approach-desc">Mirrors physical uplink placement on switch chassis</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üè∑Ô∏è</span>
        <div class="approach-content">
          <span class="approach-title">Module labels</span>
          <span class="approach-desc">For modular switches (4506, etc.) with multiple line cards</span>
        </div>
      </div>
      <div class="approach-item">
        <span class="approach-icon">üëÅÔ∏è</span>
        <div class="approach-content">
          <span class="approach-title">Rack correlation</span>
          <span class="approach-desc">Engineers can match dashboard to physical port at a glance</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Proxmox Panel -->
  <div class="feature-deepdive" id="proxmox-panel">
    <h2>// Feature Deep Dive: Proxmox Panel</h2>
    <p class="deepdive-intro">
      When clicking a Proxmox hypervisor node in the topology, this panel displays a detailed dashboard
      showing the node's health, all VMs and containers with live CPU/RAM metrics, and storage pool
      utilization with color-coded capacity warnings.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üñ•Ô∏è</span>
        <span class="usecase-title">Use Case: At-a-Glance Hypervisor Health</span>
      </div>
      <p class="usecase-desc">
        NOC operators need quick visibility into what's running on each Proxmox node without logging into
        the Proxmox web UI. This panel shows running/stopped VMs, resource consumption, and storage capacity
        in the same sidebar used for network device details.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Data Flow</h3>

    <div class="deepdive-flow">
      <!-- User Action -->
      <div class="flow-block widget">
        <div class="block-header">
          <span class="block-icon">üñ±Ô∏è</span>
          <span class="block-title">USER ACTION</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> User clicks Proxmox node in topology (e.g., "proxmox1")</div>
          <div class="backend-step"><span class="step-num">2</span> DeviceCard.tsx detects device_type === 'hypervisor'</div>
          <div class="backend-step"><span class="step-num">3</span> ProxmoxPanel.tsx renders with nodeName prop</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>
      <div class="api-call-label">GET /api/vms/node/{`{nodeName}`}</div>
      <div class="flow-arrow-down">‚ñº</div>

      <!-- Backend -->
      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üêç</span>
          <span class="block-title">BACKEND (vms.py)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Look up node in Redis cache (match by name, instance, or normalized input)</div>
          <div class="backend-step"><span class="step-num">2</span> Filter VMs/LXCs from cache, separate into QEMU and LXC lists</div>
          <div class="backend-step"><span class="step-num">3</span> Fetch storage pools from Proxmox API (on-demand, not cached)</div>
          <div class="backend-step"><span class="step-num">4</span> Calculate running/total counts for summary badges</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <!-- API Response -->
      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üìã</span>
          <span class="block-title">API RESPONSE</span>
        </div>
        <div class="block-code">
          <pre><code>{`{
  "node": {
    "node": "proxmox1", "status": "online",
    "cpu": 23.5, "memory": 67.2,
    "maxcpu": 32, "maxmem": 137438953472
  },
  "vms": [
    { "vmid": 100, "name": "dc1", "status": "running",
      "cpu": 2.3, "memory": 45.0 }
  ],
  "lxcs": [
    { "vmid": 200, "name": "librenms", "status": "running",
      "cpu": 5.1, "memory": 32.0 }
  ],
  "storage": [
    { "storage": "local-zfs", "type": "zfspool",
      "used": 500000000000, "total": 2000000000000,
      "used_percent": 25.0 }
  ],
  "vms_running": 8, "vms_total": 10,
  "lxcs_running": 12, "lxcs_total": 12
}`}</code></pre>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Layout</h3>
    <div class="proxmox-panel-mockup">
      <div class="pve-section">
        <div class="pve-section-header">
          <span class="pve-section-icon">üñ•Ô∏è</span>
          <span class="pve-section-title">NODE</span>
          <span class="pve-section-count">1 / 1</span>
        </div>
        <div class="pve-section-body">
          <div class="pve-columns">
            <span class="pve-col-name">Name</span>
            <span class="pve-col-cpu">CPU</span>
            <span class="pve-col-ram">RAM</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">proxmox1</span>
            <span class="pve-cpu">23.5%</span>
            <span class="pve-ram">67.2%</span>
          </div>
        </div>
      </div>

      <div class="pve-section">
        <div class="pve-section-header">
          <span class="pve-section-icon">üíª</span>
          <span class="pve-section-title">VMS</span>
          <span class="pve-section-count">8 / 10</span>
        </div>
        <div class="pve-section-body">
          <div class="pve-columns">
            <span class="pve-col-name">Name</span>
            <span class="pve-col-cpu">CPU</span>
            <span class="pve-col-ram">RAM</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">dc1</span>
            <span class="pve-cpu">2.3%</span>
            <span class="pve-ram">45.0%</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">wazuh-manager</span>
            <span class="pve-cpu">12.5%</span>
            <span class="pve-ram">78.3%</span>
          </div>
          <div class="pve-row">
            <span class="pve-status stopped"></span>
            <span class="pve-name">template-win11</span>
            <span class="pve-cpu">0.0%</span>
            <span class="pve-ram">0.0%</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">thehive</span>
            <span class="pve-cpu">8.2%</span>
            <span class="pve-ram">65.4%</span>
          </div>
        </div>
      </div>

      <div class="pve-section">
        <div class="pve-section-header">
          <span class="pve-section-icon">üì¶</span>
          <span class="pve-section-title">LXCS</span>
          <span class="pve-section-count">12 / 12</span>
        </div>
        <div class="pve-section-body">
          <div class="pve-columns">
            <span class="pve-col-name">Name</span>
            <span class="pve-col-cpu">CPU</span>
            <span class="pve-col-ram">RAM</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">librenms</span>
            <span class="pve-cpu">5.1%</span>
            <span class="pve-ram">32.0%</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">netdisco</span>
            <span class="pve-cpu">1.2%</span>
            <span class="pve-ram">18.5%</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">watchtower</span>
            <span class="pve-cpu">3.4%</span>
            <span class="pve-ram">24.2%</span>
          </div>
          <div class="pve-row">
            <span class="pve-status running"></span>
            <span class="pve-name">wazuh-indexer</span>
            <span class="pve-cpu">15.2%</span>
            <span class="pve-ram">85.3%</span>
          </div>
        </div>
      </div>

      <div class="pve-section">
        <div class="pve-section-header">
          <span class="pve-section-icon">üíæ</span>
          <span class="pve-section-title">STORAGE</span>
          <span class="pve-section-count">3 / 3</span>
        </div>
        <div class="pve-section-body storage">
          <div class="storage-item">
            <div class="storage-header">
              <span class="storage-name">local-zfs</span>
              <span class="storage-type">zfspool</span>
            </div>
            <div class="storage-bar-container">
              <div class="storage-bar normal" style="width: 25%"></div>
            </div>
            <div class="storage-stats">
              <span class="storage-used">500 GB / 2.0 TB</span>
              <span class="storage-pct">25.0%</span>
            </div>
          </div>
          <div class="storage-item">
            <div class="storage-header">
              <span class="storage-name">ceph-pool</span>
              <span class="storage-type">rbd</span>
            </div>
            <div class="storage-bar-container">
              <div class="storage-bar normal" style="width: 64%"></div>
            </div>
            <div class="storage-stats">
              <span class="storage-used">3.2 TB / 5.0 TB</span>
              <span class="storage-pct">64.0%</span>
            </div>
          </div>
          <div class="storage-item">
            <div class="storage-header">
              <span class="storage-name">backup-nfs</span>
              <span class="storage-type warning">nfs</span>
            </div>
            <div class="storage-bar-container">
              <div class="storage-bar warning" style="width: 85%"></div>
            </div>
            <div class="storage-stats">
              <span class="storage-used">8.5 TB / 10.0 TB</span>
              <span class="storage-pct warning">85.0%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="pve-legend">
      <div class="pve-legend-title">Legend</div>
      <div class="pve-legend-grid">
        <div class="pve-legend-item">
          <span class="pve-legend-dot running"></span>
          <span>Running / Online</span>
        </div>
        <div class="pve-legend-item">
          <span class="pve-legend-dot stopped"></span>
          <span>Stopped</span>
        </div>
        <div class="pve-legend-item">
          <span class="pve-legend-sample cpu">23.5%</span>
          <span>CPU (blue)</span>
        </div>
        <div class="pve-legend-item">
          <span class="pve-legend-sample ram">67.2%</span>
          <span>RAM (purple)</span>
        </div>
      </div>
      <div class="pve-legend-storage">
        <span class="pve-legend-bar normal"></span> Normal (&lt;70%)
        <span class="pve-legend-bar warning"></span> Warning (70-90%)
        <span class="pve-legend-bar critical"></span> Critical (&gt;90%)
      </div>
    </div>

    <h3 class="deepdive-subhead">// Data Sources</h3>
    <div class="data-sources-block">
      <div class="data-source">
        <span class="source-label">scheduler.py</span>
        <span class="source-desc">poll_proxmox() runs every 60 seconds</span>
      </div>
      <div class="data-source-endpoints">
        <div class="endpoint">
          <code>GET /api2/json/nodes</code>
          <span>‚Üí Node health (cached in CACHE_PROXMOX)</span>
        </div>
        <div class="endpoint">
          <code>GET /api2/json/nodes/{`{node}`}/qemu</code>
          <span>‚Üí VMs per node (cached in CACHE_PROXMOX_VMS)</span>
        </div>
        <div class="endpoint">
          <code>GET /api2/json/nodes/{`{node}`}/lxc</code>
          <span>‚Üí Containers per node (cached)</span>
        </div>
        <div class="endpoint">
          <code>GET /api2/json/nodes/{`{node}`}/storage</code>
          <span>‚Üí Storage pools (fetched on-demand)</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Node Matching Logic</h3>
    <p class="section-desc">
      The backend uses multiple strategies to match clicked nodes flexibly:
    </p>
    <div class="matching-strategies">
      <div class="strategy">
        <span class="strategy-num">1</span>
        <span class="strategy-name">Exact match</span>
        <span class="strategy-example">"proxmox1" ‚Üí matches node "proxmox1"</span>
      </div>
      <div class="strategy">
        <span class="strategy-num">2</span>
        <span class="strategy-name">Normalized</span>
        <span class="strategy-example">"Proxmox 1" ‚Üí matches "proxmox1" (ignores spaces, case)</span>
      </div>
      <div class="strategy">
        <span class="strategy-num">3</span>
        <span class="strategy-name">Partial</span>
        <span class="strategy-example">"host20" ‚Üí matches node in instance "pve-netlab"</span>
      </div>
      <div class="strategy">
        <span class="strategy-num">4</span>
        <span class="strategy-name">Reverse</span>
        <span class="strategy-example">Key "pve:host20" contains input "host20"</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">API Auth</span>
        <span class="tech-value">PVEAPIToken=user@realm!tokenid=secret header</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">CPU values</span>
        <span class="tech-value">0.0-1.0 from API, multiply by 100 for display %</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Memory</span>
        <span class="tech-value">Bytes from API, converted with formatBytes()</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Polling</span>
        <span class="tech-value">60 seconds (scheduler), 30 seconds (panel refresh)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Storage</span>
        <span class="tech-value">Fetched on-demand when panel opens (always fresh)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Node matching</span>
        <span class="tech-value">Multiple strategies for flexible matching</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// API Endpoints</h3>
    <div class="api-endpoints-list">
      <div class="api-endpoint">
        <code>GET /api/vms</code>
        <span>All running VMs/LXCs with summary stats</span>
      </div>
      <div class="api-endpoint">
        <code>GET /api/vms/summary</code>
        <span>Just the counts (total_running, total_qemu, total_lxc)</span>
      </div>
      <div class="api-endpoint">
        <code>GET /api/vms/node/{`{node_name}`}</code>
        <span>Full node detail with VMs, LXCs, storage (used by panel)</span>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: L2/L3 Topology Toggle -->
  <div class="feature-deepdive" id="l2l3-toggle">
    <h2>// Feature Deep Dive: L2/L3 Topology Toggle</h2>
    <p class="deepdive-intro">
      Toggles between two fundamentally different network visualizations: L2 Physical View shows CDP/LLDP
      discovered switch connections and device clusters, while L3 Logical View groups devices by VLAN
      membership with gateway routing relationships.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üîÄ</span>
        <span class="usecase-title">Use Case: Dual Perspectives for Network Engineers</span>
      </div>
      <p class="usecase-desc">
        Network engineers need to see the network from two perspectives. The Physical (L2) view shows
        "what's plugged into what": actual cable connections discovered via CDP/LLDP. The Logical (L3)
        view shows "what talks to what": devices grouped by their VLAN assignments with inter-VLAN
        gateways highlighted.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Architecture</h3>
    <div class="l2l3-architecture">
      <div class="arch-trigger">
        <div class="arch-trigger-label">VIEW MODE TOGGLE</div>
        <div class="arch-trigger-desc">User clicks "Physical (L2)" or "Logical (L3)"</div>
      </div>

      <div class="arch-split">
        <div class="arch-branch l2">
          <div class="branch-header">
            <span class="branch-badge l2">L2 Physical</span>
          </div>
          <div class="branch-flow">
            <div class="branch-step">TopologyCanvas.tsx</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step">Uses cached topology data from WebSocket updates</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step">topologyToNodes() / topologyToEdges()</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-creates">
              <span class="creates-label">Creates:</span>
              <ul>
                <li>ClusterNode for each cluster</li>
                <li>DeviceNode when expanded</li>
                <li>ExternalNode for WAN links</li>
                <li>PhysicalLinkEdge for CDP/LLDP</li>
              </ul>
            </div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-result">ReactFlow renders L2 topology with clusters, devices, and CDP/LLDP connections</div>
          </div>
        </div>

        <div class="arch-branch l3">
          <div class="branch-header">
            <span class="branch-badge l3">L3 Logical</span>
          </div>
          <div class="branch-flow">
            <div class="branch-step">fetchL3Topology()</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step api">GET /api/topology/l3</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step">BACKEND: get_l3_topology()</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-creates">
              <span class="creates-label">Aggregator:</span>
              <ul>
                <li>Load VLANs from Redis</li>
                <li>Map LibreNMS IDs ‚Üí topology IDs</li>
                <li>Group devices by VLAN</li>
                <li>Identify gateway devices</li>
              </ul>
            </div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step">l3TopologyToNodes() / l3TopologyToEdges()</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-result">ReactFlow renders L3 topology with VLAN groups and routing edges</div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Layout</h3>

    <div class="view-mockup-container">
      <div class="view-mockup l2-mockup">
        <div class="mockup-header">
          <span class="mockup-title">L2 Physical View</span>
          <span class="mockup-theme">(Cyan theme)</span>
        </div>
        <div class="mockup-toolbar">
          <span class="toggle-btn active l2">Physical (L2)</span>
          <span class="toggle-btn l3">Logical (L3)</span>
          <span class="mockup-spacer"></span>
          <span class="toolbar-btn">Visualize</span>
          <span class="toolbar-btn">Export</span>
          <span class="toolbar-btn">Reset</span>
        </div>
        <div class="mockup-canvas">
          <div class="l2-cluster core">
            <div class="cluster-name">Core Network</div>
            <div class="cluster-devices">
              <span class="device-dot up"></span> cat-1
              <span class="device-dot up"></span> cat-2
              <span class="device-dot up"></span> cat-3
            </div>
          </div>
          <div class="l2-link core-fw">10G</div>
          <div class="l2-cluster firewall">
            <div class="cluster-name">Firewalls</div>
            <div class="cluster-devices">
              <span class="device-dot up"></span> pa-3410
            </div>
          </div>
          <div class="l2-link core-access">10G</div>
          <div class="l2-link fw-wan">1G</div>
          <div class="l2-cluster access">
            <div class="cluster-name">Access Layer</div>
            <div class="cluster-devices collapsed">+ 6 devices</div>
          </div>
          <div class="l2-external">
            <span class="external-icon">‚òÅ</span> Internet
            <span class="wan-badge">WAN</span>
          </div>
        </div>
        <div class="mockup-legend">
          <span class="legend-title">LINK COLORS</span>
          <div class="legend-items">
            <span class="legend-item"><span class="link-color green"></span> Healthy (Speedtest OK)</span>
            <span class="legend-item"><span class="link-color blue"></span> Active Link</span>
            <span class="legend-item"><span class="link-color yellow"></span> Degraded / Warning</span>
            <span class="legend-item"><span class="link-color red"></span> Down</span>
            <span class="legend-item"><span class="link-color grey"></span> Dumb switch (no CDP)</span>
          </div>
        </div>
      </div>

      <div class="view-mockup l3-mockup">
        <div class="mockup-header">
          <span class="mockup-title">L3 Logical View</span>
          <span class="mockup-theme">(Purple theme)</span>
        </div>
        <div class="mockup-toolbar">
          <span class="toggle-btn l2">Physical (L2)</span>
          <span class="toggle-btn active l3">Logical (L3)</span>
          <span class="mockup-spacer"></span>
          <span class="toolbar-btn">Reset Layout</span>
        </div>
        <div class="mockup-canvas l3-canvas">
          <div class="vlan-row">
            <div class="vlan-group">
              <div class="vlan-header">
                <span class="vlan-icon">üî≤</span>
                <span class="vlan-id">VLAN 10</span>
                <span class="gw-badge">GW</span>
              </div>
              <div class="vlan-name">Management</div>
              <div class="vlan-devices">
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
              </div>
              <div class="vlan-count">4 devices</div>
            </div>
            <div class="vlan-edge">GW</div>
            <div class="vlan-group">
              <div class="vlan-header">
                <span class="vlan-icon">üî≤</span>
                <span class="vlan-id">VLAN 20</span>
                <span class="gw-badge">GW</span>
              </div>
              <div class="vlan-name">Servers</div>
              <div class="vlan-devices">
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
              </div>
              <div class="vlan-count">5 devices</div>
            </div>
          </div>
          <div class="vlan-connectors">
            <span class="vlan-connector-line"></span>
            <span class="vlan-connector-line"></span>
          </div>
          <div class="vlan-row">
            <div class="vlan-group">
              <div class="vlan-header">
                <span class="vlan-icon">üî≤</span>
                <span class="vlan-id">VLAN 100</span>
              </div>
              <div class="vlan-name">Student Labs</div>
              <div class="vlan-devices">
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot down"></span>
              </div>
              <div class="vlan-count">12 devices</div>
            </div>
            <div class="vlan-edge">GW</div>
            <div class="vlan-group">
              <div class="vlan-header">
                <span class="vlan-icon">üî≤</span>
                <span class="vlan-id">VLAN 200</span>
              </div>
              <div class="vlan-name">Faculty</div>
              <div class="vlan-devices">
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
                <span class="vlan-dot up"></span>
              </div>
              <div class="vlan-count">3 devices</div>
            </div>
          </div>
        </div>
        <div class="mockup-legend vlan-filter">
          <span class="legend-title">VLAN FILTER</span>
          <div class="filter-chips">
            <span class="filter-chip active">‚òë VLAN 10</span>
            <span class="filter-chip active">‚òë VLAN 20</span>
            <span class="filter-chip">‚òê VLAN 100</span>
            <span class="filter-chip">‚òê VLAN 200</span>
            <span class="filter-clear">[Clear]</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// VlanGroupNode Component</h3>
    <div class="vlan-node-mockup">
      <div class="vng-header">
        <span class="vng-icon">üî≤</span>
        <span class="vng-id">VLAN 10</span>
        <span class="vng-gw">GW</span>
      </div>
      <div class="vng-name">Management Network</div>
      <div class="vng-grid">
        <span class="vng-dot up"></span>
        <span class="vng-dot up"></span>
        <span class="vng-dot up"></span>
        <span class="vng-dot up gw"></span>
        <span class="vng-dot up"></span>
        <span class="vng-dot up"></span>
        <span class="vng-dot up gw"></span>
        <span class="vng-dot down"></span>
        <span class="vng-dot up"></span>
        <span class="vng-dot up"></span>
      </div>
      <div class="vng-footer">
        <span class="vng-count">10 devices</span>
        <span class="vng-status healthy">All healthy</span>
      </div>
      <div class="vng-legend">
        <span class="vng-legend-item"><span class="vng-dot up small"></span> up (green)</span>
        <span class="vng-legend-item"><span class="vng-dot down small"></span> down (red)</span>
        <span class="vng-legend-item"><span class="vng-dot up gw small"></span> gateway (purple ring)</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Gateway Detection Algorithm</h3>
    <div class="algorithm-block">
      <div class="algo-step">
        <span class="algo-num">1</span>
        <div class="algo-content">
          <span class="algo-title">Build device-to-VLAN mapping</span>
          <code>For each VLAN membership: device_vlans[device_id].add(vlan_id)</code>
        </div>
      </div>
      <div class="algo-step">
        <span class="algo-num">2</span>
        <div class="algo-content">
          <span class="algo-title">Identify gateways</span>
          <code>IF len(device_vlans[device]) &gt; 1: gateway_devices.append(device)</code>
        </div>
      </div>
      <div class="algo-step">
        <span class="algo-num">3</span>
        <div class="algo-content">
          <span class="algo-title">Mark gateways in VLAN groups</span>
          <code>device.is_gateway = device_id in gateway_devices</code>
        </div>
      </div>
      <div class="algo-result">
        <span class="result-icon">‚Üí</span>
        <div class="result-content">
          <div class="result-item"><span class="result-check">‚úì</span> Core switches are gateways (in VLAN 1, 10, 20, 100, etc.)</div>
          <div class="result-item"><span class="result-check">‚úì</span> Access devices are NOT gateways (only in one VLAN)</div>
          <div class="result-item"><span class="result-check">‚úì</span> L3 edges connect VLANs that share gateway devices</div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// L3 Edge Connection Algorithm</h3>
    <div class="algorithm-block">
      <div class="algo-step">
        <span class="algo-num">1</span>
        <div class="algo-content">
          <span class="algo-title">Build gateway-to-VLANs map</span>
          <code>gatewayToVlans[gateway_device].append(vlan_id)</code>
        </div>
      </div>
      <div class="algo-step">
        <span class="algo-num">2</span>
        <div class="algo-content">
          <span class="algo-title">Create edges between VLANs sharing gateways</span>
          <code>For each pair (vlan_i, vlan_j): Create edge vlan-i ‚Üî vlan-j</code>
        </div>
      </div>
      <div class="algo-example">
        <span class="example-label">Example:</span>
        <div class="example-content">
          <div class="example-input">Gateway "cat-1" is in VLANs [10, 20, 100]</div>
          <div class="example-output">
            Creates edges: VLAN 10 ‚Üî VLAN 20, VLAN 10 ‚Üî VLAN 100, VLAN 20 ‚Üî VLAN 100
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Data Models</h3>
    <div class="models-grid">
      <div class="model-block">
        <div class="model-header">
          <span class="model-icon">üêç</span>
          <span class="model-title">Backend Models (vlan.py)</span>
        </div>
        <div class="model-code">
          <pre><code>{`class Vlan:
    vlan_id: int           # e.g., 10, 20, 100
    vlan_name: str | None  # e.g., "Management"
    device_count: int

class VlanMembership:
    device_id: str         # Topology device ID
    librenms_device_id: int
    port_name: str | None  # e.g., "Gi1/0/24"
    vlan_id: int
    is_untagged: bool

class L3TopologyNode:
    device_id: str
    display_name: str
    status: str            # "up", "down", "unknown"
    is_gateway: bool       # True if multi-VLAN
    vlan_ids: list[int]

class L3TopologyVlanGroup:
    vlan_id: int
    vlan_name: str | None
    devices: list[L3TopologyNode]
    gateway_devices: list[str]`}</code></pre>
        </div>
      </div>

      <div class="model-block">
        <div class="model-header">
          <span class="model-icon">üìò</span>
          <span class="model-title">Frontend Types (vlan.ts)</span>
        </div>
        <div class="model-code">
          <pre><code>{`type ViewMode = 'l2' | 'l3'

interface L3Topology {
  vlans: Vlan[]
  memberships: VlanMembership[]
  vlan_groups: L3TopologyVlanGroup[]
  gateway_devices: string[]
}

// Zustand Store (nocStore.ts)
interface NocState {
  viewMode: ViewMode
  l3Topology: L3Topology | null
  selectedVlans: Set<number>

  setViewMode: (mode: ViewMode) => void
  setL3Topology: (t: L3Topology | null) => void
  toggleVlanFilter: (id: number) => void
  clearVlanFilter: () => void
}`}</code></pre>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Data Flow</h3>
    <div class="deepdive-flow">
      <div class="flow-block config">
        <div class="block-header">
          <span class="block-icon">üì°</span>
          <span class="block-title">LIBRENMS API</span>
        </div>
        <div class="block-steps">
          <code>GET /resources/vlans</code>
          <span class="step-desc">Returns all VLANs with device_id mappings</span>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">‚è±Ô∏è</span>
          <span class="block-title">SCHEDULER (poll_vlans)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Runs every 300 seconds</div>
          <div class="backend-step"><span class="step-num">2</span> Stores CACHE_VLANS (unique VLANs)</div>
          <div class="backend-step"><span class="step-num">3</span> Stores CACHE_VLAN_MEMBERSHIPS (port‚ÜíVLAN)</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>
      <div class="api-call-label">GET /api/topology/l3</div>
      <div class="flow-arrow-down">‚ñº</div>

      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üîß</span>
          <span class="block-title">AGGREGATOR (get_l3_topology)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Map LibreNMS IDs to topology IDs</div>
          <div class="backend-step"><span class="step-num">2</span> Group devices by VLAN</div>
          <div class="backend-step"><span class="step-num">3</span> Detect gateways (multi-VLAN devices)</div>
          <div class="backend-step"><span class="step-num">4</span> Build vlan_groups with nodes</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üìã</span>
          <span class="block-title">API RESPONSE</span>
        </div>
        <div class="block-code">
          <pre><code>{`{
  "vlans": [{ "vlan_id": 10, "vlan_name": "Management", "device_count": 8 }],
  "memberships": [{ "device_id": "cat-1", "vlan_id": 10, "port_name": "Gi1/0/1" }],
  "vlan_groups": [{
    "vlan_id": 10,
    "vlan_name": "Management",
    "devices": [{ "device_id": "cat-1", "is_gateway": true, "status": "up" }],
    "gateway_devices": ["cat-1", "cat-2"]
  }],
  "gateway_devices": ["cat-1", "cat-2", "cat-3"]
}`}</code></pre>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <div class="flow-block widget">
        <div class="block-header">
          <span class="block-icon">‚öõÔ∏è</span>
          <span class="block-title">FRONTEND TRANSFORM</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> l3TopologyToNodes() creates VlanGroupNode per VLAN</div>
          <div class="backend-step"><span class="step-num">2</span> Grid layout: columns = ‚àö(vlan_count)</div>
          <div class="backend-step"><span class="step-num">3</span> l3TopologyToEdges() connects shared-gateway VLANs</div>
          <div class="backend-step"><span class="step-num">4</span> Purple dashed edges for routing relationships</div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Component Hierarchy</h3>
    <div class="component-tree">
      <div class="tree-root">TopologyCanvas.tsx</div>
      <div class="tree-children">
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">View Mode Toggle</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">"Physical (L2)" button <span class="tree-note">[Cyan when active]</span></span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">"Logical (L3)" button <span class="tree-note">[Purple when active]</span></span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">L2 Mode (viewMode === 'l2')</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">ClusterNode[] - device clusters with status dots</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">DeviceNode[] - expanded cluster devices</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">ExternalNode[] - WAN links</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">PhysicalLinkEdge[] - CDP/LLDP connections</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">Mermaid export buttons</span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îî‚îÄ‚îÄ</span>
          <span class="tree-name">L3 Mode (viewMode === 'l3')</span>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">VlanGroupNode[] - VLAN boxes with device grids</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">L3 Edges - purple dashed gateway connections</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">VLAN Filter Sidebar - checkbox chips</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">VLAN polling</span>
        <span class="tech-value">300s interval (same as topology)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Gateway detection</span>
        <span class="tech-value">Devices in &gt;1 VLAN automatically flagged</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">L3 node layout</span>
        <span class="tech-value">Grid with ‚àö(count) columns</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">L3 edge creation</span>
        <span class="tech-value">Connect VLANs sharing gateway devices</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">View persistence</span>
        <span class="tech-value">LocalStorage for node positions per view mode</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">VLAN filter</span>
        <span class="tech-value">Clickable chips, filters displayed groups</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Theme colors</span>
        <span class="tech-value">Cyan = L2/Physical, Purple = L3/Logical</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Loading state</span>
        <span class="tech-value">"Loading L3 topology..." while fetching</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// UI States</h3>
    <div class="ui-states-table">
      <div class="state-row header">
        <span class="state-name">State</span>
        <span class="state-display">Display</span>
      </div>
      <div class="state-row">
        <span class="state-name">L2 active</span>
        <span class="state-display">Cyan toggle button, cluster/device/link view</span>
      </div>
      <div class="state-row">
        <span class="state-name">L3 active</span>
        <span class="state-display">Purple toggle button, VLAN group view</span>
      </div>
      <div class="state-row">
        <span class="state-name">L3 loading</span>
        <span class="state-display">Centered "Loading L3 topology..." spinner</span>
      </div>
      <div class="state-row">
        <span class="state-name">VLAN filtered</span>
        <span class="state-display">Only selected VLANs visible, Clear button enabled</span>
      </div>
      <div class="state-row">
        <span class="state-name">No filter</span>
        <span class="state-display">All VLANs displayed in grid</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Tech Stack</h3>
    <div class="tech-stack-table">
      <div class="stack-row">
        <span class="stack-layer">Data Source</span>
        <span class="stack-tech">LibreNMS /resources/vlans endpoint</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Backend</span>
        <span class="stack-tech">FastAPI, Redis cache</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Polling</span>
        <span class="stack-tech">APScheduler (300s interval)</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Frontend</span>
        <span class="stack-tech">React, TypeScript, ReactFlow</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">State</span>
        <span class="stack-tech">Zustand store</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Styling</span>
        <span class="stack-tech">Tailwind CSS (purple accent for L3)</span>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Mermaid Export -->
  <div class="feature-deepdive" id="mermaid-export">
    <h2>// Feature Deep Dive: Mermaid Topology Export</h2>
    <p class="deepdive-intro">
      Generates a Mermaid flowchart diagram from the live network topology data, allowing users to either
      view an interactive visualization in a modal or download a <code>.mmd</code> file for use in
      documentation, wikis, or presentations.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üìù</span>
        <span class="usecase-title">Use Case: Portable Network Documentation</span>
      </div>
      <p class="usecase-desc">
        NOC operators and network engineers need to document or share the network topology without giving
        direct dashboard access. The Mermaid export creates portable diagram code that renders in GitHub
        READMEs, Confluence, Notion, Obsidian, and any Mermaid-compatible tool. The visualize modal
        provides immediate in-app viewing with pan/zoom controls.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Architecture</h3>
    <div class="mermaid-architecture">
      <div class="arch-trigger">
        <div class="arch-trigger-label">USER INTERACTION</div>
        <div class="arch-trigger-desc">User clicks "Visualize" or "Export Mermaid"</div>
      </div>

      <div class="arch-split">
        <div class="arch-branch mermaid-visualize">
          <div class="branch-header">
            <span class="branch-badge visualize">Visualize</span>
          </div>
          <div class="branch-flow">
            <div class="branch-step">handleVisualizeMermaid()</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-creates">
              <span class="creates-label">Steps:</span>
              <ul>
                <li>Get topology from store</li>
                <li>generateMermaidDiagram(topology)</li>
                <li>setMermaidDiagram(content)</li>
                <li>setShowMermaidModal(true)</li>
              </ul>
            </div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step">MermaidModal.tsx</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-creates">
              <span class="creates-label">Render:</span>
              <ul>
                <li>mermaid.render('mermaid-diagram', diagram)</li>
                <li>Parse SVG output</li>
                <li>Inject into container</li>
                <li>Pan/zoom controls</li>
              </ul>
            </div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-result">Interactive SVG diagram with dark theme styling</div>
          </div>
        </div>

        <div class="arch-branch mermaid-export-branch">
          <div class="branch-header">
            <span class="branch-badge export">Export</span>
          </div>
          <div class="branch-flow">
            <div class="branch-step">handleExportMermaid()</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-creates">
              <span class="creates-label">Steps:</span>
              <ul>
                <li>Get topology from store</li>
                <li>generateMermaidDiagram(topology)</li>
                <li>downloadFile(content, filename)</li>
              </ul>
            </div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-step">Browser Download API</div>
            <div class="branch-arrow">‚Üì</div>
            <div class="branch-result">Downloads "topology-YYYY-MM-DD.mmd"</div>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Layout</h3>

    <div class="mermaid-modal-mockup">
      <div class="modal-header">
        <div class="modal-title">
          <span class="modal-icon">üìä</span>
          <span>Network Topology Diagram</span>
        </div>
        <div class="modal-controls">
          <span class="zoom-btn">‚àí</span>
          <span class="zoom-level">100%</span>
          <span class="zoom-btn">+</span>
          <span class="zoom-btn reset">‚§¢</span>
          <span class="zoom-btn close">‚úï</span>
        </div>
      </div>
      <div class="modal-canvas">
        <div class="mermaid-diagram-preview">
          <div class="mermaid-subgraph core">
            <div class="subgraph-label">Core Network</div>
            <div class="mermaid-nodes">
              <div class="mermaid-node hexagon">
                <span class="node-name">cat-1</span>
                <span class="node-ip">10.2.10.1</span>
              </div>
              <div class="mermaid-node hexagon">
                <span class="node-name">cat-2</span>
                <span class="node-ip">10.2.10.2</span>
              </div>
            </div>
          </div>
          <div class="mermaid-link labeled">Gi0/1 ‚Üî Gi0/2</div>
          <div class="mermaid-subgraph firewall">
            <div class="subgraph-label">Firewalls</div>
            <div class="mermaid-nodes">
              <div class="mermaid-node trapezoid">
                <span class="node-name">pa-3410</span>
                <span class="node-ip">10.2.60.3</span>
              </div>
            </div>
          </div>
          <div class="mermaid-link dashed">‚îÜ</div>
          <div class="mermaid-external">
            <span class="external-circle">(( Internet ))</span>
          </div>
        </div>
        <div class="mermaid-legend">
          <div class="legend-title">üìã Legend</div>
          <div class="legend-section">
            <div class="legend-label">Device Types</div>
            <div class="legend-item"><span class="shape-hex">‚¨°</span> Switch</div>
            <div class="legend-item"><span class="shape-trap">‚ó¢</span> Firewall</div>
            <div class="legend-item"><span class="shape-rect">‚ñ≠</span> Server</div>
            <div class="legend-item"><span class="shape-circle">‚óè</span> External</div>
          </div>
          <div class="legend-section">
            <div class="legend-label">Connections</div>
            <div class="legend-item"><span class="line-solid">‚îÄ‚îÄ</span> Physical</div>
            <div class="legend-item"><span class="line-dashed">‚îÑ‚îÑ</span> WAN/External</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <span class="footer-hint">Drag to pan ‚Ä¢ Scroll to zoom ‚Ä¢ Press Esc to close</span>
        <span class="footer-powered">Powered by Mermaid</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Mermaid Generation Algorithm</h3>
    <div class="algorithm-block">
      <div class="algo-input">
        <span class="input-label">INPUT:</span>
        <code>Topology object from store: {`{ clusters, devices, connections, external_links }`}</code>
      </div>

      <div class="algo-step">
        <span class="algo-num">1</span>
        <div class="algo-content">
          <span class="algo-title">Initialize flowchart</span>
          <code>lines = ['flowchart TB']</code>
        </div>
      </div>

      <div class="algo-step">
        <span class="algo-num">2</span>
        <div class="algo-content">
          <span class="algo-title">Create subgraphs for each cluster</span>
          <div class="algo-detail">
            <code>subgraph {`{clusterId}`}["{`{clusterName}`}"]</code>
            <div class="algo-substeps">
              <span>‚Ä¢ sanitizedId = sanitizeMermaidId(deviceId)</span>
              <span>‚Ä¢ Shape based on device type (hexagon/trapezoid/rectangle)</span>
              <span>‚Ä¢ Label includes name + IP in &lt;small&gt; tag</span>
            </div>
          </div>
        </div>
      </div>

      <div class="algo-step">
        <span class="algo-num">3</span>
        <div class="algo-content">
          <span class="algo-title">Add external endpoint nodes</span>
          <code>{`{externalId}`}(("{`{label}`}"))  // circle/stadium shape</code>
        </div>
      </div>

      <div class="algo-step">
        <span class="algo-num">4</span>
        <div class="algo-content">
          <span class="algo-title">Add internal connections</span>
          <div class="algo-detail">
            <span>‚Ä¢ Deduplicate bidirectional links (sort endpoints, track in Set)</span>
            <span>‚Ä¢ With ports: <code>A ---|"Gi0/1 ‚Üî Gi0/2"| B</code></span>
            <span>‚Ä¢ Without ports: <code>A --- B</code></span>
          </div>
        </div>
      </div>

      <div class="algo-step">
        <span class="algo-num">5</span>
        <div class="algo-content">
          <span class="algo-title">Add external link connections (dashed)</span>
          <code>{`{sourceId}`} -.-> {`{targetId}`}  // dashed arrow</code>
        </div>
      </div>

      <div class="algo-output">
        <span class="output-label">OUTPUT:</span>
        <code>lines.join('\\n')</code>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Generated Mermaid Syntax</h3>
    <div class="code-output-block">
      <div class="code-header">
        <span class="code-lang">Mermaid</span>
        <span class="code-desc">Example output</span>
      </div>
      <pre><code>{`flowchart TB
    subgraph core_network["Core Network"]
        cat_1{{"Core Switch 1<br/><small>10.2.10.1</small>"}}
        cat_2{{"Core Switch 2<br/><small>10.2.10.2</small>"}}
    end

    subgraph firewalls["Firewalls"]
        pa_3410[/"PA-3410<br/><small>10.2.60.3</small>"\\]
    end

    ext_Internet(("Internet"))

    cat_1 ---|"Gi0/1 ‚Üî Gi0/1"| cat_2
    cat_1 ---|"Te1/0/1 ‚Üî eth1"| pa_3410
    pa_3410 -.-> ext_Internet`}</code></pre>
    </div>

    <h3 class="deepdive-subhead">// Device Shape Mapping</h3>
    <div class="shape-mapping-table">
      <div class="shape-row header">
        <span class="shape-type">Device Type</span>
        <span class="shape-name">Mermaid Shape</span>
        <span class="shape-syntax">Syntax</span>
        <span class="shape-visual">Visual</span>
      </div>
      <div class="shape-row">
        <span class="shape-type">Switch</span>
        <span class="shape-name">Hexagon</span>
        <span class="shape-syntax"><code>{`{{"label"}}`}</code></span>
        <span class="shape-visual hex">‚¨°</span>
      </div>
      <div class="shape-row">
        <span class="shape-type">Firewall</span>
        <span class="shape-name">Trapezoid</span>
        <span class="shape-syntax"><code>{`[/"label"\\]`}</code></span>
        <span class="shape-visual trap">‚ó¢</span>
      </div>
      <div class="shape-row">
        <span class="shape-type">Server/Other</span>
        <span class="shape-name">Rectangle</span>
        <span class="shape-syntax"><code>["label"]</code></span>
        <span class="shape-visual rect">‚ñ≠</span>
      </div>
      <div class="shape-row">
        <span class="shape-type">External</span>
        <span class="shape-name">Stadium/Circle</span>
        <span class="shape-syntax"><code>(("label"))</code></span>
        <span class="shape-visual circle">‚óè</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Connection Style Mapping</h3>
    <div class="connection-mapping-table">
      <div class="conn-row header">
        <span class="conn-type">Connection Type</span>
        <span class="conn-syntax">Mermaid Syntax</span>
        <span class="conn-visual">Visual</span>
      </div>
      <div class="conn-row">
        <span class="conn-type">Physical Link</span>
        <span class="conn-syntax"><code>A --- B</code></span>
        <span class="conn-visual"><span class="line-solid">‚îÄ‚îÄ</span> (solid)</span>
      </div>
      <div class="conn-row">
        <span class="conn-type">Physical + Ports</span>
        <span class="conn-syntax"><code>A ---|"Gi0/1 ‚Üî Gi0/2"| B</code></span>
        <span class="conn-visual"><span class="line-solid">‚îÄ‚îÄ</span> with label</span>
      </div>
      <div class="conn-row">
        <span class="conn-type">External/WAN</span>
        <span class="conn-syntax"><code>A -.-> B</code></span>
        <span class="conn-visual"><span class="line-dashed">‚îÑ‚îÑ</span> (dashed arrow)</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// ID Sanitization</h3>
    <div class="code-block-inline">
      <pre><code>{`function sanitizeMermaidId(id: string): string {
  // Mermaid only allows alphanumeric and dashes
  // Replace all other characters with underscore
  return id.replace(/[^a-zA-Z0-9-]/g, '_')
}

// Examples:
// "cat-1.corp.local" ‚Üí "cat_1_corp_local"
// "Core Switch #1"   ‚Üí "Core_Switch__1"
// "10.2.10.1"        ‚Üí "10_2_10_1"`}</code></pre>
    </div>

    <h3 class="deepdive-subhead">// MermaidModal Component</h3>
    <div class="component-tree">
      <div class="tree-root">MermaidModal.tsx</div>
      <div class="tree-children">
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">Mermaid Initialization (dark theme)</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">primaryColor: #3b82f6 (blue)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">background: #0d1117 (dark)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">clusterBkg: #161b22</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">fontFamily: monospace</span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">State</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">scale: number (0.1 - 20)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">position: {`{ x, y }`}</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">isDragging: boolean</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">error: string | null</span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">Render Flow</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">mermaid.render('mermaid-diagram', diagram)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">DOMParser.parseFromString(svg, 'text/html')</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf tree-note">NOTE: Uses 'text/html' not 'image/svg+xml' (Mermaid SVG contains HTML)</span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">Controls</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Zoom: [ ‚àí ] [100%] [ + ]</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Reset: [ ‚§¢ ]</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">Close: [ ‚úï ] or Escape key</span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îî‚îÄ‚îÄ</span>
          <span class="tree-name">Interactions</span>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Drag to pan (left mouse button)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Scroll wheel to zoom</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">Escape key to close</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Download Function</h3>
    <div class="code-block-inline">
      <pre><code>{`function downloadFile(content: string, filename: string) {
  // 1. Create Blob from content
  const blob = new Blob([content], { type: 'text/plain' })

  // 2. Create object URL
  const url = URL.createObjectURL(blob)

  // 3. Create temporary anchor element
  const a = document.createElement('a')
  a.href = url
  a.download = filename  // e.g., "topology-2026-01-27.mmd"

  // 4. Trigger download
  document.body.appendChild(a)
  a.click()

  // 5. Cleanup
  document.body.removeChild(a)
  URL.revokeObjectURL(url)
}`}</code></pre>
    </div>

    <h3 class="deepdive-subhead">// Mermaid Theme Configuration</h3>
    <div class="theme-config-block">
      <div class="config-section">
        <span class="config-label">Colors</span>
        <div class="config-items">
          <div class="config-item">
            <span class="color-swatch" style="background: #3b82f6"></span>
            <code>primaryColor: '#3b82f6'</code>
            <span class="config-note">Nodes</span>
          </div>
          <div class="config-item">
            <span class="color-swatch" style="background: #e5e7eb"></span>
            <code>primaryTextColor: '#e5e7eb'</code>
            <span class="config-note">Text</span>
          </div>
          <div class="config-item">
            <span class="color-swatch" style="background: #6b7280"></span>
            <code>lineColor: '#6b7280'</code>
            <span class="config-note">Edges</span>
          </div>
        </div>
      </div>
      <div class="config-section">
        <span class="config-label">Backgrounds</span>
        <div class="config-items">
          <div class="config-item">
            <span class="color-swatch" style="background: #0d1117"></span>
            <code>background: '#0d1117'</code>
            <span class="config-note">GitHub dark</span>
          </div>
          <div class="config-item">
            <span class="color-swatch" style="background: #161b22"></span>
            <code>clusterBkg: '#161b22'</code>
            <span class="config-note">Subgraphs</span>
          </div>
        </div>
      </div>
      <div class="config-section">
        <span class="config-label">Flowchart Options</span>
        <div class="config-items">
          <div class="config-item"><code>htmlLabels: true</code> <span class="config-note">Allow &lt;br/&gt;, &lt;small&gt;</span></div>
          <div class="config-item"><code>curve: 'basis'</code> <span class="config-note">Smooth edges</span></div>
          <div class="config-item"><code>nodeSpacing: 50</code></div>
          <div class="config-item"><code>rankSpacing: 80</code></div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">Diagram type</span>
        <span class="tech-value">flowchart TB (top-to-bottom)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Cluster rendering</span>
        <span class="tech-value">Mermaid subgraph blocks</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Device labels</span>
        <span class="tech-value">HTML with &lt;br/&gt; and &lt;small&gt; for IP</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">ID sanitization</span>
        <span class="tech-value">Replace non-alphanumeric with underscore</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Deduplication</span>
        <span class="tech-value">Sort endpoints, join with --, track in Set</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">SVG parsing</span>
        <span class="tech-value">Use text/html parser (not XML) for HTML labels</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Zoom range</span>
        <span class="tech-value">10% - 2000%</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Export filename</span>
        <span class="tech-value">topology-{`{YYYY-MM-DD}`}.mmd</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Modal size</span>
        <span class="tech-value">90vw √ó 85vh</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// UI States</h3>
    <div class="ui-states-table">
      <div class="state-row header">
        <span class="state-name">State</span>
        <span class="state-display">Display</span>
      </div>
      <div class="state-row">
        <span class="state-name">L2 mode</span>
        <span class="state-display">Visualize + Export buttons visible</span>
      </div>
      <div class="state-row">
        <span class="state-name">L3 mode</span>
        <span class="state-display">Buttons hidden (Mermaid only for L2)</span>
      </div>
      <div class="state-row">
        <span class="state-name">Modal open</span>
        <span class="state-display">Dark overlay, centered diagram</span>
      </div>
      <div class="state-row">
        <span class="state-name">Rendering</span>
        <span class="state-display">Mermaid processes diagram async</span>
      </div>
      <div class="state-row">
        <span class="state-name">Error</span>
        <span class="state-display">Red warning icon + error message</span>
      </div>
      <div class="state-row">
        <span class="state-name">Dragging</span>
        <span class="state-display">Cursor changes to grabbing</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Tech Stack</h3>
    <div class="tech-stack-table">
      <div class="stack-row">
        <span class="stack-layer">Diagram Library</span>
        <span class="stack-tech">Mermaid.js (v10+)</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">SVG Rendering</span>
        <span class="stack-tech">Browser DOMParser</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Pan/Zoom</span>
        <span class="stack-tech">React useState + CSS transform</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Download</span>
        <span class="stack-tech">Blob API + Object URL</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Styling</span>
        <span class="stack-tech">Tailwind CSS (dark theme)</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// File Output Format</h3>
    <div class="file-output-block">
      <div class="file-header">
        <span class="file-icon">üìÑ</span>
        <span class="file-name">topology-2026-01-27.mmd</span>
      </div>
      <div class="file-content">
        <pre><code>{`flowchart TB
    subgraph core_network["Core Network"]
        cat_1{{"Core Switch 1<br/><small>10.2.10.1</small>"}}
        cat_2{{"Core Switch 2<br/><small>10.2.10.2</small>"}}
    end

    subgraph access_layer["Access Layer"]
        sw_bldg1{{"Building 1 Switch<br/><small>10.2.20.1</small>"}}
    end

    ext_Internet(("Internet"))

    cat_1 ---|"Te1/0/1 ‚Üî Te1/0/1"| cat_2
    cat_1 --- sw_bldg1
    cat_1 -.-> ext_Internet`}</code></pre>
      </div>
      <div class="file-footer">
        <span class="file-note">Plain text Mermaid syntax; renders in GitHub, Confluence, Obsidian, etc.</span>
      </div>
    </div>
  </div>

  <!-- Feature Deep Dive: Alert System -->
  <div class="feature-deepdive" id="alert-system">
    <h2>// Feature Deep Dive: Alert System</h2>
    <p class="deepdive-intro">
      Real-time alerting system that derives alerts from device status and LibreNMS monitoring data.
      Features a multi-tier notification approach: bell icon with count badge, toast notifications,
      and full-screen critical overlay for urgent incidents requiring immediate attention.
    </p>

    <div class="usecase-block">
      <div class="usecase-header">
        <span class="usecase-icon">üîî</span>
        <span class="usecase-title">Use Case: Escalating Notification Levels</span>
      </div>
      <p class="usecase-desc">
        NOC operators need immediate visibility when network devices go down. The alert system provides
        escalating notification levels: a subtle count badge for awareness, toast popups for new events,
        and an unmissable full-screen overlay with audio for critical outages. Alerts auto-clear when
        devices recover, with optional acknowledgment to track incident response.
      </p>
    </div>

    <h3 class="deepdive-subhead">// Architecture</h3>
    <div class="alert-architecture">
      <div class="arch-sources">
        <div class="source-header">DATA SOURCES</div>
        <div class="source-items">
          <div class="source-item">
            <span class="source-icon">üìä</span>
            <div class="source-content">
              <span class="source-name">Device Status</span>
              <span class="source-desc">status === 'down' ‚Üí Alert</span>
            </div>
          </div>
          <div class="source-item">
            <span class="source-icon">üì°</span>
            <div class="source-content">
              <span class="source-name">LibreNMS Alerts</span>
              <span class="source-desc">Cached alert rules ‚Üí Alert</span>
            </div>
          </div>
        </div>
      </div>

      <div class="arch-arrow-down">‚ñº</div>

      <div class="arch-backend">
        <div class="backend-header">
          <span class="backend-icon">üêç</span>
          <span class="backend-title">BACKEND (alerts.py)</span>
        </div>
        <div class="backend-content">
          <div class="backend-functions">
            <code>_get_device_down_alerts()</code>
            <code>_get_librenms_alerts()</code>
          </div>
          <div class="backend-combine">Combine + Sort by timestamp</div>
          <div class="backend-ack">
            <span class="ack-label">In-memory tracking:</span>
            <code>_acknowledged_alerts: set[str]</code>
          </div>
        </div>
      </div>

      <div class="arch-arrow-down">‚ñº</div>
      <div class="api-call-label">GET /api/alerts</div>
      <div class="arch-arrow-down">‚ñº</div>

      <div class="arch-frontend">
        <div class="frontend-header">FRONTEND</div>
        <div class="frontend-flow">
          <div class="frontend-hook">useAlerts() hook</div>
          <div class="frontend-stores">
            <span>alertStore.ts</span>
            <span>settingsStore.ts</span>
          </div>
        </div>
        <div class="frontend-components">
          <div class="frontend-comp">
            <span class="comp-icon">üîî</span>
            <span class="comp-name">Header.tsx</span>
            <span class="comp-desc">Bell Icon + Badge</span>
          </div>
          <div class="frontend-comp">
            <span class="comp-icon">üìã</span>
            <span class="comp-name">ToastContainer</span>
            <span class="comp-desc">Toast Stack (max 5)</span>
          </div>
          <div class="frontend-comp">
            <span class="comp-icon">üö®</span>
            <span class="comp-name">CriticalOverlay</span>
            <span class="comp-desc">Full Screen + Audio</span>
          </div>
          <div class="frontend-comp">
            <span class="comp-icon">‚öôÔ∏è</span>
            <span class="comp-name">Settings</span>
            <span class="comp-desc">Sound/Volume</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Visual Layout</h3>

    <div class="alert-mockups">
      <!-- Header Bell -->
      <div class="alert-mockup bell-mockup">
        <div class="mockup-label">Header Bell Icon</div>
        <div class="bell-header-preview">
          <span class="brand">WATCHTOWER</span>
          <div class="bell-area">
            <span class="bell-icon">üîî</span>
            <span class="bell-badge critical">3</span>
          </div>
          <span class="header-icons">‚öôÔ∏è ‚ò∞</span>
        </div>
        <div class="mockup-note">Red pulsing badge = critical alerts</div>
      </div>

      <!-- Toast Stack -->
      <div class="alert-mockup toast-mockup">
        <div class="mockup-label">Toast Notifications (top-right)</div>
        <div class="toast-stack-preview">
          <div class="toast-item critical">
            <span class="toast-icon">‚ö†Ô∏è</span>
            <div class="toast-content">
              <div class="toast-header">
                <span class="status-dot critical"></span>
                <span class="toast-device">core-sw-1</span>
              </div>
              <span class="toast-message">Device unreachable</span>
              <div class="toast-footer">
                <span class="toast-time">2m ago</span>
                <div class="toast-actions">
                  <span class="toast-btn ack">Ack</span>
                  <span class="toast-btn">Dismiss</span>
                </div>
              </div>
            </div>
          </div>
          <div class="toast-item warning">
            <span class="toast-icon">‚ö†Ô∏è</span>
            <div class="toast-content">
              <div class="toast-header">
                <span class="status-dot warning"></span>
                <span class="toast-device">firewall-1</span>
              </div>
              <span class="toast-message">High CPU utilization</span>
              <div class="toast-footer">
                <span class="toast-time">5m ago</span>
                <div class="toast-actions">
                  <span class="toast-btn">Dismiss</span>
                </div>
              </div>
            </div>
          </div>
          <div class="toast-item recovery">
            <span class="toast-icon">‚úì</span>
            <div class="toast-content">
              <div class="toast-header">
                <span class="status-dot recovery"></span>
                <span class="toast-device">ap-lobby</span>
              </div>
              <span class="toast-message">Device recovered</span>
              <div class="toast-footer">
                <span class="toast-time">1m ago</span>
                <div class="toast-actions">
                  <span class="toast-btn">Dismiss</span>
                </div>
              </div>
            </div>
          </div>
          <div class="toast-more">+2 more alerts</div>
        </div>
      </div>

      <!-- Critical Overlay -->
      <div class="alert-mockup overlay-mockup">
        <div class="mockup-label">Critical Overlay (full-screen)</div>
        <div class="overlay-preview">
          <div class="overlay-backdrop">
            <div class="overlay-card">
              <span class="overlay-icon">‚ö†Ô∏è</span>
              <span class="overlay-title">CRITICAL ALERT</span>
              <span class="overlay-device">core-sw-1</span>
              <span class="overlay-message">Device unreachable</span>
              <span class="overlay-time">10:42:15 AM</span>
              <div class="overlay-buttons">
                <span class="overlay-btn primary">Acknowledge</span>
                <span class="overlay-btn">View Device</span>
              </div>
            </div>
          </div>
          <div class="overlay-effects">
            <span>üî¥ Browser tab flashing</span>
            <span>üîä Alert sound plays</span>
            <span>üì¢ Browser notification (if hidden)</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Data Models</h3>
    <div class="models-grid">
      <div class="model-block">
        <div class="model-header">
          <span class="model-icon">üêç</span>
          <span class="model-title">Backend Models (alert.py)</span>
        </div>
        <div class="model-code">
          <pre><code>{`class AlertSeverity(str, Enum):
    CRITICAL = "critical"   # Device down
    WARNING = "warning"     # Degraded
    INFO = "info"           # Informational
    RECOVERY = "recovery"   # Device back up

class AlertStatus(str, Enum):
    ACTIVE = "active"
    ACKNOWLEDGED = "acknowledged"
    RESOLVED = "resolved"

class Alert(BaseModel):
    id: str              # "device-down-core-sw-1"
    device_id: str       # Topology device ID
    severity: AlertSeverity
    message: str
    details: str | None
    status: AlertStatus
    timestamp: datetime
    acknowledged_at: datetime | None
    acknowledged_by: str | None`}</code></pre>
        </div>
      </div>

      <div class="model-block">
        <div class="model-header">
          <span class="model-icon">üìò</span>
          <span class="model-title">Frontend Types</span>
        </div>
        <div class="model-code">
          <pre><code>{`interface Alert {
  id: string
  device_id: string
  severity: 'critical' | 'warning' | 'info' | 'recovery'
  message: string
  timestamp: string
  status: 'active' | 'acknowledged' | 'resolved'
}

interface Toast {
  id: string        // "toast-{alertId}-{timestamp}"
  alert: Alert
  dismissed: boolean
}

// alertStore.ts
interface AlertState {
  alerts: Alert[]
  toasts: Toast[]
  criticalOverlay: Alert | null
  // + action methods
}`}</code></pre>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Alert Generation Flow</h3>
    <div class="deepdive-flow">
      <div class="flow-block config">
        <div class="block-header">
          <span class="block-icon">‚è±Ô∏è</span>
          <span class="block-title">POLLING (every 30s)</span>
        </div>
        <div class="block-steps">
          <div class="backend-step"><span class="step-num">1</span> Check device status from topology</div>
          <div class="backend-step"><span class="step-num">2</span> Load LibreNMS alerts from cache</div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <div class="flow-block backend">
        <div class="block-header">
          <span class="block-icon">üîç</span>
          <span class="block-title">ALERT DETECTION</span>
        </div>
        <div class="block-steps">
          <div class="detection-rule">
            <span class="rule-condition">device.status === 'down'</span>
            <span class="rule-arrow">‚Üí</span>
            <span class="rule-result">Generate CRITICAL alert</span>
          </div>
          <div class="detection-example">
            <code>id: "device-down-{`{device_id}`}"</code>
            <code>message: "Device unreachable: {`{name}`}"</code>
          </div>
        </div>
      </div>

      <div class="flow-arrow-down">‚ñº</div>

      <div class="flow-block api">
        <div class="block-header">
          <span class="block-icon">üîÑ</span>
          <span class="block-title">COMBINE & DEDUPLICATE</span>
        </div>
        <div class="block-steps">
          <span class="step-desc">Sort by timestamp (newest first)</span>
          <span class="step-desc">Return to frontend via /api/alerts</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Acknowledgment System</h3>
    <div class="ack-flow">
      <div class="ack-step">
        <span class="ack-side">Frontend</span>
        <div class="ack-action">POST /api/alert/{`{id}`}/acknowledge</div>
        <span class="ack-arrow">‚Üí</span>
      </div>
      <div class="ack-step">
        <span class="ack-side">Backend</span>
        <div class="ack-action">_acknowledged_alerts.add(alert_id)</div>
      </div>
      <div class="ack-step">
        <span class="ack-side">Response</span>
        <div class="ack-action">{`{"status": "acknowledged"}`}</div>
        <span class="ack-arrow">‚Üê</span>
      </div>
      <div class="ack-step">
        <span class="ack-side">Store</span>
        <div class="ack-action">alertStore.acknowledgeAlert(id)</div>
      </div>
      <div class="ack-note">
        <span class="note-icon">‚ÑπÔ∏è</span>
        <span>Acknowledgments stored in memory; reset on service restart. Auto-clears when device recovers.</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Component Hierarchy</h3>
    <div class="component-tree">
      <div class="tree-root">Layout.tsx</div>
      <div class="tree-children">
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">Header.tsx ‚Üí Bell Icon Button</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">SVG bell icon</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">Badge (count + color): <span class="tree-note">Red+pulse=critical, Amber=warnings</span></span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îú‚îÄ‚îÄ</span>
          <span class="tree-name">ToastContainer.tsx ‚Üí Toast[] (max 5)</span>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Severity icon (‚ö†Ô∏è ‚úì ‚ÑπÔ∏è)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">StatusDot (pulsing if critical)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Device ID + Message + Time</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">‚îÇ  ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">Actions: [Acknowledge] [Dismiss]</span>
          </div>
        </div>
        <div class="tree-branch">
          <span class="tree-connector">‚îî‚îÄ‚îÄ</span>
          <span class="tree-name">CriticalOverlay.tsx</span>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Dark backdrop (blur + red glow)</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îú‚îÄ‚îÄ</span>
            <span class="tree-leaf">Modal: icon, header, device, buttons</span>
          </div>
          <div class="tree-sub">
            <span class="tree-connector">   ‚îî‚îÄ‚îÄ</span>
            <span class="tree-leaf">Effects: playAlertSound(), flash title, browser notification</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Alert Lifecycle</h3>
    <div class="lifecycle-diagram">
      <div class="lifecycle-step">
        <span class="lifecycle-event trigger">DEVICE GOES DOWN</span>
        <span class="lifecycle-arrow">‚Üì</span>
      </div>
      <div class="lifecycle-step">
        <span class="lifecycle-state">Alert: status=ACTIVE</span>
        <div class="lifecycle-effects">
          <span>‚Üí Bell badge count increases</span>
          <span>‚Üí Toast appears (top-right)</span>
          <span>‚Üí Critical overlay (if enabled)</span>
        </div>
      </div>
      <div class="lifecycle-step">
        <span class="lifecycle-action">User clicks [Acknowledge]</span>
        <span class="lifecycle-arrow">‚Üì</span>
      </div>
      <div class="lifecycle-step">
        <span class="lifecycle-state">status=ACKNOWLEDGED</span>
        <div class="lifecycle-effects">
          <span>‚Üí Badge remains (still active)</span>
          <span>‚Üí Toast can be dismissed</span>
          <span>‚Üí Overlay closes</span>
        </div>
      </div>
      <div class="lifecycle-step">
        <span class="lifecycle-action">Device recovers (status ‚Üí 'up')</span>
        <span class="lifecycle-arrow">‚Üì</span>
      </div>
      <div class="lifecycle-step">
        <span class="lifecycle-state final">Alert removed from list</span>
        <div class="lifecycle-effects">
          <span>‚Üí Badge count decreases (or disappears)</span>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Severity Styling</h3>
    <div class="severity-table">
      <div class="severity-row header">
        <span class="sev-level">Severity</span>
        <span class="sev-color">Color</span>
        <span class="sev-icon">Icon</span>
        <span class="sev-badge">Badge</span>
      </div>
      <div class="severity-row">
        <span class="sev-level critical">Critical</span>
        <span class="sev-color"><span class="color-dot critical"></span> #f85149</span>
        <span class="sev-icon">‚ö†Ô∏è Triangle</span>
        <span class="sev-badge">Red + pulse</span>
      </div>
      <div class="severity-row">
        <span class="sev-level warning">Warning</span>
        <span class="sev-color"><span class="color-dot warning"></span> #d29922</span>
        <span class="sev-icon">‚ö†Ô∏è Triangle</span>
        <span class="sev-badge">Amber</span>
      </div>
      <div class="severity-row">
        <span class="sev-level info">Info</span>
        <span class="sev-color"><span class="color-dot info"></span> #58a6ff</span>
        <span class="sev-icon">‚ÑπÔ∏è Circle</span>
        <span class="sev-badge">-</span>
      </div>
      <div class="severity-row">
        <span class="sev-level recovery">Recovery</span>
        <span class="sev-color"><span class="color-dot recovery"></span> #3fb950</span>
        <span class="sev-icon">‚úì Check</span>
        <span class="sev-badge">-</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Critical Overlay Features</h3>
    <div class="overlay-features">
      <div class="feature-row">
        <span class="feature-name">Backdrop</span>
        <code>bg-black/80 backdrop-blur-sm</code>
      </div>
      <div class="feature-row">
        <span class="feature-name">Red glow</span>
        <code>box-shadow: inset 0 0 100px 20px rgba(248,81,73,0.3)</code>
      </div>
      <div class="feature-row">
        <span class="feature-name">Pulsing</span>
        <code>animation: pulse 2s ease-in-out infinite</code>
      </div>
      <div class="feature-row">
        <span class="feature-name">Audio</span>
        <code>new Audio('/alert-sound.mp3').play()</code>
      </div>
      <div class="feature-row">
        <span class="feature-name">Title flash</span>
        <code>Toggle üî¥ CRITICAL ‚Äî prefix every 1s</code>
      </div>
      <div class="feature-row">
        <span class="feature-name">Notification</span>
        <code>{`new Notification('Watchtower Critical Alert', {options})`}</code>
      </div>
    </div>

    <h3 class="deepdive-subhead">// API Endpoints</h3>
    <div class="api-endpoints-list">
      <div class="api-endpoint">
        <code>GET /api/alerts</code>
        <span>List all alerts (sorted by time)</span>
      </div>
      <div class="api-endpoint">
        <code>GET /api/alerts?status=active</code>
        <span>Filter by status</span>
      </div>
      <div class="api-endpoint">
        <code>GET /api/alert/{`{id}`}</code>
        <span>Get single alert details</span>
      </div>
      <div class="api-endpoint">
        <code>POST /api/alert/{`{id}`}/acknowledge</code>
        <span>Mark as acknowledged</span>
      </div>
      <div class="api-endpoint">
        <code>POST /api/alert/{`{id}`}/resolve</code>
        <span>Mark as resolved</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Technical Details</h3>
    <div class="tech-table">
      <div class="tech-row">
        <span class="tech-label">Polling interval</span>
        <span class="tech-value">30s (alerts refresh)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Max toasts</span>
        <span class="tech-value">5 visible (+N more indicator)</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Toast animation</span>
        <span class="tech-value">300ms slide + fade</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Auto-dismiss</span>
        <span class="tech-value">Configurable per-severity</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Device down ID</span>
        <span class="tech-value">device-down-{`{device_id}`}</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">LibreNMS ID</span>
        <span class="tech-value">librenms-{`{alert_id}`}</span>
      </div>
      <div class="tech-row">
        <span class="tech-label">Auto-clear</span>
        <span class="tech-value">When device status returns to 'up'</span>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Roadmap: Remote Notifications</h3>
    <div class="roadmap-callout">
      <div class="roadmap-header">
        <span class="roadmap-icon">üöÄ</span>
        <span class="roadmap-title">Planned: Phase 9</span>
      </div>
      <p class="roadmap-desc">
        Remote notification support to alert operators even when away from the dashboard.
        Critical alerts will trigger notifications through multiple channels for redundancy.
      </p>
      <div class="roadmap-features">
        <div class="roadmap-feature">
          <span class="feature-icon">üí¨</span>
          <div class="feature-content">
            <span class="feature-title">Discord Webhooks</span>
            <span class="feature-desc">Post alerts to dedicated NOC channel with severity-based formatting</span>
          </div>
        </div>
        <div class="roadmap-feature">
          <span class="feature-icon">üìß</span>
          <div class="feature-content">
            <span class="feature-title">Email Alerts</span>
            <span class="feature-desc">SMTP integration for critical alerts with device details and quick links</span>
          </div>
        </div>
        <div class="roadmap-feature">
          <span class="feature-icon">üìà</span>
          <div class="feature-content">
            <span class="feature-title">Escalation Rules</span>
            <span class="feature-desc">Time-based escalation if alerts remain unacknowledged</span>
          </div>
        </div>
      </div>
    </div>

    <h3 class="deepdive-subhead">// Tech Stack</h3>
    <div class="tech-stack-table">
      <div class="stack-row">
        <span class="stack-layer">Backend</span>
        <span class="stack-tech">FastAPI, Pydantic models</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Alert Sources</span>
        <span class="stack-tech">Device status + LibreNMS cache</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Acknowledgment</span>
        <span class="stack-tech">In-memory set (service lifetime)</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Frontend State</span>
        <span class="stack-tech">Zustand (alertStore, settingsStore)</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Notifications</span>
        <span class="stack-tech">Browser Notification API, Web Audio API</span>
      </div>
      <div class="stack-row">
        <span class="stack-layer">Styling</span>
        <span class="stack-tech">Tailwind CSS (status colors)</span>
      </div>
    </div>
  </div>

  <!-- Technical Decisions -->
  <h2>// Key Technical Decisions</h2>
  <div class="decisions-grid">
    {techDecisions.map((d) => (
      <div class="decision-card">
        <span class="decision-title">{d.decision}</span>
        <span class="decision-reason">{d.reason}</span>
      </div>
    ))}
  </div>

  <!-- API Endpoints -->
  <h2>// API Surface</h2>
  <div class="api-section">
    <div class="api-group">
      <span class="api-label">REST Endpoints</span>
      <div class="api-list">
        <code>/api/topology</code>
        <code>/api/topology/l3</code>
        <code>/api/alerts</code>
        <code>/api/vms</code>
        <code>/api/vms/node/{"{name}"}</code>
        <code>/api/speedtest</code>
        <code>/api/port-groups</code>
        <code>/api/port-groups/export</code>
        <code>/api/ports/search</code>
        <code>/api/ports/aliases</code>
      </div>
    </div>
    <div class="api-group">
      <span class="api-label">WebSocket</span>
      <div class="api-list">
        <code>/ws/topology</code>
        <span class="api-note">Pushes on cache changes</span>
      </div>
    </div>
  </div>

  <!-- Development Phases -->
  <h2>// Development Roadmap</h2>
  <div class="phases-grid">
    {phases.map((p) => (
      <div class={`phase-card ${p.status}`}>
        <div class="phase-header">
          <span class="phase-num">Phase {p.phase}</span>
          <span class={`phase-status ${p.status}`}>
            {p.status === 'completed' ? '‚úì' : '‚óã'}
          </span>
        </div>
        <span class="phase-name">{p.name}</span>
        <ul class="phase-items">
          {p.items.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>
    ))}
  </div>

  <!-- Current Status -->
  <h2>// Current Status</h2>
  <div class="status-block">
    <div class="status-indicator active">
      <div class="status-pulse"></div>
      <span>Core functionality deployed and operational</span>
    </div>
    <ul class="status-list">
      <li><span class="check">‚úì</span> FastAPI backend with Redis caching</li>
      <li><span class="check">‚úì</span> React frontend with ReactFlow topology</li>
      <li><span class="check">‚úì</span> LibreNMS + Netdisco + Proxmox integrations</li>
      <li><span class="check">‚úì</span> WebSocket real-time updates</li>
      <li><span class="check">‚úì</span> CDP/LLDP auto-discovery</li>
      <li><span class="check">‚úì</span> L2/L3 topology view toggle</li>
      <li><span class="check">‚úì</span> Cisco-style port grid visualization</li>
      <li><span class="check">‚úì</span> Speedtest widget with CSV export</li>
      <li><span class="check">‚úì</span> Port group traffic monitoring</li>
      <li><span class="check">‚úì</span> Mermaid diagram export</li>
      <li><span class="pending">‚óã</span> JWT authentication</li>
      <li><span class="pending">‚óã</span> Settings UI</li>
    </ul>
  </div>
</ProjectLayout>

<style>
  .section-intro {
    opacity: 0.8;
    margin-bottom: 1.5rem;
  }

  /* Cost Comparison */
  .cost-comparison {
    display: flex;
    align-items: stretch;
    gap: 1rem;
    margin: 1.5rem 0;
  }

  .cost-card {
    flex: 1;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .cost-card.solarwinds {
    border-color: color-mix(in srgb, #ef4444 20%, transparent);
  }

  .cost-card.watchtower-card {
    border-color: color-mix(in srgb, #10b981 20%, transparent);
  }

  .cost-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .cost-icon {
    font-size: 1.25rem;
  }

  .cost-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .cost-body {
    padding: 1rem;
  }

  .cost-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px dotted color-mix(in srgb, currentColor 10%, transparent);
  }

  .cost-row:last-child {
    border-bottom: none;
  }

  .cost-key {
    font-size: 0.8rem;
    opacity: 0.7;
  }

  .cost-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .cost-value.bad {
    color: #ef4444;
  }

  .cost-value.good {
    color: #10b981;
  }

  .cost-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 0.5rem;
  }

  .arrow-savings {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 1rem;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 30%, transparent);
    border-radius: 8px;
  }

  .savings-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    color: #10b981;
  }

  .savings-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 1.25rem;
    font-weight: 700;
    color: #10b981;
  }

  .savings-highlight {
    display: flex;
    justify-content: center;
    margin: 1rem 0 1.5rem;
  }

  .highlight-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 1.5rem 3rem;
    background: color-mix(in srgb, #10b981 8%, transparent);
    border: 2px solid color-mix(in srgb, #10b981 30%, transparent);
    border-radius: 12px;
  }

  .highlight-stat .stat-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 1.75rem;
    font-weight: 700;
    color: #10b981;
  }

  .highlight-stat .stat-label {
    font-size: 0.85rem;
    opacity: 0.7;
  }

  .cost-sources {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    text-align: center;
    opacity: 0.6;
    margin-top: 1rem;
  }

  .cost-sources a {
    color: currentColor;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .cost-sources a:hover {
    opacity: 1;
    color: #10b981;
  }

  .value-context a {
    color: #10b981;
    text-decoration: none;
  }

  .value-context a:hover {
    text-decoration: underline;
  }

  /* Responsive: Stack on mobile */
  @media (max-width: 768px) {
    .cost-comparison {
      flex-direction: column;
    }

    .cost-arrow {
      padding: 0.5rem 0;
    }

    .highlight-stat {
      padding: 1rem 2rem;
    }
  }

  /* Value Showcase */
  .value-showcase {
    margin: 2rem 0;
    padding: 2rem;
    background: linear-gradient(135deg, color-mix(in srgb, #10b981 8%, transparent), color-mix(in srgb, #10b981 3%, transparent));
    border: 1px solid color-mix(in srgb, #10b981 25%, transparent);
    border-radius: 12px;
  }

  .value-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .value-header h2 {
    margin: 0 0 0.5rem 0;
    color: #10b981;
  }

  .value-subtitle {
    font-size: 0.9rem;
    opacity: 0.8;
    margin: 0;
  }

  .value-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .value-metric {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 1.25rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
  }

  .value-metric.primary {
    background: color-mix(in srgb, #10b981 12%, transparent);
    border-color: color-mix(in srgb, #10b981 30%, transparent);
  }

  .metric-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 1.75rem;
    font-weight: 700;
    color: #10b981;
    line-height: 1.2;
  }

  .value-metric.primary .metric-value {
    font-size: 2rem;
  }

  .metric-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    margin-top: 0.5rem;
  }

  .metric-context {
    font-size: 0.7rem;
    opacity: 0.6;
    margin-top: 0.25rem;
  }

  .value-comparison {
    margin-bottom: 1.5rem;
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .comparison-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1rem;
    padding: 0.75rem 1rem;
    font-size: 0.85rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .comparison-row:last-child {
    border-bottom: none;
  }

  .comparison-row.header {
    background: color-mix(in srgb, currentColor 5%, transparent);
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .comparison-col {
    display: flex;
    align-items: center;
  }

  .comparison-col:not(:first-child) {
    justify-content: center;
    font-family: "IBM Plex Mono", monospace;
  }

  .comparison-col.negative {
    color: #ef4444;
  }

  .comparison-col.positive {
    color: #10b981;
    font-weight: 600;
  }

  .value-context {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
  }

  .context-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .context-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .context-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .context-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .context-desc {
    font-size: 0.8rem;
    opacity: 0.8;
    line-height: 1.5;
  }

  /* GitHub Callout */
  .github-callout {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 1rem 1.25rem;
    margin: 1.5rem 0;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-left: 3px solid #6e5494;
    border-radius: 6px;
    flex-wrap: wrap;
  }

  .github-content {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .github-icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    padding: 6px;
    background: color-mix(in srgb, #6e5494 15%, transparent);
    border-radius: 6px;
    color: #6e5494;
  }

  .github-icon svg {
    width: 100%;
    height: 100%;
  }

  .github-text {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .github-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #6e5494;
  }

  .github-desc {
    font-size: 0.75rem;
    opacity: 0.6;
    margin: 0;
  }

  .github-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .github-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 500;
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .github-btn.repo {
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    color: currentColor;
  }

  .github-btn.repo:hover {
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-color: color-mix(in srgb, currentColor 25%, transparent);
  }

  .github-btn.star {
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    border: 1px solid color-mix(in srgb, #f59e0b 30%, transparent);
    color: #f59e0b;
  }

  .github-btn.star:hover {
    background: color-mix(in srgb, #f59e0b 25%, transparent);
    border-color: #f59e0b;
  }

  .github-btn svg {
    flex-shrink: 0;
  }

  /* Architecture */
  .architecture {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    padding: 2rem;
    margin: 1.5rem 0;
  }

  .arch-layer {
    padding: 1.5rem;
  }

  .layer-label {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    opacity: 0.5;
    text-transform: uppercase;
    margin-bottom: 1rem;
    text-align: center;
  }

  .source-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.75rem;
  }

  .source-card {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-top: 3px solid var(--accent);
    border-radius: 4px;
  }

  .source-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--accent);
  }

  .source-type {
    font-size: 0.7rem;
    opacity: 0.6;
  }

  .source-provides {
    font-size: 0.7rem;
    opacity: 0.75;
    line-height: 1.4;
  }

  .arch-connector {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 0;
  }

  .connector-arrows {
    display: flex;
    gap: 2rem;
    color: #10b981;
    font-size: 0.8rem;
  }

  .connector-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    color: #10b981;
    padding: 0.2rem 0.6rem;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border-radius: 20px;
  }

  .backend-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .backend-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    min-width: 120px;
  }

  .backend-box .box-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .backend-box .box-desc {
    font-size: 0.65rem;
    opacity: 0.6;
    text-align: center;
  }

  .backend-box.scheduler { border-color: color-mix(in srgb, #f59e0b 40%, transparent); }
  .backend-box.scheduler .box-title { color: #f59e0b; }
  .backend-box.aggregator { border-color: color-mix(in srgb, #3b82f6 40%, transparent); }
  .backend-box.aggregator .box-title { color: #3b82f6; }
  .backend-box.redis { border-color: color-mix(in srgb, #ef4444 40%, transparent); }
  .backend-box.redis .box-title { color: #ef4444; }
  .backend-box.api { border-color: color-mix(in srgb, #10b981 40%, transparent); }
  .backend-box.api .box-title { color: #10b981; }

  .flow-arrow {
    color: #10b981;
    font-size: 1.25rem;
    opacity: 0.5;
  }

  .frontend-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .frontend-box {
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .frontend-box .box-title {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #8b5cf6;
  }

  .frontend-box .box-desc {
    display: block;
    font-size: 0.7rem;
    opacity: 0.6;
    margin-bottom: 0.5rem;
  }

  .frontend-box .box-features {
    margin: 0;
    padding-left: 1rem;
    font-size: 0.7rem;
  }

  .frontend-box .box-features li {
    margin-bottom: 0.2rem;
    opacity: 0.75;
  }

  .frontend-box.state {
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: center;
  }

  /* Features Grid */
  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
  }

  .feature-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
    transition: all 0.2s ease;
  }

  .feature-card:hover {
    border-color: color-mix(in srgb, currentColor 25%, transparent);
  }

  a.feature-card.clickable {
    text-decoration: none;
    color: inherit;
    display: block;
    cursor: pointer;
  }

  a.feature-card.clickable:hover {
    background: color-mix(in srgb, currentColor 6%, transparent);
    border-color: color-mix(in srgb, currentColor 30%, transparent);
  }

  a.feature-card.clickable .feature-name::after {
    content: ' ‚Üí';
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  a.feature-card.clickable:hover .feature-name::after {
    opacity: 0.5;
  }

  .feature-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .feature-icon {
    font-size: 1.25rem;
  }

  .feature-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .feature-desc {
    font-size: 0.8rem;
    opacity: 0.75;
    margin: 0 0 0.75rem 0;
    line-height: 1.5;
  }

  .feature-tech {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    color: #10b981;
    padding: 0.2rem 0.5rem;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border-radius: 3px;
  }

  /* Data Flow */
  .dataflow {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
    gap: 0;
    padding: 1.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    margin: 1.5rem 0;
  }

  .flow-step {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    flex: 1;
    min-width: 140px;
    animation: fadeSlideIn 0.5s ease-out both;
    animation-delay: calc(var(--step) * 0.1s);
  }

  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .step-num {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: #10b981;
    color: white;
    border-radius: 50%;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .step-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .step-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .step-desc {
    font-size: 0.7rem;
    opacity: 0.7;
    line-height: 1.4;
  }

  .flow-connector {
    display: flex;
    align-items: center;
    padding: 0 0.25rem;
    height: 60px;
  }

  .connector-pulse {
    width: 20px;
    height: 2px;
    background: color-mix(in srgb, currentColor 15%, transparent);
    position: relative;
  }

  .connector-pulse::after {
    content: "";
    position: absolute;
    width: 6px;
    height: 2px;
    background: #10b981;
    animation: connectorFlow 1s ease-in-out infinite;
  }

  @keyframes connectorFlow {
    0% { left: 0; }
    100% { left: 14px; }
  }

  /* Decisions Grid */
  .decisions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 0.75rem;
    margin: 1.5rem 0;
  }

  .decision-card {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .decision-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #3b82f6;
  }

  .decision-reason {
    font-size: 0.8rem;
    opacity: 0.75;
    line-height: 1.4;
  }

  /* API Section */
  .api-section {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin: 1.5rem 0;
  }

  .api-group {
    flex: 1;
    min-width: 250px;
  }

  .api-label {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    opacity: 0.7;
  }

  .api-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .api-list code {
    padding: 0.35rem 0.6rem;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 25%, transparent);
    border-radius: 4px;
    font-size: 0.7rem;
    color: #10b981;
  }

  .api-note {
    font-size: 0.7rem;
    opacity: 0.6;
    font-style: italic;
    padding: 0.35rem 0;
  }

  /* Phases Grid */
  .phases-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
  }

  .phase-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .phase-card.completed {
    border-color: color-mix(in srgb, #10b981 30%, transparent);
  }

  .phase-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .phase-num {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    opacity: 0.5;
  }

  .phase-status {
    font-size: 0.85rem;
  }

  .phase-status.completed { color: #10b981; }
  .phase-status.pending { color: #f59e0b; }

  .phase-name {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .phase-card.completed .phase-name { color: #10b981; }

  .phase-items {
    margin: 0;
    padding-left: 1rem;
    font-size: 0.75rem;
  }

  .phase-items li {
    margin-bottom: 0.2rem;
    opacity: 0.7;
  }

  /* Status Block */
  .status-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 1rem;
  }

  .status-pulse {
    width: 12px;
    height: 12px;
    background: #10b981;
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
    box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .status-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 0.5rem;
  }

  .status-list li {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
  }

  .check { color: #10b981; font-weight: bold; }
  .pending { color: #f59e0b; }

  /* Feature Deep Dive */
  .feature-deepdive {
    margin: 2.5rem 0;
    padding: 2rem;
    background: color-mix(in srgb, currentColor 2%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
  }

  .feature-deepdive h2 {
    margin-top: 0;
  }

  .deepdive-intro {
    opacity: 0.85;
    line-height: 1.6;
    margin-bottom: 1.5rem;
  }

  .usecase-block {
    background: color-mix(in srgb, #f59e0b 8%, transparent);
    border: 1px solid color-mix(in srgb, #f59e0b 25%, transparent);
    border-radius: 6px;
    padding: 1.25rem;
    margin-bottom: 2rem;
  }

  .usecase-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .usecase-icon {
    font-size: 1.25rem;
  }

  .usecase-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
    color: #f59e0b;
  }

  .usecase-desc {
    font-size: 0.85rem;
    line-height: 1.6;
    opacity: 0.9;
    margin: 0;
  }

  .deepdive-subhead {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    margin: 2rem 0 1rem 0;
    opacity: 0.7;
  }

  .deepdive-flow {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .flow-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .block-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .block-icon {
    font-size: 1rem;
  }

  .block-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.05em;
  }

  .flow-block.config .block-title { color: #8b5cf6; }
  .flow-block.backend .block-title { color: #10b981; }
  .flow-block.api .block-title { color: #3b82f6; }
  .flow-block.widget .block-title { color: #f59e0b; }

  .block-code {
    padding: 1rem;
  }

  .block-code pre {
    margin: 0;
    font-size: 0.7rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .block-code code {
    font-family: "IBM Plex Mono", monospace;
  }

  .block-steps {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .backend-step {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    font-size: 0.8rem;
    line-height: 1.4;
  }

  .backend-step .step-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    height: 20px;
    background: #10b981;
    color: white;
    border-radius: 50%;
    font-size: 0.65rem;
    font-weight: 600;
  }

  .flow-arrow-down {
    text-align: center;
    color: #10b981;
    font-size: 1.25rem;
    padding: 0.25rem 0;
  }

  /* Widget Mockup */
  .widget-mockup {
    margin: 1rem auto;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    overflow: hidden;
    max-width: 320px;
  }

  .mockup-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .mockup-icon {
    opacity: 0.5;
  }

  .mockup-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    flex: 1;
  }

  .mockup-status {
    font-size: 0.75rem;
  }

  .mockup-status.ok { color: #10b981; }
  .mockup-status.warning { color: #f59e0b; }
  .mockup-status.critical { color: #ef4444; }

  .mockup-body {
    padding: 1rem;
  }

  .mockup-desc {
    font-size: 0.7rem;
    opacity: 0.6;
    margin-bottom: 1rem;
  }

  .mockup-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 1rem;
  }

  .mockup-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.15rem;
  }

  .stat-arrow {
    font-size: 1rem;
  }

  .stat-arrow.down { color: #3b82f6; }
  .stat-arrow.up { color: #10b981; }

  .stat-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 1.1rem;
    font-weight: 700;
  }

  .stat-unit {
    font-size: 0.65rem;
    opacity: 0.6;
  }

  .mockup-total {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .mockup-pct {
    opacity: 0.6;
    margin-left: 0.5rem;
  }

  .mockup-bar {
    position: relative;
    height: 8px;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 4px;
    margin-bottom: 1rem;
    overflow: visible;
  }

  .bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981, #10b981);
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .bar-markers {
    position: absolute;
    top: 12px;
    left: 0;
    right: 0;
    font-size: 0.55rem;
    opacity: 0.5;
  }

  .bar-markers .marker {
    position: absolute;
    transform: translateX(-50%);
  }

  .bar-markers .marker.warning { color: #f59e0b; }
  .bar-markers .marker.critical { color: #ef4444; }

  .mockup-ports {
    font-size: 0.7rem;
    text-align: center;
    opacity: 0.6;
    margin-bottom: 0.75rem;
  }

  .mockup-export {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    text-align: center;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    cursor: pointer;
  }

  /* Tech Table */
  .tech-table {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .tech-row {
    display: flex;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    border-radius: 4px;
    font-size: 0.8rem;
  }

  .tech-label {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    color: #10b981;
    min-width: 140px;
    flex-shrink: 0;
  }

  .tech-value {
    opacity: 0.8;
  }

  /* Approach Grid */
  .approach-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .approach-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .approach-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .approach-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .approach-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .approach-desc {
    font-size: 0.75rem;
    opacity: 0.7;
    line-height: 1.4;
  }

  /* Port Grid Mockup */
  .portgrid-mockup {
    margin: 1.5rem 0;
  }

  .cisco-chassis {
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 8px;
    box-shadow: 0 4px 12px color-mix(in srgb, currentColor 10%, transparent);
    overflow: hidden;
    max-width: 500px;
    margin: 0 auto;
  }

  .chassis-bezel {
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
  }

  .chassis-bezel.top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid color-mix(in srgb, currentColor 12%, transparent);
  }

  .cisco-brand {
    font-family: 'Arial Black', Arial, sans-serif;
    font-size: 1rem;
    font-weight: 900;
    color: #00bceb;
    letter-spacing: 2px;
  }

  .chassis-hostname {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    opacity: 0.5;
  }

  .uplink-module {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .uplink-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    opacity: 0.5;
    min-width: 30px;
  }

  .uplink-ports {
    display: flex;
    gap: 4px;
  }

  .uplink-range {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    opacity: 0.4;
    margin-left: auto;
  }

  .sfp-port {
    width: 24px;
    height: 20px;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 2px;
    position: relative;
  }

  .sfp-port::before {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  .sfp-port.up::before { background: #22c55e; box-shadow: 0 0 4px #22c55e; }
  .sfp-port.down::before { background: #ef4444; box-shadow: 0 0 4px #ef4444; }
  .sfp-port.disabled::before { background: color-mix(in srgb, currentColor 20%, transparent); }

  .port-module {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 5%, transparent);
  }

  .port-module:last-of-type {
    border-bottom: none;
  }

  .module-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    opacity: 0.5;
    display: block;
    margin-bottom: 0.5rem;
  }

  .port-bank {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 4px;
    padding: 0.5rem;
  }

  .port-labels {
    display: flex;
    justify-content: space-around;
    padding: 0 2px;
  }

  .port-labels span {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.5rem;
    opacity: 0.4;
    width: 18px;
    text-align: center;
  }

  .port-labels.top { margin-bottom: 2px; }
  .port-labels.bottom { margin-top: 2px; }

  .port-row {
    display: flex;
    justify-content: space-around;
    padding: 2px;
  }

  .rj45-port {
    width: 18px;
    height: 14px;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 2px;
    position: relative;
  }

  .rj45-port::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 4px;
    height: 4px;
    border-radius: 50%;
  }

  .rj45-port.up::before { background: #22c55e; box-shadow: 0 0 3px #22c55e; }
  .rj45-port.down::before { background: #ef4444; box-shadow: 0 0 3px #ef4444; }
  .rj45-port.warning::before { background: #f59e0b; box-shadow: 0 0 3px #f59e0b; }
  .rj45-port.disabled::before { background: color-mix(in srgb, currentColor 20%, transparent); }

  .chassis-bezel.bottom {
    border-top: 1px solid color-mix(in srgb, currentColor 12%, transparent);
  }

  .status-legend {
    display: flex;
    gap: 1rem;
    font-size: 0.65rem;
    opacity: 0.7;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  .legend-item .led {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .legend-item .led.up { background: #22c55e; }
  .legend-item .led.down { background: #ef4444; }
  .legend-item .led.disabled { background: color-mix(in srgb, currentColor 25%, transparent); }

  /* LED Legend */
  .led-legend {
    margin: 1rem 0;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .led-legend-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    opacity: 0.7;
  }

  .led-legend-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.5rem;
  }

  .led-legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
  }

  .led-sample {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .led-sample.up { background: #22c55e; box-shadow: 0 0 4px #22c55e; }
  .led-sample.down { background: #ef4444; box-shadow: 0 0 4px #ef4444; }
  .led-sample.warning { background: #f59e0b; box-shadow: 0 0 4px #f59e0b; }
  .led-sample.disabled { background: #333; }

  .led-desc {
    opacity: 0.8;
  }

  /* Interface Types Table */
  .interface-types-table {
    margin: 1rem 0;
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    overflow: hidden;
    font-size: 0.8rem;
  }

  .intf-header {
    display: grid;
    grid-template-columns: 60px 1fr 70px 70px;
    padding: 0.6rem 1rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    font-weight: 600;
    opacity: 0.7;
  }

  .intf-row {
    display: grid;
    grid-template-columns: 60px 1fr 70px 70px;
    padding: 0.5rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 5%, transparent);
    align-items: center;
  }

  .intf-row:last-child { border-bottom: none; }

  .intf-row code {
    font-family: "IBM Plex Mono", monospace;
    color: #3b82f6;
    background: none;
    padding: 0;
  }

  .uplink-yes { color: #10b981; font-weight: 600; }
  .uplink-no { color: #666; }

  /* Port Detail Mockup */
  .port-detail-mockup {
    max-width: 320px;
    margin: 1rem auto;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .detail-back {
    font-size: 0.75rem;
    opacity: 0.6;
    cursor: pointer;
  }

  .detail-port {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .detail-led {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .detail-led.up { background: #22c55e; box-shadow: 0 0 4px #22c55e; }

  .detail-body {
    padding: 1rem;
  }

  .detail-alias {
    font-size: 0.85rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    margin-bottom: 1rem;
  }

  .detail-row {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1rem;
  }

  .detail-stat {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .stat-label {
    font-size: 0.65rem;
    opacity: 0.6;
    text-transform: uppercase;
  }

  .stat-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .stat-value.up { color: #22c55e; }

  .detail-section {
    margin-bottom: 1rem;
  }

  .section-label {
    font-size: 0.7rem;
    opacity: 0.6;
    text-transform: uppercase;
    display: block;
    margin-bottom: 0.5rem;
  }

  .util-bar {
    height: 8px;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.25rem;
  }

  .util-fill {
    height: 100%;
    background: #10b981;
    border-radius: 4px;
  }

  .util-pct {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    color: #10b981;
  }

  .traffic-stats {
    display: flex;
    gap: 1rem;
  }

  .traffic-box {
    flex: 1;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    text-align: center;
  }

  .traffic-dir {
    font-size: 0.65rem;
    opacity: 0.6;
    display: block;
  }

  .traffic-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 1rem;
    font-weight: 600;
    display: block;
  }

  .traffic-unit {
    font-size: 0.6rem;
    opacity: 0.5;
  }

  .detail-badges {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .badge {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
  }

  .badge.trunk {
    background: color-mix(in srgb, #3b82f6 20%, transparent);
    color: #3b82f6;
    border: 1px solid color-mix(in srgb, #3b82f6 40%, transparent);
  }

  .badge.poe {
    background: color-mix(in srgb, #f59e0b 20%, transparent);
    color: #f59e0b;
    border: 1px solid color-mix(in srgb, #f59e0b 40%, transparent);
  }

  /* Component Tree */
  .component-tree {
    margin: 1rem 0;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .tree-node {
    padding: 0.25rem 0;
  }

  .tree-node.root {
    font-weight: 600;
    color: #3b82f6;
  }

  .tree-children {
    margin-left: 1.5rem;
    border-left: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    padding-left: 1rem;
  }

  .tree-children .tree-node::before {
    content: '‚îú‚îÄ ';
    opacity: 0.4;
  }

  .tree-children .tree-node:last-child::before {
    content: '‚îî‚îÄ ';
  }

  .parsing-example pre {
    font-size: 0.75rem;
    line-height: 1.4;
  }

  /* Proxmox Panel Mockup */
  .proxmox-panel-mockup {
    max-width: 400px;
    margin: 1.5rem auto;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .pve-section {
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .pve-section:last-child {
    border-bottom: none;
  }

  .pve-section-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 0.75rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .pve-section-icon {
    font-size: 0.9rem;
  }

  .pve-section-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.7;
    flex: 1;
  }

  .pve-section-count {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.15rem 0.5rem;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 10px;
    opacity: 0.7;
  }

  .pve-section-body {
    padding: 0.5rem 0.75rem;
  }

  .pve-columns {
    display: grid;
    grid-template-columns: 1fr 50px 50px;
    padding: 0 0 0.25rem 18px;
    font-size: 0.6rem;
    opacity: 0.5;
    text-transform: uppercase;
  }

  .pve-col-cpu, .pve-col-ram {
    text-align: right;
  }

  .pve-row {
    display: grid;
    grid-template-columns: 14px 1fr 50px 50px;
    align-items: center;
    gap: 4px;
    padding: 0.25rem 0;
    font-size: 0.75rem;
  }

  .pve-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .pve-status.running {
    background: #22c55e;
    box-shadow: 0 0 4px #22c55e;
  }

  .pve-status.stopped {
    background: color-mix(in srgb, currentColor 30%, transparent);
  }

  .pve-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .pve-cpu {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    text-align: right;
    color: #60a5fa;
  }

  .pve-ram {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    text-align: right;
    color: #a78bfa;
  }

  .pve-section-body.storage {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 0.75rem;
  }

  .storage-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .storage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .storage-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .storage-type {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    padding: 0.1rem 0.4rem;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 3px;
    opacity: 0.6;
  }

  .storage-type.warning {
    background: color-mix(in srgb, #f59e0b 20%, transparent);
    color: #f59e0b;
    opacity: 1;
  }

  .storage-bar-container {
    height: 8px;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 4px;
    overflow: hidden;
  }

  .storage-bar {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .storage-bar.normal {
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
  }

  .storage-bar.warning {
    background: linear-gradient(90deg, #f59e0b, #fbbf24);
  }

  .storage-bar.critical {
    background: linear-gradient(90deg, #ef4444, #f87171);
  }

  .storage-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.65rem;
    opacity: 0.7;
  }

  .storage-used {
    font-family: "IBM Plex Mono", monospace;
  }

  .storage-pct {
    font-family: "IBM Plex Mono", monospace;
  }

  .storage-pct.warning {
    color: #f59e0b;
    opacity: 1;
  }

  /* Proxmox Legend */
  .pve-legend {
    margin: 1rem 0;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  .pve-legend-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    opacity: 0.7;
  }

  .pve-legend-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .pve-legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
  }

  .pve-legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .pve-legend-dot.running {
    background: #22c55e;
    box-shadow: 0 0 4px #22c55e;
  }

  .pve-legend-dot.stopped {
    background: color-mix(in srgb, currentColor 30%, transparent);
  }

  .pve-legend-sample {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
  }

  .pve-legend-sample.cpu {
    color: #60a5fa;
  }

  .pve-legend-sample.ram {
    color: #a78bfa;
  }

  .pve-legend-storage {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
    flex-wrap: wrap;
  }

  .pve-legend-bar {
    width: 24px;
    height: 8px;
    border-radius: 4px;
  }

  .pve-legend-bar.normal {
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
  }

  .pve-legend-bar.warning {
    background: linear-gradient(90deg, #f59e0b, #fbbf24);
  }

  .pve-legend-bar.critical {
    background: linear-gradient(90deg, #ef4444, #f87171);
  }

  /* Data Sources Block */
  .data-sources-block {
    margin: 1rem 0;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .data-source {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .source-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    color: #3b82f6;
  }

  .source-desc {
    font-size: 0.8rem;
    opacity: 0.7;
  }

  .data-source-endpoints {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .endpoint {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    font-size: 0.75rem;
  }

  .endpoint code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    color: #10b981;
    background: none;
    padding: 0;
  }

  .endpoint span {
    opacity: 0.7;
  }

  /* Matching Strategies */
  .matching-strategies {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .strategy {
    display: grid;
    grid-template-columns: 24px 80px 1fr;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    font-size: 0.75rem;
  }

  .strategy-num {
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 50%;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    font-weight: 600;
  }

  .strategy-name {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    color: #3b82f6;
  }

  .strategy-example {
    opacity: 0.7;
    font-size: 0.7rem;
  }

  /* API Endpoints List */
  .api-endpoints-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .api-endpoint {
    display: flex;
    gap: 1rem;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    font-size: 0.75rem;
  }

  .api-endpoint code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    color: #10b981;
    background: none;
    padding: 0;
    min-width: 180px;
  }

  .api-endpoint span {
    opacity: 0.7;
  }

  /* Diagnostic Scenarios */
  .diagnostic-scenarios {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .scenario-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 8px;
    padding: 1.25rem;
  }

  .scenario-card.isp {
    border-left: 3px solid #ef4444;
  }

  .scenario-card.internal {
    border-left: 3px solid #f59e0b;
  }

  .scenario-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .scenario-icon {
    font-size: 1.25rem;
  }

  .scenario-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .scenario-card.isp .scenario-label { color: #ef4444; }
  .scenario-card.internal .scenario-label { color: #f59e0b; }

  .scenario-indicators {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .indicator {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 6px;
  }

  .indicator.good {
    border: 1px solid color-mix(in srgb, #10b981 30%, transparent);
  }

  .indicator.bad {
    border: 1px solid color-mix(in srgb, #ef4444 30%, transparent);
  }

  .indicator-icon {
    font-size: 1rem;
  }

  .indicator-metric {
    font-size: 0.65rem;
    opacity: 0.6;
  }

  .indicator-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .indicator.good .indicator-value { color: #10b981; }
  .indicator.bad .indicator-value { color: #ef4444; }

  .scenario-conclusion {
    font-size: 0.8rem;
    line-height: 1.5;
    opacity: 0.85;
    margin: 0;
  }

  /* Correlation Flow */
  .correlation-flow {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin: 1rem 0;
  }

  .corr-step {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .corr-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    background: #3b82f6;
    color: white;
    border-radius: 50%;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .corr-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .corr-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .corr-desc {
    font-size: 0.8rem;
    opacity: 0.75;
    line-height: 1.4;
  }

  .corr-path {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    color: #8b5cf6;
    background: color-mix(in srgb, #8b5cf6 10%, transparent);
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    width: fit-content;
  }

  /* CSV Example */
  .csv-example {
    margin: 1rem 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .csv-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .csv-label {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    color: #10b981;
  }

  .csv-block pre {
    margin: 0;
    padding: 1rem;
    font-size: 0.7rem;
    line-height: 1.6;
    overflow-x: auto;
  }

  .csv-block code {
    font-family: "IBM Plex Mono", monospace;
  }

  .analysis-box {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: color-mix(in srgb, #10b981 8%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 25%, transparent);
    border-radius: 6px;
  }

  .analysis-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .analysis-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .analysis-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
    color: #10b981;
  }

  .analysis-desc {
    font-size: 0.85rem;
    line-height: 1.6;
    opacity: 0.9;
    margin: 0;
  }

  /* Speedtest Widget Styles */
  .scheduler-block .block-title { color: #f59e0b; }

  .api-endpoints-list {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .endpoint-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .endpoint-item code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    color: #10b981;
  }

  .endpoint-desc {
    font-size: 0.75rem;
    opacity: 0.7;
    padding-left: 0.5rem;
  }

  .speedtest-widget-mockup {
    margin: 1rem auto;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    overflow: hidden;
    max-width: 300px;
  }

  .mockup-collapse {
    opacity: 0.5;
    font-size: 0.75rem;
  }

  .speedtest-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 1rem;
  }

  .speed-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.15rem;
  }

  .speed-arrow {
    font-size: 1rem;
  }

  .speed-arrow.down { color: #3b82f6; }
  .speed-arrow.up { color: #10b981; }

  .speed-value {
    font-family: "IBM Plex Mono", monospace;
    font-size: 1.1rem;
    font-weight: 700;
  }

  .speed-unit {
    font-size: 0.65rem;
    opacity: 0.6;
  }

  .speedtest-latency {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    opacity: 0.8;
    margin-bottom: 0.75rem;
  }

  .latency-sep {
    opacity: 0.4;
  }

  .speedtest-server {
    font-size: 0.75rem;
    text-align: center;
    opacity: 0.7;
    margin-bottom: 0.25rem;
  }

  .speedtest-time {
    font-size: 0.7rem;
    text-align: center;
    opacity: 0.5;
    margin-bottom: 0.75rem;
  }

  .speedtest-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-bottom: 0.75rem;
  }

  .speedtest-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0.4rem 0.75rem;
    border: 1px solid color-mix(in srgb, currentColor 20%, transparent);
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    cursor: pointer;
  }

  .speedtest-btn.run {
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    border-color: color-mix(in srgb, #3b82f6 30%, transparent);
    color: #3b82f6;
  }

  .speedtest-link {
    font-size: 0.7rem;
    text-align: center;
    color: #3b82f6;
    opacity: 0.8;
  }

  .widget-states {
    padding: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    font-size: 0.75rem;
    border-top: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .widget-state {
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 3px;
  }

  .section-desc {
    font-size: 0.85rem;
    opacity: 0.8;
    margin-bottom: 1rem;
  }

  /* Status Table */
  .status-table {
    margin: 1rem 0;
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .status-row {
    display: grid;
    grid-template-columns: 100px 100px 1fr;
    gap: 1rem;
    padding: 0.75rem 1rem;
    font-size: 0.8rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .status-row:last-child {
    border-bottom: none;
  }

  .status-row.header {
    background: color-mix(in srgb, currentColor 5%, transparent);
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    opacity: 0.7;
  }

  .status-col {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .status-col code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .status-dot {
    font-size: 1rem;
  }

  .status-dot.green { color: #10b981; }
  .status-dot.yellow { color: #f59e0b; }
  .status-dot.red { color: #ef4444; }

  /* Code Snippet */
  .code-snippet {
    margin: 1rem 0;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .snippet-label {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    color: #8b5cf6;
  }

  .code-snippet pre {
    margin: 0;
    padding: 1rem;
    font-size: 0.75rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .code-snippet code {
    font-family: "IBM Plex Mono", monospace;
  }

  /* Topology Example */
  .topology-example {
    margin: 1rem 0;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .topo-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .topo-visual {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 2rem;
  }

  .topo-node {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
  }

  .topo-node.firewall { border-color: color-mix(in srgb, #ef4444 40%, transparent); color: #ef4444; }
  .topo-node.isp { border-color: color-mix(in srgb, #3b82f6 40%, transparent); color: #3b82f6; }

  .topo-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .link-line {
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #10b981, #10b981);
    border-radius: 2px;
    position: relative;
    overflow: hidden;
  }

  .link-line::after {
    content: "";
    position: absolute;
    top: 0;
    left: -20px;
    width: 20px;
    height: 100%;
    background: rgba(255,255,255,0.4);
    animation: linkPulse 1s ease-in-out infinite;
  }

  @keyframes linkPulse {
    0% { left: -20px; }
    100% { left: 80px; }
  }

  .link-label {
    font-size: 0.65rem;
    opacity: 0.6;
  }

  .topo-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    padding: 1rem;
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    font-size: 0.75rem;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .legend-line {
    width: 20px;
    height: 3px;
    border-radius: 2px;
  }

  .legend-line.green { background: #10b981; }
  .legend-line.yellow { background: #f59e0b; }
  .legend-line.red { background: #ef4444; }

  /* Numbered Flow */
  .numbered-flow {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin: 1rem 0;
  }

  .flow-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .flow-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    background: #8b5cf6;
    color: white;
    border-radius: 50%;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .flow-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .flow-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .flow-desc {
    font-size: 0.8rem;
    opacity: 0.75;
    line-height: 1.4;
  }

  /* Port Search Styles */
  .port-search-mockup {
    margin: 1rem auto;
    max-width: 360px;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    overflow: hidden;
    max-width: 320px;
  }

  .search-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .search-icon {
    opacity: 0.7;
  }

  .search-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    flex: 1;
  }

  .search-body {
    padding: 1rem;
  }

  .search-input-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .search-input {
    flex: 1;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
    color: currentColor;
  }

  .search-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    border: 1px solid color-mix(in srgb, #3b82f6 30%, transparent);
    border-radius: 4px;
    color: #3b82f6;
    cursor: pointer;
  }

  .status-filters {
    display: flex;
    gap: 0.5rem;
  }

  .filter-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0.35rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
    color: currentColor;
    opacity: 0.6;
    cursor: pointer;
  }

  .filter-btn.active {
    background: color-mix(in srgb, #10b981 15%, transparent);
    border-color: color-mix(in srgb, #10b981 30%, transparent);
    color: #10b981;
    opacity: 1;
  }

  .api-call-label {
    text-align: center;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    color: #3b82f6;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, #3b82f6 10%, transparent);
    border-radius: 4px;
    margin: 0.5rem auto;
    width: fit-content;
  }

  .search-results-mockup {
    margin: 1rem auto;
    max-width: 360px;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    overflow: hidden;
    max-width: 320px;
  }

  .results-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .results-list {
    max-height: 200px;
    overflow-y: auto;
  }

  .port-result {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .port-result:last-child {
    border-bottom: none;
  }

  .port-result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
  }

  .port-device {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .port-status {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.15rem 0.4rem;
    border-radius: 3px;
    text-transform: uppercase;
  }

  .port-status.up {
    background: color-mix(in srgb, #10b981 15%, transparent);
    color: #10b981;
  }

  .port-status.down {
    background: color-mix(in srgb, #ef4444 15%, transparent);
    color: #ef4444;
  }

  .port-result-info {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    margin-bottom: 0.25rem;
  }

  .port-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    color: #3b82f6;
  }

  .port-speed {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.1rem 0.3rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border-radius: 2px;
    opacity: 0.7;
  }

  .port-alias {
    font-size: 0.75rem;
    opacity: 0.8;
    margin-bottom: 0.25rem;
  }

  .port-traffic {
    display: flex;
    gap: 1rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
  }

  .traffic-in {
    color: #3b82f6;
  }

  .traffic-out {
    color: #10b981;
  }

  /* Alias Discovery */
  .alias-discovery {
    margin: 1rem 0;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .alias-request {
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .alias-request code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    color: #10b981;
  }

  .alias-response {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 0.5rem;
    padding: 1rem;
  }

  .alias-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    font-size: 0.75rem;
  }

  .alias-term {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
  }

  .alias-count {
    opacity: 0.6;
  }

  .alias-desc {
    font-size: 0.8rem;
    opacity: 0.75;
    padding: 1rem;
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    margin: 0;
  }

  /* UI States Grid */
  .ui-states-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.75rem;
    margin: 1rem 0;
  }

  .ui-state {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
  }

  .state-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    color: #8b5cf6;
  }

  .state-desc {
    font-size: 0.75rem;
    opacity: 0.75;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .architecture { padding: 1rem; }

    .backend-flow {
      flex-direction: column;
    }

    .flow-arrow {
      transform: rotate(90deg);
    }

    .dataflow {
      flex-direction: column;
    }

    .flow-connector {
      height: auto;
      padding: 0.5rem 0;
      transform: rotate(90deg);
    }

    .source-grid,
    .frontend-grid,
    .features-grid,
    .decisions-grid,
    .phases-grid,
    .approach-grid {
      grid-template-columns: 1fr;
    }

    .feature-deepdive {
      padding: 1rem;
    }

    .tech-row {
      flex-direction: column;
      gap: 0.25rem;
    }

    .tech-label {
      min-width: auto;
    }

    .widget-mockup {
      max-width: 100%;
    }

    .diagnostic-scenarios {
      grid-template-columns: 1fr;
    }

    .scenario-indicators {
      flex-direction: column;
    }

    .speedtest-widget-mockup {
      max-width: 100%;
    }

    .status-row {
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .status-row.header {
      display: none;
    }

    .status-col:first-child::before {
      content: "Status: ";
      opacity: 0.6;
    }

    .topo-visual {
      flex-direction: column;
    }

    .link-line {
      width: 3px;
      height: 40px;
    }

    .port-search-mockup,
    .search-results-mockup {
      max-width: 100%;
    }

    .alias-response {
      grid-template-columns: 1fr;
    }

    .ui-states-grid {
      grid-template-columns: 1fr;
    }

    .value-showcase {
      padding: 1.5rem;
    }

    .value-metrics {
      grid-template-columns: repeat(2, 1fr);
    }

    .comparison-row {
      grid-template-columns: 1fr;
      gap: 0.25rem;
      text-align: center;
    }

    .comparison-row.header {
      display: none;
    }

    .comparison-col:first-child {
      font-weight: 600;
      opacity: 0.7;
      font-size: 0.75rem;
    }

    .comparison-col:not(:first-child) {
      justify-content: center;
    }

    .comparison-col:not(:first-child)::before {
      content: attr(data-label);
      font-size: 0.65rem;
      opacity: 0.5;
      margin-right: 0.5rem;
    }

    .value-context {
      grid-template-columns: 1fr;
    }

    .arch-split {
      flex-direction: column;
    }

    .view-mockup-container {
      flex-direction: column;
    }

    .models-grid {
      grid-template-columns: 1fr;
    }

    .vlan-row {
      flex-direction: column;
      gap: 0.5rem;
    }

    .vlan-edge {
      display: none;
    }
  }

  /* L2/L3 Toggle Deep Dive Styles */
  .l2l3-architecture {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .arch-trigger {
    text-align: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px dashed color-mix(in srgb, currentColor 15%, transparent);
  }

  .arch-trigger-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .arch-trigger-desc {
    font-size: 0.75rem;
    opacity: 0.7;
  }

  .arch-split {
    display: flex;
    gap: 1.5rem;
  }

  .arch-branch {
    flex: 1;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .arch-branch.l2 {
    border-top: 3px solid #00bceb;
  }

  .arch-branch.l3 {
    border-top: 3px solid #a78bfa;
  }

  .branch-header {
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .branch-badge {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
  }

  .branch-badge.l2 {
    background: color-mix(in srgb, #00bceb 15%, transparent);
    color: #00bceb;
  }

  .branch-badge.l3 {
    background: color-mix(in srgb, #a78bfa 15%, transparent);
    color: #a78bfa;
  }

  .branch-flow {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .branch-step {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    text-align: center;
    width: 100%;
  }

  .branch-step.api {
    color: #10b981;
    background: color-mix(in srgb, #10b981 10%, transparent);
  }

  .branch-arrow {
    font-size: 0.8rem;
    opacity: 0.5;
  }

  .branch-creates {
    width: 100%;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
  }

  .creates-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    display: block;
    margin-bottom: 0.5rem;
    opacity: 0.7;
  }

  .branch-creates ul {
    margin: 0;
    padding-left: 1.25rem;
    font-size: 0.7rem;
  }

  .branch-creates li {
    margin-bottom: 0.25rem;
  }

  .branch-result {
    font-size: 0.7rem;
    text-align: center;
    padding: 0.5rem;
    opacity: 0.8;
    font-style: italic;
  }

  /* View Mockups */
  .view-mockup-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .view-mockup {
    flex: 1;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .l2-mockup {
    border-top: 3px solid #00bceb;
  }

  .l3-mockup {
    border-top: 3px solid #a78bfa;
  }

  .mockup-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .mockup-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .mockup-theme {
    font-size: 0.7rem;
    opacity: 0.6;
  }

  .mockup-toolbar {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .toggle-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    background: color-mix(in srgb, currentColor 5%, transparent);
    opacity: 0.6;
  }

  .toggle-btn.active.l2 {
    background: color-mix(in srgb, #00bceb 20%, transparent);
    color: #00bceb;
    opacity: 1;
  }

  .toggle-btn.active.l3 {
    background: color-mix(in srgb, #a78bfa 20%, transparent);
    color: #a78bfa;
    opacity: 1;
  }

  .mockup-spacer {
    flex: 1;
  }

  .toolbar-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    padding: 0.2rem 0.4rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 3px;
    opacity: 0.7;
  }

  .mockup-canvas {
    padding: 1rem;
    min-height: 180px;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    position: relative;
  }

  /* L2 Canvas Elements */
  .l2-cluster {
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
    padding: 0.5rem 0.75rem;
    display: inline-block;
  }

  .cluster-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .cluster-devices {
    font-size: 0.65rem;
    opacity: 0.8;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .cluster-devices.collapsed {
    font-style: italic;
    opacity: 0.6;
  }

  .device-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 0.25rem;
  }

  .device-dot.up {
    background: #10b981;
  }

  .device-dot.down {
    background: #ef4444;
  }

  .l2-link {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    color: #00bceb;
    padding: 0.1rem 0.3rem;
    background: color-mix(in srgb, #00bceb 10%, transparent);
    border-radius: 2px;
    align-self: center;
  }

  .l2-external {
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .external-icon {
    font-size: 1rem;
  }

  .wan-badge {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.55rem;
    padding: 0.1rem 0.3rem;
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    color: #f59e0b;
    border-radius: 2px;
  }

  .mockup-legend {
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .legend-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    font-weight: 600;
    opacity: 0.6;
    margin-bottom: 0.25rem;
    display: block;
  }

  .legend-items {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .legend-item {
    font-size: 0.6rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .link-color {
    width: 12px;
    height: 2px;
    border-radius: 1px;
  }

  .link-color.green { background: #10b981; }
  .link-color.blue { background: #3b82f6; }
  .link-color.yellow { background: #f59e0b; }
  .link-color.red { background: #ef4444; }
  .link-color.grey { background: #6b7280; }

  /* L3 Canvas Elements */
  .l3-canvas {
    gap: 0.5rem;
  }

  .vlan-row {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .vlan-group {
    flex: 1;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, #a78bfa 20%, transparent);
    border-radius: 4px;
    padding: 0.5rem;
  }

  .vlan-header {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    margin-bottom: 0.25rem;
  }

  .vlan-icon {
    font-size: 0.7rem;
    opacity: 0.7;
  }

  .vlan-id {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #a78bfa;
  }

  .gw-badge {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.5rem;
    padding: 0.1rem 0.25rem;
    background: color-mix(in srgb, #a78bfa 20%, transparent);
    color: #a78bfa;
    border-radius: 2px;
    margin-left: auto;
  }

  .vlan-name {
    font-size: 0.6rem;
    opacity: 0.6;
    margin-bottom: 0.35rem;
  }

  .vlan-devices {
    display: flex;
    gap: 0.2rem;
    margin-bottom: 0.25rem;
  }

  .vlan-dot {
    width: 8px;
    height: 8px;
    border-radius: 2px;
  }

  .vlan-dot.up {
    background: #10b981;
  }

  .vlan-dot.down {
    background: #ef4444;
  }

  .vlan-count {
    font-size: 0.55rem;
    opacity: 0.6;
  }

  .vlan-edge {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.55rem;
    color: #a78bfa;
    padding: 0.15rem 0.35rem;
    background: color-mix(in srgb, #a78bfa 10%, transparent);
    border-radius: 2px;
  }

  .vlan-connectors {
    display: flex;
    justify-content: space-around;
    padding: 0 2rem;
  }

  .vlan-connector-line {
    width: 2px;
    height: 20px;
    background: linear-gradient(to bottom, #a78bfa, color-mix(in srgb, #a78bfa 30%, transparent));
  }

  .vlan-filter {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
    align-items: center;
  }

  .filter-chip {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.55rem;
    padding: 0.15rem 0.35rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 2px;
    opacity: 0.6;
  }

  .filter-chip.active {
    background: color-mix(in srgb, #a78bfa 15%, transparent);
    color: #a78bfa;
    opacity: 1;
  }

  .filter-clear {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.55rem;
    color: #ef4444;
    opacity: 0.7;
  }

  /* VlanGroupNode Mockup */
  .vlan-node-mockup {
    max-width: 280px;
    margin: 0 auto 1.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, #a78bfa 25%, transparent);
    border-top: 3px solid #a78bfa;
    border-radius: 6px;
    overflow: hidden;
  }

  .vng-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .vng-icon {
    font-size: 0.9rem;
    color: #a78bfa;
  }

  .vng-id {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #a78bfa;
  }

  .vng-gw {
    margin-left: auto;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    padding: 0.15rem 0.4rem;
    background: color-mix(in srgb, #a78bfa 20%, transparent);
    color: #a78bfa;
    border-radius: 3px;
  }

  .vng-name {
    padding: 0 0.75rem;
    font-size: 0.75rem;
    opacity: 0.6;
    margin-top: 0.5rem;
  }

  .vng-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.35rem;
    padding: 0.75rem;
  }

  .vng-dot {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .vng-dot.up {
    background: #10b981;
  }

  .vng-dot.down {
    background: #ef4444;
  }

  .vng-dot.gw {
    box-shadow: 0 0 0 2px #a78bfa;
  }

  .vng-dot.small {
    width: 10px;
    height: 10px;
    border-radius: 2px;
  }

  .vng-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .vng-count {
    font-size: 0.7rem;
    opacity: 0.7;
  }

  .vng-status {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
  }

  .vng-status.healthy {
    color: #10b981;
  }

  .vng-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .vng-legend-item {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.6rem;
    opacity: 0.7;
  }

  /* Algorithm Blocks */
  .algorithm-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
  }

  .algo-step {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    align-items: flex-start;
  }

  .algo-num {
    flex-shrink: 0;
    width: 22px;
    height: 22px;
    background: color-mix(in srgb, #a78bfa 20%, transparent);
    color: #a78bfa;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .algo-content {
    flex: 1;
  }

  .algo-title {
    font-weight: 600;
    font-size: 0.8rem;
    display: block;
    margin-bottom: 0.25rem;
  }

  .algo-content code {
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    display: block;
  }

  .algo-result {
    display: flex;
    gap: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px dashed color-mix(in srgb, currentColor 15%, transparent);
    margin-top: 0.5rem;
  }

  .result-icon {
    flex-shrink: 0;
    color: #10b981;
    font-weight: 600;
  }

  .result-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .result-item {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  .result-check {
    color: #10b981;
  }

  .algo-example {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px dashed color-mix(in srgb, currentColor 15%, transparent);
  }

  .example-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #f59e0b;
    display: block;
    margin-bottom: 0.35rem;
  }

  .example-content {
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
  }

  .example-input {
    font-size: 0.7rem;
    margin-bottom: 0.25rem;
  }

  .example-output {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    color: #10b981;
  }

  /* Models Grid */
  .models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .model-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .model-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .model-icon {
    font-size: 1rem;
  }

  .model-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .model-code {
    padding: 0.75rem;
  }

  .model-code pre {
    margin: 0;
    font-size: 0.65rem;
    line-height: 1.5;
  }

  .model-code code {
    background: none;
    padding: 0;
  }

  /* Component Tree */
  .component-tree {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .tree-root {
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .tree-children {
    padding-left: 0.5rem;
  }

  .tree-branch {
    margin-bottom: 0.5rem;
  }

  .tree-connector {
    opacity: 0.4;
  }

  .tree-name {
    font-weight: 600;
  }

  .tree-sub {
    padding-left: 0;
  }

  .tree-leaf {
    opacity: 0.8;
  }

  .tree-note {
    font-size: 0.65rem;
    opacity: 0.6;
  }

  /* UI States Table */
  .ui-states-table {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .state-row {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 1rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .state-row:last-child {
    border-bottom: none;
  }

  .state-row.header {
    background: color-mix(in srgb, currentColor 5%, transparent);
    font-weight: 600;
    font-size: 0.75rem;
  }

  .state-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .state-display {
    font-size: 0.75rem;
    opacity: 0.85;
  }

  /* Tech Stack Table */
  .tech-stack-table {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .stack-row {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 1rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .stack-row:last-child {
    border-bottom: none;
  }

  .stack-layer {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    opacity: 0.7;
  }

  .stack-tech {
    font-size: 0.75rem;
  }

  /* Mermaid Export Deep Dive Styles */
  .mermaid-architecture {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .arch-branch.mermaid-visualize {
    border-top: 3px solid #3b82f6;
  }

  .arch-branch.mermaid-export-branch {
    border-top: 3px solid #10b981;
  }

  .branch-badge.visualize {
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    color: #3b82f6;
  }

  .branch-badge.export {
    background: color-mix(in srgb, #10b981 15%, transparent);
    color: #10b981;
  }

  /* Mermaid Modal Mockup */
  .mermaid-modal-mockup {
    max-width: 600px;
    margin: 0 auto 1.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .modal-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .modal-icon {
    font-size: 1rem;
  }

  .modal-controls {
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  .zoom-btn {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
  }

  .zoom-level {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0 0.5rem;
    opacity: 0.7;
  }

  .zoom-btn.close {
    background: color-mix(in srgb, #ef4444 15%, transparent);
    color: #ef4444;
  }

  .modal-canvas {
    padding: 1rem;
    min-height: 250px;
    position: relative;
  }

  .mermaid-diagram-preview {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 6px;
  }

  .mermaid-subgraph {
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px dashed color-mix(in srgb, currentColor 20%, transparent);
    border-radius: 6px;
    padding: 0.75rem;
    min-width: 200px;
  }

  .mermaid-subgraph.core {
    border-color: color-mix(in srgb, #3b82f6 30%, transparent);
  }

  .mermaid-subgraph.firewall {
    border-color: color-mix(in srgb, #f59e0b 30%, transparent);
  }

  .subgraph-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    text-align: center;
    margin-bottom: 0.5rem;
    opacity: 0.7;
  }

  .mermaid-nodes {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }

  .mermaid-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    border: 1px solid color-mix(in srgb, #3b82f6 30%, transparent);
    border-radius: 4px;
  }

  .mermaid-node.hexagon {
    clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    padding: 0.5rem 1rem;
  }

  .mermaid-node.trapezoid {
    clip-path: polygon(10% 0%, 90% 0%, 100% 100%, 0% 100%);
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    border-color: color-mix(in srgb, #f59e0b 30%, transparent);
  }

  .node-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .node-ip {
    font-size: 0.6rem;
    opacity: 0.6;
  }

  .mermaid-link {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    color: #6b7280;
  }

  .mermaid-link.labeled {
    padding: 0.15rem 0.4rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 3px;
  }

  .mermaid-link.dashed {
    letter-spacing: 2px;
    opacity: 0.5;
  }

  .mermaid-external {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .external-circle {
    color: #6b7280;
  }

  .mermaid-legend {
    position: absolute;
    bottom: 1rem;
    left: 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 0.75rem;
    font-size: 0.65rem;
  }

  .mermaid-legend .legend-title {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .mermaid-legend .legend-section {
    margin-bottom: 0.5rem;
  }

  .mermaid-legend .legend-section:last-child {
    margin-bottom: 0;
  }

  .mermaid-legend .legend-label {
    font-weight: 600;
    opacity: 0.7;
    margin-bottom: 0.25rem;
  }

  .mermaid-legend .legend-item {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    margin-bottom: 0.15rem;
  }

  .shape-hex { color: #3b82f6; }
  .shape-trap { color: #f59e0b; }
  .shape-rect { color: #6b7280; }
  .shape-circle { color: #8b5cf6; }

  .line-solid {
    display: inline-block;
    width: 16px;
    height: 2px;
    background: currentColor;
  }

  .line-dashed {
    display: inline-block;
    width: 16px;
    border-bottom: 2px dashed currentColor;
  }

  .modal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    font-size: 0.65rem;
  }

  .footer-hint {
    opacity: 0.6;
  }

  .footer-powered {
    opacity: 0.5;
    font-style: italic;
  }

  /* Algorithm Enhancements for Mermaid */
  .algo-input, .algo-output {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    margin-bottom: 0.75rem;
  }

  .input-label, .output-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #8b5cf6;
  }

  .algo-input code, .algo-output code {
    font-size: 0.7rem;
    background: none;
    padding: 0;
  }

  .algo-detail {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .algo-detail code {
    display: block;
    margin-bottom: 0.25rem;
  }

  .algo-substeps {
    font-size: 0.7rem;
    opacity: 0.8;
    padding-left: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  /* Code Output Block */
  .code-output-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .code-output-block .code-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .code-output-block .code-lang {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #3b82f6;
  }

  .code-output-block .code-desc {
    font-size: 0.7rem;
    opacity: 0.6;
  }

  .code-output-block pre {
    margin: 0;
    padding: 1rem;
    font-size: 0.7rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .code-output-block code {
    background: none;
    padding: 0;
  }

  /* Shape Mapping Table */
  .shape-mapping-table {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .shape-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1.5fr 0.5fr;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    align-items: center;
  }

  .shape-row:last-child {
    border-bottom: none;
  }

  .shape-row.header {
    background: color-mix(in srgb, currentColor 5%, transparent);
    font-weight: 600;
    font-size: 0.75rem;
  }

  .shape-type {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .shape-name {
    font-size: 0.75rem;
    opacity: 0.8;
  }

  .shape-syntax code {
    font-size: 0.65rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    padding: 0.15rem 0.35rem;
    border-radius: 3px;
  }

  .shape-visual {
    font-size: 1rem;
    text-align: center;
  }

  .shape-visual.hex { color: #3b82f6; }
  .shape-visual.trap { color: #f59e0b; }
  .shape-visual.rect { color: #6b7280; }
  .shape-visual.circle { color: #8b5cf6; }

  /* Connection Mapping Table */
  .connection-mapping-table {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .conn-row {
    display: grid;
    grid-template-columns: 1fr 1.5fr 1fr;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    align-items: center;
  }

  .conn-row:last-child {
    border-bottom: none;
  }

  .conn-row.header {
    background: color-mix(in srgb, currentColor 5%, transparent);
    font-weight: 600;
    font-size: 0.75rem;
  }

  .conn-type {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
  }

  .conn-syntax code {
    font-size: 0.65rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    padding: 0.15rem 0.35rem;
    border-radius: 3px;
  }

  .conn-visual {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  /* Code Block Inline */
  .code-block-inline {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .code-block-inline pre {
    margin: 0;
    padding: 1rem;
    font-size: 0.7rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .code-block-inline code {
    background: none;
    padding: 0;
  }

  /* Theme Config Block */
  .theme-config-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
  }

  .config-section {
    margin-bottom: 1rem;
  }

  .config-section:last-child {
    margin-bottom: 0;
  }

  .config-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    display: block;
    margin-bottom: 0.5rem;
    opacity: 0.7;
  }

  .config-items {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    padding-left: 0.5rem;
  }

  .config-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
  }

  .color-swatch {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid color-mix(in srgb, currentColor 20%, transparent);
    flex-shrink: 0;
  }

  .config-item code {
    font-size: 0.65rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    padding: 0.1rem 0.35rem;
    border-radius: 3px;
  }

  .config-note {
    opacity: 0.6;
    font-size: 0.65rem;
  }

  /* File Output Block */
  .file-output-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .file-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .file-icon {
    font-size: 1rem;
  }

  .file-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .file-content pre {
    margin: 0;
    padding: 1rem;
    font-size: 0.7rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .file-content code {
    background: none;
    padding: 0;
  }

  .file-footer {
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .file-note {
    font-size: 0.65rem;
    opacity: 0.7;
    font-style: italic;
  }

  /* Responsive adjustments for Mermaid section */
  @media (max-width: 768px) {
    .shape-row {
      grid-template-columns: 1fr 1fr;
      gap: 0.25rem;
    }

    .shape-row .shape-syntax,
    .shape-row .shape-visual {
      display: none;
    }

    .conn-row {
      grid-template-columns: 1fr 1fr;
    }

    .conn-row .conn-visual {
      display: none;
    }

    .mermaid-legend {
      position: static;
      margin-top: 1rem;
    }

    .alert-mockups {
      flex-direction: column;
    }

    .severity-row {
      grid-template-columns: 1fr 1fr;
    }

    .severity-row .sev-icon,
    .severity-row .sev-badge {
      display: none;
    }
  }

  /* Alert System Deep Dive Styles */
  .alert-architecture {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }

  .arch-sources {
    width: 100%;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .source-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    opacity: 0.7;
  }

  .source-items {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .source-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    flex: 1;
    min-width: 200px;
  }

  .source-icon {
    font-size: 1.25rem;
  }

  .source-content {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .source-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .source-desc {
    font-size: 0.7rem;
    opacity: 0.7;
  }

  .arch-arrow-down {
    font-size: 1rem;
    opacity: 0.5;
  }

  .arch-backend {
    width: 100%;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-top: 3px solid #10b981;
    border-radius: 6px;
    overflow: hidden;
  }

  .backend-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .backend-icon {
    font-size: 1rem;
  }

  .backend-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .backend-content {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .backend-functions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .backend-functions code {
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
  }

  .backend-combine {
    font-size: 0.75rem;
    text-align: center;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
  }

  .backend-ack {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
  }

  .ack-label {
    opacity: 0.7;
  }

  .arch-frontend {
    width: 100%;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-top: 3px solid #3b82f6;
    border-radius: 6px;
    overflow: hidden;
  }

  .frontend-header {
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .frontend-flow {
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .frontend-hook {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    border-radius: 3px;
    color: #3b82f6;
  }

  .frontend-stores {
    display: flex;
    gap: 0.5rem;
    font-size: 0.7rem;
    opacity: 0.7;
  }

  .frontend-components {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 0.5rem;
    padding: 0.75rem 1rem;
  }

  .frontend-comp {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    text-align: center;
  }

  .comp-icon {
    font-size: 1rem;
  }

  .comp-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .comp-desc {
    font-size: 0.6rem;
    opacity: 0.7;
  }

  /* Alert Mockups */
  .alert-mockups {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .alert-mockup {
    flex: 1;
    min-width: 250px;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .mockup-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .mockup-note {
    font-size: 0.6rem;
    padding: 0.5rem 0.75rem;
    opacity: 0.6;
    font-style: italic;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-top: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  /* Bell Header Preview */
  .bell-header-preview {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
  }

  .brand {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 700;
  }

  .bell-area {
    position: relative;
  }

  .bell-icon {
    font-size: 1.25rem;
  }

  .bell-badge {
    position: absolute;
    top: -4px;
    right: -8px;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
    font-weight: 600;
    padding: 0.1rem 0.35rem;
    border-radius: 8px;
    color: white;
  }

  .bell-badge.critical {
    background: #f85149;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .header-icons {
    font-size: 0.9rem;
    opacity: 0.7;
  }

  /* Toast Stack Preview */
  .toast-stack-preview {
    padding: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .toast-item {
    display: flex;
    gap: 0.5rem;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    border-left: 3px solid;
  }

  .toast-item.critical {
    border-left-color: #f85149;
  }

  .toast-item.warning {
    border-left-color: #d29922;
  }

  .toast-item.recovery {
    border-left-color: #3fb950;
  }

  .toast-icon {
    font-size: 0.9rem;
  }

  .toast-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .toast-header {
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  .status-dot.critical {
    background: #f85149;
    animation: pulse 2s ease-in-out infinite;
  }

  .status-dot.warning {
    background: #d29922;
  }

  .status-dot.recovery {
    background: #3fb950;
  }

  .toast-device {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .toast-message {
    font-size: 0.65rem;
    opacity: 0.8;
  }

  .toast-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.25rem;
  }

  .toast-time {
    font-size: 0.6rem;
    opacity: 0.5;
  }

  .toast-actions {
    display: flex;
    gap: 0.35rem;
  }

  .toast-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.55rem;
    padding: 0.15rem 0.35rem;
    background: color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 3px;
    cursor: pointer;
  }

  .toast-btn.ack {
    background: color-mix(in srgb, #f85149 20%, transparent);
    color: #f85149;
  }

  .toast-more {
    font-size: 0.6rem;
    text-align: center;
    opacity: 0.6;
    padding: 0.25rem;
  }

  /* Overlay Preview */
  .overlay-preview {
    padding: 0.75rem;
  }

  .overlay-backdrop {
    background: rgba(0, 0, 0, 0.8);
    border-radius: 6px;
    padding: 1.5rem;
    display: flex;
    justify-content: center;
    box-shadow: inset 0 0 50px 10px rgba(248, 81, 73, 0.2);
  }

  .overlay-card {
    background: color-mix(in srgb, currentColor 10%, transparent);
    border: 1px solid color-mix(in srgb, #f85149 30%, transparent);
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.35rem;
  }

  .overlay-icon {
    font-size: 1.5rem;
    animation: pulse 2s ease-in-out infinite;
  }

  .overlay-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 700;
    color: #f85149;
  }

  .overlay-device {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .overlay-message {
    font-size: 0.75rem;
    opacity: 0.8;
  }

  .overlay-time {
    font-size: 0.65rem;
    opacity: 0.5;
  }

  .overlay-buttons {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .overlay-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.35rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
  }

  .overlay-btn.primary {
    background: #f85149;
    color: white;
  }

  .overlay-btn:not(.primary) {
    background: color-mix(in srgb, currentColor 15%, transparent);
  }

  .overlay-effects {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 0.75rem;
    font-size: 0.6rem;
    opacity: 0.7;
  }

  /* Acknowledgment Flow */
  .ack-flow {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .ack-step {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .ack-side {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    width: 70px;
    flex-shrink: 0;
    opacity: 0.7;
  }

  .ack-action {
    font-size: 0.75rem;
    padding: 0.35rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-radius: 4px;
    flex: 1;
  }

  .ack-action code {
    font-size: 0.7rem;
  }

  .ack-arrow {
    font-size: 0.8rem;
    opacity: 0.5;
  }

  .ack-note {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    margin-top: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px dashed color-mix(in srgb, currentColor 15%, transparent);
    font-size: 0.7rem;
    opacity: 0.8;
  }

  .note-icon {
    flex-shrink: 0;
  }

  /* Detection Rule */
  .detection-rule {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .rule-condition {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, #f85149 15%, transparent);
    border-radius: 3px;
    color: #f85149;
  }

  .rule-arrow {
    opacity: 0.5;
  }

  .rule-result {
    font-size: 0.75rem;
    font-weight: 600;
  }

  .detection-example {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .detection-example code {
    font-size: 0.65rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
  }

  /* Lifecycle Diagram */
  .lifecycle-diagram {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .lifecycle-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    width: 100%;
    max-width: 350px;
  }

  .lifecycle-event {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: 4px;
  }

  .lifecycle-event.trigger {
    background: color-mix(in srgb, #f85149 15%, transparent);
    color: #f85149;
  }

  .lifecycle-state {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    border-radius: 4px;
    text-align: center;
  }

  .lifecycle-state.final {
    background: color-mix(in srgb, #3fb950 15%, transparent);
    color: #3fb950;
  }

  .lifecycle-action {
    font-size: 0.7rem;
    font-style: italic;
    opacity: 0.8;
  }

  .lifecycle-arrow {
    font-size: 0.8rem;
    opacity: 0.5;
  }

  .lifecycle-effects {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    font-size: 0.65rem;
    opacity: 0.7;
    padding-left: 1rem;
  }

  /* Severity Table */
  .severity-table {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .severity-row {
    display: grid;
    grid-template-columns: 1fr 1.2fr 1fr 1fr;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    align-items: center;
  }

  .severity-row:last-child {
    border-bottom: none;
  }

  .severity-row.header {
    background: color-mix(in srgb, currentColor 5%, transparent);
    font-weight: 600;
    font-size: 0.75rem;
  }

  .sev-level {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .sev-level.critical { color: #f85149; }
  .sev-level.warning { color: #d29922; }
  .sev-level.info { color: #58a6ff; }
  .sev-level.recovery { color: #3fb950; }

  .sev-color {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.7rem;
  }

  .color-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .color-dot.critical { background: #f85149; }
  .color-dot.warning { background: #d29922; }
  .color-dot.info { background: #58a6ff; }
  .color-dot.recovery { background: #3fb950; }

  .sev-icon {
    font-size: 0.75rem;
  }

  .sev-badge {
    font-size: 0.7rem;
  }

  /* Overlay Features */
  .overlay-features {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .feature-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .feature-row:last-child {
    border-bottom: none;
  }

  .feature-row .feature-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    width: 100px;
    flex-shrink: 0;
  }

  .feature-row code {
    font-size: 0.65rem;
    background: color-mix(in srgb, currentColor 8%, transparent);
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
  }

  /* Roadmap Callout */
  .roadmap-callout {
    background: color-mix(in srgb, #8b5cf6 5%, transparent);
    border: 1px solid color-mix(in srgb, #8b5cf6 20%, transparent);
    border-left: 4px solid #8b5cf6;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
  }

  .roadmap-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .roadmap-icon {
    font-size: 1rem;
  }

  .roadmap-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #8b5cf6;
  }

  .roadmap-desc {
    font-size: 0.8rem;
    margin: 0 0 1rem 0;
    opacity: 0.85;
    line-height: 1.5;
  }

  .roadmap-features {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .roadmap-feature {
    display: flex;
    gap: 0.75rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
  }

  .roadmap-feature .feature-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .roadmap-feature .feature-content {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .roadmap-feature .feature-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .roadmap-feature .feature-desc {
    font-size: 0.7rem;
    opacity: 0.75;
  }

  /* ===== Interactive Topology Canvas Deep Dive ===== */

  .topology-arch-flow {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .arch-source {
    background: color-mix(in srgb, #3b82f6 10%, transparent);
    border: 1px solid color-mix(in srgb, #3b82f6 30%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .arch-source-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    color: #3b82f6;
    margin-bottom: 0.5rem;
  }

  .arch-source-items {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem 1rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    opacity: 0.8;
  }

  .arch-arrow-down {
    text-align: center;
    color: #10b981;
    font-size: 1.25rem;
    padding: 0.25rem 0;
  }

  .arch-processor {
    background: color-mix(in srgb, #10b981 8%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 25%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .arch-processor.collision {
    background: color-mix(in srgb, #f59e0b 8%, transparent);
    border-color: color-mix(in srgb, #f59e0b 25%, transparent);
  }

  .proc-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #10b981;
    margin-bottom: 0.75rem;
  }

  .arch-processor.collision .proc-header {
    color: #f59e0b;
  }

  .proc-logic {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .proc-rule {
    display: grid;
    grid-template-columns: auto auto 1fr;
    gap: 0.5rem;
    font-size: 0.75rem;
    align-items: baseline;
  }

  .rule-condition {
    font-family: "IBM Plex Mono", monospace;
    opacity: 0.7;
  }

  .rule-if {
    font-family: "IBM Plex Mono", monospace;
    color: #10b981;
  }

  .rule-result {
    opacity: 0.9;
  }

  .proc-steps {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .proc-step {
    font-size: 0.75rem;
    opacity: 0.9;
    padding-left: 0.5rem;
    border-left: 2px solid color-mix(in srgb, #f59e0b 40%, transparent);
  }

  .arch-renderer {
    background: color-mix(in srgb, #8b5cf6 8%, transparent);
    border: 1px solid color-mix(in srgb, #8b5cf6 25%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .renderer-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: #8b5cf6;
    margin-bottom: 0.75rem;
  }

  .renderer-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.35rem;
  }

  .control-item {
    font-size: 0.7rem;
    opacity: 0.85;
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 3px;
  }

  .layout-desc {
    font-size: 0.85rem;
    opacity: 0.8;
    margin-bottom: 1rem;
  }

  /* Canvas Mockups */
  .canvas-mockup {
    margin: 1rem auto;
    max-width: 600px;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 8px;
    overflow: hidden;
  }

  .canvas-toolbar {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .canvas-toolbar .toolbar-btn {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.25rem 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
    cursor: pointer;
  }

  .canvas-toolbar .toolbar-btn.active {
    background: color-mix(in srgb, #10b981 20%, transparent);
    border-color: #10b981;
    color: #10b981;
  }

  .toolbar-spacer {
    flex: 1;
  }

  .canvas-area {
    position: relative;
    height: 280px;
    padding: 1rem;
  }

  .mock-cluster {
    position: absolute;
    left: var(--x);
    top: var(--y);
    width: 120px;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 2px solid color-mix(in srgb, currentColor 20%, transparent);
    border-radius: 6px;
    text-align: center;
  }

  .mock-cluster.warning {
    border-color: #ef4444;
  }

  .mock-cluster.small {
    width: 90px;
    padding: 0.35rem;
  }

  .mock-cluster .cluster-icon {
    font-size: 1rem;
    margin-bottom: 0.25rem;
  }

  .mock-cluster .cluster-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    font-weight: 600;
    margin-bottom: 0.35rem;
  }

  .mock-cluster .cluster-dots {
    display: flex;
    justify-content: center;
    gap: 0.2rem;
    margin-bottom: 0.35rem;
    flex-wrap: wrap;
  }

  .mock-cluster .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .mock-cluster .dot.up {
    background: #10b981;
  }

  .mock-cluster .dot.down {
    background: #ef4444;
    animation: pulse-dot 1.5s ease-in-out infinite;
  }

  @keyframes pulse-dot {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .mock-cluster .cluster-summary {
    font-size: 0.55rem;
    opacity: 0.7;
  }

  .mock-edge {
    position: absolute;
    left: var(--x1);
    top: var(--y1);
    width: calc(var(--x2) - var(--x1));
    height: calc(var(--y2) - var(--y1));
    border: 0;
  }

  .mock-edge.h1, .mock-edge.h2, .mock-edge.h-exp {
    height: 2px;
    background: color-mix(in srgb, #10b981 60%, transparent);
    top: var(--y1);
  }

  .mock-edge.v1, .mock-edge.v2, .mock-edge.v-exp {
    width: 2px;
    background: color-mix(in srgb, #10b981 60%, transparent);
    left: var(--x1);
  }

  .mock-external {
    position: absolute;
    left: var(--x);
    top: var(--y);
    width: 80px;
    text-align: center;
  }

  .mock-external .external-glow {
    position: absolute;
    inset: -4px;
    border: 2px solid #10b981;
    border-radius: 50%;
    opacity: 0.5;
    animation: glow-pulse 2s ease-in-out infinite;
  }

  @keyframes glow-pulse {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(1.05); }
  }

  .mock-external .external-content {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.75rem 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 2px dashed color-mix(in srgb, currentColor 30%, transparent);
    border-radius: 50%;
  }

  .mock-external .external-icon-lg {
    font-size: 1.25rem;
  }

  .mock-external .external-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
  }

  .canvas-hint {
    position: absolute;
    bottom: 0.5rem;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.6rem;
    opacity: 0.5;
    font-style: italic;
  }

  /* Expanded View */
  .expanded-cluster-box {
    position: absolute;
    left: var(--x);
    top: var(--y);
    width: 280px;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 2px dashed color-mix(in srgb, #10b981 40%, transparent);
    border-radius: 8px;
  }

  .expanded-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #10b981;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .expanded-devices {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  .mock-device {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.4rem 0.6rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
    min-width: 70px;
  }

  .mock-device .device-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-bottom: 0.2rem;
  }

  .mock-device .device-status.up {
    background: #10b981;
  }

  .mock-device .device-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    font-weight: 600;
  }

  .mock-device .device-ip {
    font-size: 0.55rem;
    opacity: 0.6;
  }

  /* Node Types Grid */
  .node-types-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .node-type-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    text-align: center;
  }

  .node-type-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: #3b82f6;
  }

  .node-type-mockup {
    margin: 0 auto 0.75rem;
  }

  .node-type-action, .node-type-desc {
    font-size: 0.65rem;
    opacity: 0.6;
    font-style: italic;
  }

  /* Cluster Node Mockup */
  .cluster-node-mock {
    position: relative;
    width: 140px;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 2px solid color-mix(in srgb, currentColor 20%, transparent);
    border-radius: 6px;
  }

  .cnm-icon {
    font-size: 1rem;
  }

  .cnm-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .cnm-divider {
    height: 1px;
    background: color-mix(in srgb, currentColor 15%, transparent);
    margin: 0.35rem 0;
  }

  .cnm-dots {
    display: flex;
    justify-content: center;
    gap: 0.2rem;
    flex-wrap: wrap;
  }

  .cnm-dots .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #10b981;
  }

  .cnm-summary {
    font-size: 0.55rem;
    opacity: 0.7;
  }

  .cnm-handles {
    position: absolute;
  }

  .cnm-handles .handle {
    position: absolute;
    width: 8px;
    height: 8px;
    background: color-mix(in srgb, currentColor 30%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 50%, transparent);
    border-radius: 50%;
  }

  .cnm-handles .handle.top { top: -4px; left: 50%; transform: translateX(-50%); }
  .cnm-handles .handle.right { right: -4px; top: 50%; transform: translateY(-50%); }
  .cnm-handles .handle.bottom { bottom: -4px; left: 50%; transform: translateX(-50%); }
  .cnm-handles .handle.left { left: -4px; top: 50%; transform: translateY(-50%); }

  /* Device Node Mockup */
  .device-node-mock {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 120px;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 20%, transparent);
    border-radius: 4px;
  }

  .dnm-status {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .dnm-status.up {
    background: #10b981;
  }

  .dnm-info {
    display: flex;
    flex-direction: column;
    text-align: left;
  }

  .dnm-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .dnm-ip {
    font-size: 0.55rem;
    opacity: 0.6;
  }

  .dnm-handles {
    position: absolute;
  }

  .dnm-handles .handle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: color-mix(in srgb, currentColor 30%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 50%, transparent);
    border-radius: 50%;
  }

  .dnm-handles .handle.top { top: -3px; left: 50%; transform: translateX(-50%); }
  .dnm-handles .handle.right { right: -3px; top: 50%; transform: translateY(-50%); }
  .dnm-handles .handle.bottom { bottom: -3px; left: 50%; transform: translateX(-50%); }
  .dnm-handles .handle.left { left: -3px; top: 50%; transform: translateY(-50%); }

  /* External Node Mockup */
  .external-node-mock {
    position: relative;
    width: 90px;
    height: 70px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 2px dashed color-mix(in srgb, currentColor 25%, transparent);
    border-radius: 35px;
  }

  .enm-glow {
    position: absolute;
    inset: -3px;
    border: 2px solid #10b981;
    border-radius: 38px;
    opacity: 0.4;
    animation: glow-pulse 2s ease-in-out infinite;
  }

  .enm-icon {
    font-size: 1.25rem;
  }

  .enm-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.6rem;
  }

  /* Algorithm Block */
  .algorithm-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
    margin: 1rem 0;
  }

  .algo-section {
    display: grid;
    grid-template-columns: 80px 1fr;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .algo-section:last-child {
    border-bottom: none;
  }

  .algo-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    font-weight: 600;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    color: #f59e0b;
  }

  .algo-content {
    font-size: 0.75rem;
    padding: 0.75rem;
    line-height: 1.5;
  }

  .algo-content code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
  }

  /* Persistence Block */
  .persistence-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .persist-key {
    margin-bottom: 1rem;
  }

  .persist-label {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-right: 0.5rem;
  }

  .persist-key code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    color: #10b981;
  }

  .persist-structure {
    margin-bottom: 1rem;
  }

  .persist-header {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-bottom: 0.5rem;
  }

  .persist-structure pre {
    margin: 0;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    overflow-x: auto;
  }

  .persist-structure code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    line-height: 1.5;
  }

  .persist-triggers {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .trigger-item {
    display: flex;
    gap: 0.5rem;
    font-size: 0.75rem;
  }

  .trigger-event {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    color: #3b82f6;
    min-width: 50px;
  }

  .trigger-when code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
  }

  /* Grid Layout Block */
  .grid-layout-block {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin: 1rem 0;
  }

  @media (max-width: 640px) {
    .grid-layout-block {
      grid-template-columns: 1fr;
    }
  }

  .grid-algo {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .grid-step {
    display: flex;
    gap: 0.75rem;
    font-size: 0.75rem;
    align-items: flex-start;
  }

  .grid-step .step-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    height: 20px;
    background: #10b981;
    color: white;
    border-radius: 50%;
    font-size: 0.65rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .grid-step .step-text code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
  }

  .grid-example {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .grid-example-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    opacity: 0.7;
    margin-bottom: 0.75rem;
  }

  .grid-visual {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.15rem;
  }

  .grid-row {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .grid-cell {
    padding: 0.2rem 0.4rem;
    background: color-mix(in srgb, #10b981 15%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 40%, transparent);
    border-radius: 3px;
  }

  .grid-dash {
    opacity: 0.4;
  }

  .grid-vline {
    opacity: 0.4;
    white-space: pre;
  }

  /* Edge Routing Block */
  .edge-routing-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .routing-intro {
    font-size: 0.8rem;
    opacity: 0.85;
    margin-bottom: 0.75rem;
  }

  .routing-rules {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    margin-bottom: 0.75rem;
  }

  .routing-rule {
    display: flex;
    gap: 0.75rem;
    font-size: 0.75rem;
    padding: 0.4rem 0.6rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
  }

  .routing-rule .rule-condition {
    font-family: "IBM Plex Mono", monospace;
    min-width: 220px;
    opacity: 0.8;
  }

  .routing-rule .rule-result {
    font-family: "IBM Plex Mono", monospace;
    color: #10b981;
  }

  .routing-note {
    font-size: 0.7rem;
    opacity: 0.6;
    font-style: italic;
    margin: 0;
  }

  /* Component Tree */
  .component-tree {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    margin: 1rem 0;
  }

  .tree-node {
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
    margin-bottom: 0.25rem;
  }

  .tree-node.root {
    background: color-mix(in srgb, #8b5cf6 10%, transparent);
    border-color: color-mix(in srgb, #8b5cf6 30%, transparent);
  }

  .tree-node.nested {
    background: color-mix(in srgb, #3b82f6 10%, transparent);
    border-color: color-mix(in srgb, #3b82f6 30%, transparent);
    margin-top: 0.5rem;
  }

  .tree-name {
    font-weight: 600;
  }

  .tree-desc {
    opacity: 0.6;
    margin-left: 0.5rem;
  }

  .tree-children {
    margin-left: 1.5rem;
    padding-left: 1rem;
    border-left: 2px solid color-mix(in srgb, currentColor 15%, transparent);
  }

  .tree-grandchildren {
    margin-left: 1rem;
    padding-left: 1rem;
    border-left: 2px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .tree-deep {
    margin-left: 1rem;
    padding-left: 1rem;
    border-left: 2px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .tree-leaf {
    font-size: 0.7rem;
    opacity: 0.8;
    padding: 0.25rem 0;
  }

  /* ===== WebSocket Real-Time Updates Deep Dive ===== */

  .ws-architecture {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .ws-layer {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .ws-layer.scheduler {
    border-color: color-mix(in srgb, #f59e0b 30%, transparent);
  }

  .ws-layer.manager {
    border-color: color-mix(in srgb, #8b5cf6 30%, transparent);
  }

  .ws-layer.clients {
    border-color: color-mix(in srgb, #3b82f6 30%, transparent);
  }

  .ws-layer-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .ws-layer.scheduler .ws-layer-header { background: color-mix(in srgb, #f59e0b 8%, transparent); }
  .ws-layer.manager .ws-layer-header { background: color-mix(in srgb, #8b5cf6 8%, transparent); }
  .ws-layer.clients .ws-layer-header { background: color-mix(in srgb, #3b82f6 8%, transparent); }

  .ws-layer-icon {
    font-size: 1rem;
  }

  .ws-layer-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .ws-layer.scheduler .ws-layer-title { color: #f59e0b; }
  .ws-layer.manager .ws-layer-title { color: #8b5cf6; }
  .ws-layer.clients .ws-layer-title { color: #3b82f6; }

  .ws-pollers {
    padding: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .ws-poller {
    display: grid;
    grid-template-columns: 140px 70px 1fr;
    gap: 0.5rem;
    font-size: 0.7rem;
    padding: 0.5rem;
    background: color-mix(in srgb, currentColor 2%, transparent);
    border-radius: 4px;
    align-items: center;
  }

  .poller-name {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    color: #f59e0b;
  }

  .poller-interval {
    font-family: "IBM Plex Mono", monospace;
    opacity: 0.6;
    font-size: 0.65rem;
  }

  .poller-action {
    opacity: 0.85;
  }

  .ws-arrow-down {
    text-align: center;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    color: #10b981;
    padding: 0.25rem 0;
  }

  .ws-manager-content {
    padding: 0.75rem;
  }

  .ws-manager-content code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    display: block;
    margin-bottom: 0.5rem;
    opacity: 0.8;
  }

  .ws-manager-flow {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
    padding: 0.4rem 0.6rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
  }

  .ws-flow-arrow {
    color: #8b5cf6;
  }

  .ws-clients-grid {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem;
    padding-bottom: 0.5rem;
  }

  .ws-client {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.3rem 0.6rem;
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    border: 1px solid color-mix(in srgb, #3b82f6 30%, transparent);
    border-radius: 4px;
  }

  .ws-hook {
    padding: 0 0.75rem 0.75rem;
  }

  .ws-hook-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .ws-hook-handlers {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .ws-handler {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
    padding: 0.3rem 0.5rem;
    background: color-mix(in srgb, currentColor 2%, transparent);
    border-radius: 3px;
  }

  .handler-msg {
    font-family: "IBM Plex Mono", monospace;
    color: #10b981;
    min-width: 150px;
  }

  .handler-arrow {
    opacity: 0.5;
  }

  .handler-action {
    opacity: 0.85;
  }

  /* WebSocket Messages Grid */
  .ws-messages-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .ws-message-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .ws-message-card.keepalive {
    border-style: dashed;
    opacity: 0.8;
  }

  .ws-msg-header {
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .ws-msg-type {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    color: #10b981;
  }

  .ws-msg-desc {
    font-size: 0.7rem;
    opacity: 0.75;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 5%, transparent);
  }

  .ws-msg-payload {
    padding: 0.5rem;
  }

  .ws-msg-payload pre {
    margin: 0;
    font-size: 0.65rem;
    line-height: 1.4;
    overflow-x: auto;
  }

  .ws-msg-payload code {
    font-family: "IBM Plex Mono", monospace;
  }

  /* Connection Lifecycle */
  .ws-lifecycle {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .lifecycle-row {
    display: grid;
    grid-template-columns: 1fr 60px 1fr;
    text-align: center;
    margin-bottom: 1rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .lifecycle-client { color: #3b82f6; }
  .lifecycle-server { color: #10b981; }

  .lifecycle-arrow {
    position: relative;
  }

  .lifecycle-arrow::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 1px;
    background: color-mix(in srgb, currentColor 20%, transparent);
  }

  .lifecycle-event {
    display: grid;
    grid-template-columns: 1fr 60px 1fr;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 0.7rem;
  }

  .lifecycle-event.disconnect {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px dashed color-mix(in srgb, #ef4444 40%, transparent);
  }

  .lifecycle-msg {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    background: color-mix(in srgb, currentColor 3%, transparent);
  }

  .lifecycle-msg.outgoing {
    text-align: right;
    background: color-mix(in srgb, #3b82f6 10%, transparent);
    margin-left: auto;
  }

  .lifecycle-msg.incoming {
    text-align: left;
    background: color-mix(in srgb, #10b981 10%, transparent);
  }

  .lifecycle-note {
    font-size: 0.6rem;
    opacity: 0.5;
    text-align: center;
    align-self: center;
  }

  .lifecycle-action {
    font-size: 0.65rem;
    opacity: 0.75;
    text-align: left;
    padding-left: 0.5rem;
  }

  .lifecycle-reconnect {
    margin-top: 1rem;
    padding: 0.75rem;
    background: color-mix(in srgb, #f59e0b 8%, transparent);
    border: 1px solid color-mix(in srgb, #f59e0b 25%, transparent);
    border-radius: 4px;
    text-align: center;
  }

  .reconnect-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    color: #f59e0b;
    margin-bottom: 0.25rem;
  }

  .reconnect-delays {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    opacity: 0.8;
  }

  /* Reconnection Flow */
  .reconnect-flow {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    margin: 1rem 0;
  }

  .reconnect-step {
    padding: 0.6rem 1rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 6px;
    text-align: center;
  }

  .reconnect-step.trigger {
    background: color-mix(in srgb, #ef4444 10%, transparent);
    border-color: color-mix(in srgb, #ef4444 30%, transparent);
  }

  .reconnect-step .step-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .reconnect-step.trigger .step-label {
    color: #ef4444;
  }

  .reconnect-step code {
    display: block;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    margin-top: 0.25rem;
    opacity: 0.8;
  }

  .reconnect-arrow {
    color: #10b981;
    font-size: 1rem;
  }

  .reconnect-delays-table {
    display: grid;
    grid-template-columns: repeat(2, auto);
    gap: 0.25rem 1rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
  }

  .delay-row {
    display: contents;
  }

  .delay-row span:first-child {
    opacity: 0.6;
    text-align: right;
  }

  .attempt-outcomes {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 0.5rem;
  }

  .outcome {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
  }

  .outcome.success {
    background: color-mix(in srgb, #10b981 15%, transparent);
    color: #10b981;
  }

  .outcome.failure {
    background: color-mix(in srgb, #ef4444 15%, transparent);
    color: #ef4444;
  }

  /* Hostname Matching */
  .hostname-matching {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 1rem;
    margin: 1rem 0;
  }

  @media (max-width: 768px) {
    .hostname-matching {
      grid-template-columns: 1fr;
    }
  }

  .matching-problem {
    background: color-mix(in srgb, #ef4444 8%, transparent);
    border: 1px solid color-mix(in srgb, #ef4444 25%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .problem-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #ef4444;
    margin-bottom: 0.5rem;
  }

  .problem-row {
    display: flex;
    gap: 0.5rem;
    font-size: 0.75rem;
    margin-bottom: 0.25rem;
  }

  .problem-source {
    opacity: 0.7;
    min-width: 100px;
  }

  .problem-row code {
    font-family: "IBM Plex Mono", monospace;
  }

  .matching-algorithm {
    background: color-mix(in srgb, #10b981 8%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 25%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .algo-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    color: #10b981;
    padding: 0.6rem 1rem;
    background: color-mix(in srgb, #10b981 8%, transparent);
    border-bottom: 1px solid color-mix(in srgb, #10b981 15%, transparent);
  }

  .algo-steps {
    padding: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .algo-step {
    display: flex;
    gap: 0.75rem;
    font-size: 0.75rem;
  }

  .algo-step .step-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 22px;
    background: #10b981;
    color: white;
    border-radius: 50%;
    font-size: 0.65rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .algo-step .step-content {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .algo-step .step-name {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
  }

  .algo-step .step-logic {
    font-size: 0.7rem;
    opacity: 0.85;
  }

  .algo-step .step-example {
    font-size: 0.65rem;
    opacity: 0.6;
    font-style: italic;
  }

  /* Component Structure Split */
  .ws-component-split {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin: 1rem 0;
  }

  @media (max-width: 768px) {
    .ws-component-split {
      grid-template-columns: 1fr;
    }
  }

  .ws-component-col {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .ws-component-col.backend {
    border-color: color-mix(in srgb, #10b981 30%, transparent);
  }

  .ws-component-col.frontend {
    border-color: color-mix(in srgb, #3b82f6 30%, transparent);
  }

  .component-col-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 10%, transparent);
  }

  .ws-component-col.backend .component-col-header {
    background: color-mix(in srgb, #10b981 10%, transparent);
    color: #10b981;
  }

  .ws-component-col.frontend .component-col-header {
    background: color-mix(in srgb, #3b82f6 10%, transparent);
    color: #3b82f6;
  }

  .ws-component-col .component-tree {
    padding: 0.75rem;
  }

  .tree-file {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .tree-file:last-child {
    margin-bottom: 0;
  }

  .tree-contents {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    font-weight: 400;
    font-size: 0.65rem;
    opacity: 0.85;
    margin-top: 0.25rem;
    padding-left: 0.75rem;
    border-left: 2px solid color-mix(in srgb, currentColor 15%, transparent);
  }

  .tree-indent {
    padding-left: 0.5rem;
    opacity: 0.75;
  }

  /* URL Construction */
  .url-construction {
    margin: 1rem 0;
  }

  .url-code {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .url-code pre {
    margin: 0;
    font-size: 0.7rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .url-code code {
    font-family: "IBM Plex Mono", monospace;
  }

  .url-examples {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .url-example {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
  }

  .url-input {
    opacity: 0.7;
  }

  .url-arrow {
    color: #10b981;
  }

  .url-output {
    color: #10b981;
  }

  /* Debug Helper */
  .debug-helper {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .debug-intro {
    font-size: 0.8rem;
    margin-bottom: 0.75rem;
  }

  .debug-intro code {
    font-family: "IBM Plex Mono", monospace;
    color: #f59e0b;
  }

  .debug-commands {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .debug-cmd {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 1rem;
    font-size: 0.7rem;
    padding: 0.4rem 0.6rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
  }

  .debug-cmd code {
    font-family: "IBM Plex Mono", monospace;
    color: #f59e0b;
  }

  .debug-desc {
    opacity: 0.6;
    text-align: right;
  }

  @media (max-width: 640px) {
    .ws-poller {
      grid-template-columns: 1fr;
      gap: 0.25rem;
    }

    .poller-interval {
      display: none;
    }

    .debug-cmd {
      grid-template-columns: 1fr;
      gap: 0.25rem;
    }

    .debug-desc {
      text-align: left;
      font-size: 0.65rem;
    }
  }

  /* ===== CDP/LLDP Link Discovery Deep Dive ===== */

  .cdp-architecture {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .cdp-layer {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .cdp-layer.infrastructure {
    border-color: color-mix(in srgb, #3b82f6 30%, transparent);
  }

  .cdp-layer.backend {
    border-color: color-mix(in srgb, #10b981 30%, transparent);
  }

  .cdp-layer.aggregator {
    border-color: color-mix(in srgb, #f59e0b 30%, transparent);
  }

  .cdp-layer.frontend {
    border-color: color-mix(in srgb, #8b5cf6 30%, transparent);
  }

  .cdp-layer-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  .cdp-layer.infrastructure .cdp-layer-header { background: color-mix(in srgb, #3b82f6 8%, transparent); }
  .cdp-layer.backend .cdp-layer-header { background: color-mix(in srgb, #10b981 8%, transparent); }
  .cdp-layer.aggregator .cdp-layer-header { background: color-mix(in srgb, #f59e0b 8%, transparent); }
  .cdp-layer.frontend .cdp-layer-header { background: color-mix(in srgb, #8b5cf6 8%, transparent); }

  .cdp-layer-icon {
    font-size: 1rem;
  }

  .cdp-layer-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .cdp-layer.infrastructure .cdp-layer-title { color: #3b82f6; }
  .cdp-layer.backend .cdp-layer-title { color: #10b981; }
  .cdp-layer.aggregator .cdp-layer-title { color: #f59e0b; }
  .cdp-layer.frontend .cdp-layer-title { color: #8b5cf6; }

  .cdp-switches {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem;
    flex-wrap: wrap;
  }

  .cdp-switch {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 15%, transparent);
    border-radius: 4px;
  }

  .cdp-switch.more {
    opacity: 0.5;
  }

  .switch-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .switch-type {
    font-size: 0.6rem;
    opacity: 0.6;
  }

  .cdp-arrow-bidir {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    color: #10b981;
    opacity: 0.8;
  }

  .cdp-snmp-flow {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    border-top: 1px dashed color-mix(in srgb, currentColor 15%, transparent);
  }

  .snmp-label {
    font-size: 0.65rem;
    opacity: 0.6;
  }

  .snmp-arrow {
    color: #10b981;
  }

  .cdp-librenms {
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, #10b981 5%, transparent);
    border-top: 1px solid color-mix(in srgb, #10b981 20%, transparent);
  }

  .librenms-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    color: #10b981;
    margin-bottom: 0.35rem;
  }

  .librenms-endpoint code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.15rem 0.4rem;
    border-radius: 3px;
  }

  .librenms-returns {
    font-size: 0.65rem;
    opacity: 0.7;
    margin-top: 0.35rem;
  }

  .cdp-flow-arrow {
    text-align: center;
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    color: #10b981;
    padding: 0.25rem 0;
  }

  .cdp-backend-flow {
    padding: 0.75rem 1rem;
  }

  .backend-func {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .func-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    color: #10b981;
  }

  .func-file {
    font-size: 0.65rem;
    opacity: 0.5;
  }

  .backend-steps {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding-left: 0.75rem;
    border-left: 2px solid color-mix(in srgb, #10b981 30%, transparent);
  }

  .backend-step {
    font-size: 0.7rem;
    opacity: 0.85;
  }

  .cdp-cache-block {
    margin: 0.75rem 1rem 1rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 4px;
    overflow: hidden;
  }

  .cache-key {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    padding: 0.4rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    color: #f59e0b;
  }

  .cdp-cache-block pre {
    margin: 0;
    padding: 0.5rem 0.75rem;
    font-size: 0.65rem;
    line-height: 1.4;
    overflow-x: auto;
  }

  .cdp-cache-block code {
    font-family: "IBM Plex Mono", monospace;
  }

  .aggregator-steps {
    padding: 0.75rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .agg-step {
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
  }

  .agg-step .step-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 22px;
    background: #f59e0b;
    color: white;
    border-radius: 50%;
    font-size: 0.65rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .agg-step .step-content {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .agg-step .step-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .agg-step .step-detail {
    font-size: 0.7rem;
    opacity: 0.75;
  }

  .agg-step code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
    opacity: 0.8;
  }

  .frontend-renders {
    padding: 0.75rem 1rem;
    font-size: 0.75rem;
    opacity: 0.85;
  }

  /* CDP Models Grid */
  .cdp-models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .cdp-model-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .model-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    color: #3b82f6;
  }

  .cdp-model-card pre {
    margin: 0;
    padding: 0.75rem;
    font-size: 0.65rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .cdp-model-card code {
    font-family: "IBM Plex Mono", monospace;
  }

  /* Port Resolution Block */
  .port-resolution-block {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 1rem;
    margin: 1rem 0;
  }

  @media (max-width: 768px) {
    .port-resolution-block {
      grid-template-columns: 1fr;
    }
  }

  .resolution-problem {
    background: color-mix(in srgb, #ef4444 8%, transparent);
    border: 1px solid color-mix(in srgb, #ef4444 25%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .problem-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #ef4444;
    margin-bottom: 0.5rem;
  }

  .problem-content {
    font-size: 0.75rem;
    line-height: 1.5;
  }

  .problem-content code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    background: color-mix(in srgb, currentColor 5%, transparent);
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
  }

  .resolution-solution {
    background: color-mix(in srgb, #10b981 8%, transparent);
    border: 1px solid color-mix(in srgb, #10b981 25%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .solution-label {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.7rem;
    font-weight: 600;
    color: #10b981;
    margin-bottom: 0.5rem;
  }

  .solution-steps {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-bottom: 0.75rem;
  }

  .sol-step {
    font-size: 0.75rem;
    opacity: 0.9;
  }

  .solution-gotcha {
    font-size: 0.7rem;
    padding: 0.5rem;
    background: color-mix(in srgb, #f59e0b 10%, transparent);
    border-radius: 4px;
  }

  .gotcha-label {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    color: #f59e0b;
  }

  .solution-gotcha code {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.65rem;
  }

  /* Deduplication Block */
  .dedup-block {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .dedup-scenario {
    font-size: 0.8rem;
    margin-bottom: 0.75rem;
  }

  .scenario-label {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    color: #f59e0b;
  }

  .dedup-solution {
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    gap: 1rem;
  }

  @media (max-width: 768px) {
    .dedup-solution {
      grid-template-columns: 1fr;
    }
  }

  .dedup-code pre {
    margin: 0;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    font-size: 0.65rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .dedup-code code {
    font-family: "IBM Plex Mono", monospace;
  }

  .dedup-result {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    justify-content: center;
  }

  .result-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
  }

  .result-icon {
    color: #10b981;
    font-weight: 600;
  }

  /* Static Merge Block */
  .static-merge-block {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 1rem;
    margin: 1rem 0;
  }

  @media (max-width: 768px) {
    .static-merge-block {
      grid-template-columns: 1fr;
    }
  }

  .non-cdp-devices {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .non-cdp-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #ef4444;
  }

  .non-cdp-list {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .non-cdp-item {
    font-size: 0.7rem;
    opacity: 0.85;
    padding-left: 0.75rem;
    border-left: 2px solid color-mix(in srgb, #ef4444 30%, transparent);
  }

  .static-yaml-example {
    grid-column: span 1;
  }

  .yaml-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #10b981;
  }

  .static-yaml-example pre {
    margin: 0;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 10%, transparent);
    border-radius: 4px;
    font-size: 0.65rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .static-yaml-example code {
    font-family: "IBM Plex Mono", monospace;
  }

  .connection-types {
    grid-column: 1 / -1;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
  }

  .conn-types-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .conn-type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.35rem;
  }

  .conn-type {
    font-size: 0.7rem;
    opacity: 0.85;
  }

  .conn-type code {
    font-family: "IBM Plex Mono", monospace;
    color: #10b981;
    margin-right: 0.35rem;
  }

  /* Status Derivation */
  .status-derivation {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .derivation-note {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: #f59e0b;
  }

  .derivation-algo pre {
    margin: 0 0 0.75rem;
    padding: 0.75rem;
    background: color-mix(in srgb, currentColor 3%, transparent);
    border-radius: 4px;
    font-size: 0.65rem;
    line-height: 1.5;
    overflow-x: auto;
  }

  .derivation-algo code {
    font-family: "IBM Plex Mono", monospace;
  }

  .derivation-why {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    font-size: 0.75rem;
  }

  .why-label {
    font-family: "IBM Plex Mono", monospace;
    font-weight: 600;
    opacity: 0.7;
  }

  .why-reason {
    opacity: 0.85;
  }

  /* CDP Component Tree */
  .cdp-component-tree {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    padding: 1rem;
    margin: 1rem 0;
  }

  .comp-dir {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: #3b82f6;
  }

  .comp-files {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding-left: 1rem;
    border-left: 2px solid color-mix(in srgb, currentColor 15%, transparent);
  }

  .comp-file {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .file-name {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    color: #10b981;
  }

  .file-contents {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    font-size: 0.7rem;
    opacity: 0.8;
    padding-left: 0.75rem;
  }

  /* API Endpoints Grid */
  .api-endpoints-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .api-endpoint-card {
    background: color-mix(in srgb, currentColor 3%, transparent);
    border: 1px solid color-mix(in srgb, currentColor 12%, transparent);
    border-radius: 6px;
    overflow: hidden;
  }

  .endpoint-header {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.5rem 0.75rem;
    background: color-mix(in srgb, #10b981 10%, transparent);
    border-bottom: 1px solid color-mix(in srgb, currentColor 8%, transparent);
    color: #10b981;
  }

  .endpoint-desc {
    font-size: 0.7rem;
    opacity: 0.75;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid color-mix(in srgb, currentColor 5%, transparent);
  }

  .api-endpoint-card pre {
    margin: 0;
    padding: 0.5rem 0.75rem;
    font-size: 0.6rem;
    line-height: 1.4;
    overflow-x: auto;
  }

  .api-endpoint-card code {
    font-family: "IBM Plex Mono", monospace;
  }

  /* Limitations Block */
  .limitations-block {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin: 1rem 0;
  }

  .limitation-item {
    display: flex;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: color-mix(in srgb, #f59e0b 8%, transparent);
    border: 1px solid color-mix(in srgb, #f59e0b 20%, transparent);
    border-radius: 6px;
  }

  .limit-icon {
    font-size: 1rem;
    flex-shrink: 0;
  }

  .limit-content {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }

  .limit-title {
    font-family: "IBM Plex Mono", monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .limit-desc {
    font-size: 0.7rem;
    opacity: 0.85;
  }

  .limit-workaround {
    font-size: 0.65rem;
    opacity: 0.7;
    font-style: italic;
  }
</style>
